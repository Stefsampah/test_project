<div class="min-h-screen bg-gray-900">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header avec logo -->
    <div class="text-center mb-2">
      <div class="flex items-center justify-center mb-2">
        <div class="w-10 h-10 bg-white/10 backdrop-blur-sm rounded-full flex items-center justify-center">
          <div class="w-5 h-5 text-purple-400">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M5 8h2v8H5zm7 0H9v8h3zm5 8h2V8h-2zM8 5h8v2H8z"/>
            </svg>
          </div>
        </div>
        <h1 class="text-2xl font-bold text-white ml-2">üéÅ D√©tails de la R√©compense</h1>
      </div>
      <p class="text-gray-300 text-lg">D√©couvrez le contenu de votre r√©compense</p>
    </div>

    <!-- Navigation -->
    <div class="flex justify-center mb-2">
      <div class="flex space-x-2">
        <%= link_to "‚Üê Retour aux r√©compenses", my_rewards_path, 
            class: "px-4 py-2 rounded-lg text-sm font-medium text-gray-300 bg-gray-700 hover:bg-gray-600 transition-colors" %>
      </div>
    </div>

    <!-- Carte fusionn√©e - R√©compense et Playlist -->
    <% if @playlist %>
    <% elsif @exclusif_content %>
      <!-- Carte pour les r√©compenses exclusives -->
    <% elsif @premium_content %>
      <!-- Carte pour les r√©compenses premium -->
      <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6 mb-2">
        <div class="bg-gradient-to-r from-orange-700 to-red-800 rounded-lg overflow-visible border border-orange-600">
          <!-- Banni√®re avec thumbnail et image de fond -->
          <div class="relative flex items-center justify-center overflow-hidden h-48">
            <!-- Image de fond al√©atoire selon le content_type -->
            <% 
              background_image = case @reward.content_type
              when 'exclusive_photos'
                [
                  'https://img.youtube.com/vi/0tJz8JjPbHU/maxresdefault.jpg', # Didi B
                  'https://img.youtube.com/vi/QVvfSQP3JLM/maxresdefault.jpg', # Didi B Bouak√©
                  'https://img.youtube.com/vi/JWrIfPCyedU/maxresdefault.jpg', # Charles Dor√©
                  'https://img.youtube.com/vi/ICvSOFEKbgs/maxresdefault.jpg', # Miki
                  'https://img.youtube.com/vi/ORfP-QudA1A/maxresdefault.jpg', # Timeo
                  'https://img.youtube.com/vi/VFvDwn2r5RI/maxresdefault.jpg'  # Marine
                ].sample
              when 'backstage_video'
                [
                  'https://img.youtube.com/vi/0tJz8JjPbHU/maxresdefault.jpg', # Didi B F√©licia
                  'https://img.youtube.com/vi/QVvfSQP3JLM/maxresdefault.jpg', # Didi B Bouak√©
                  'https://img.youtube.com/vi/JWrIfPCyedU/maxresdefault.jpg', # Charles Dor√©
                  'https://img.youtube.com/vi/ICvSOFEKbgs/maxresdefault.jpg', # Miki Accor Arena
                  'https://img.youtube.com/vi/ORfP-QudA1A/maxresdefault.jpg', # Timeo
                  'https://img.youtube.com/vi/VFvDwn2r5RI/maxresdefault.jpg'  # Marine
                ].sample
              when 'concert_footage'
                [
                  'https://img.youtube.com/vi/0tJz8JjPbHU/maxresdefault.jpg', # Didi B
                  'https://img.youtube.com/vi/QVvfSQP3JLM/maxresdefault.jpg', # Didi B
                  'https://img.youtube.com/vi/ICvSOFEKbgs/maxresdefault.jpg', # Miki
                  'https://img.youtube.com/vi/ORfP-QudA1A/maxresdefault.jpg', # Timeo
                  'https://img.youtube.com/vi/VFvDwn2r5RI/maxresdefault.jpg'  # Marine
                ].sample
              else
                [
                  'https://img.youtube.com/vi/0tJz8JjPbHU/maxresdefault.jpg', # Didi B
                  'https://img.youtube.com/vi/QVvfSQP3JLM/maxresdefault.jpg', # Didi B
                  'https://img.youtube.com/vi/JWrIfPCyedU/maxresdefault.jpg', # Charles Dor√©
                  'https://img.youtube.com/vi/ICvSOFEKbgs/maxresdefault.jpg', # Miki
                  'https://img.youtube.com/vi/ORfP-QudA1A/maxresdefault.jpg', # Timeo
                  'https://img.youtube.com/vi/VFvDwn2r5RI/maxresdefault.jpg'  # Marine
                ].sample
              end
            %>
            
            <!-- Image de fond -->
            <div class="absolute inset-0 w-full h-full">
              <img src="<%= background_image %>" 
                   alt="<%= @premium_content[:title] %>" 
                   class="w-full h-full object-cover"
                   style="opacity: 0.6;"
                   onerror="this.onerror=null; this.src='https://via.placeholder.com/400x300/FF6B35/FFFFFF?text=Premium'; this.style.opacity='0.6';">
              <div class="absolute inset-0 bg-gradient-to-br <%= @premium_content[:color] %> opacity-60"></div>
            </div>
            
            <!-- Contenu superpos√© -->
            <div class="relative z-10 text-center">
              <div class="text-white text-6xl mb-2"><%= @premium_content[:icon] %></div>
              <div class="text-white font-semibold text-2xl mb-2"><%= @premium_content[:title] %></div>
              <div class="text-white text-sm opacity-90"><%= @premium_content[:type] %></div>
            </div>
            
            <!-- Badge type de contenu -->
            <div class="absolute top-3 right-3">
              <span class="bg-white/20 text-white text-xs px-2 py-1 rounded-full"><%= @premium_content[:type] %></span>
            </div>
          </div>
          
          <!-- Contenu de la r√©compense premium -->
          <div class="p-6">
            <!-- Informations de la r√©compense -->
            <div class="mb-4">
              <div class="flex items-center justify-between mb-2">
                <h3 class="text-lg font-bold text-white"><%= @premium_content[:title] %></h3>
                <div class="text-2xl">ü•á</div>
              </div>
              <div class="text-xs text-gray-400">D√©bloqu√© le <%= @reward.unlocked_at&.strftime('%d/%m/%Y') %></div>
            </div>
            
            <!-- Description -->
            <div class="mb-2">
              <p class="text-orange-200 text-sm leading-relaxed"><%= @premium_content[:description] %></p>
            </div>
            
            <!-- Statistiques -->
            <div class="grid grid-cols-3 gap-3 mb-2">
              <div class="text-center">
                <div class="text-lg font-bold text-white"><%= @reward.quantity_required %></div>
                <div class="text-xs text-gray-300">Badges requis</div>
              </div>
              <div class="text-center">
                <div class="text-lg font-bold text-white">‚úÖ</div>
                <div class="text-xs text-gray-300">D√©bloqu√©</div>
              </div>
              <div class="text-center">
                <div class="text-lg font-bold text-white">üëë</div>
                <div class="text-xs text-gray-300">Premium</div>
              </div>
            </div>
            
            <!-- Lien vers le contenu ou message -->
            <div class="text-center">
              <% if @premium_content[:link] %>
                <a href="<%= @premium_content[:link] %>" target="_blank" 
                   class="inline-block bg-gradient-to-r from-orange-500 to-red-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform hover:scale-105 transition-all duration-200">
                  <%= @premium_content[:link_text] %>
                </a>
              <% else %>
                <div class="bg-gradient-to-r from-orange-600 to-red-700 text-white font-bold py-3 px-6 rounded-lg">
                  <%= @premium_content[:link_text] %>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    <% elsif @exclusif_content %>
      <!-- Carte pour les r√©compenses exclusives -->
      <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6 mb-2">
        <div class="bg-gradient-to-r from-gray-700 to-gray-800 rounded-lg overflow-visible border border-gray-600">
          <!-- Banni√®re avec thumbnail color√© -->
          <div class="relative flex items-center justify-center overflow-hidden h-48">
            <div class="absolute inset-0 bg-gradient-to-br <%= @exclusif_content[:color] %> opacity-80"></div>
            
            <!-- Contenu superpos√© -->
            <div class="relative z-10 text-center">
              <div class="text-white text-6xl mb-2"><%= @exclusif_content[:icon] %></div>
              <div class="text-white font-semibold text-2xl mb-2"><%= @exclusif_content[:title] %></div>
              <div class="text-white text-sm opacity-90"><%= @exclusif_content[:type] %></div>
            </div>
            
            <!-- Badge type de contenu -->
            <div class="absolute top-3 right-3">
              <span class="bg-white/20 text-white text-xs px-2 py-1 rounded-full"><%= @exclusif_content[:type] %></span>
            </div>
          </div>
          
          <!-- Contenu de la r√©compense exclusive -->
          <div class="p-6">
            <!-- Informations de la r√©compense -->
            <div class="mb-4">
              <div class="flex items-center justify-between mb-2">
                <h3 class="text-lg font-bold text-white"><%= @exclusif_content[:title] %></h3>
                <div class="text-2xl">ü•à</div>
              </div>
              <div class="text-xs text-gray-400">D√©bloqu√© le <%= @reward.unlocked_at&.strftime('%d/%m/%Y') %></div>
            </div>
            
            <!-- Description -->
            <div class="mb-2">
              <p class="text-gray-300 text-sm leading-relaxed"><%= @exclusif_content[:description] %></p>
            </div>
            
            <!-- Statistiques -->
            <div class="grid grid-cols-3 gap-3 mb-2">
              <div class="text-center">
                <div class="text-lg font-bold text-white"><%= @reward.quantity_required %></div>
                <div class="text-xs text-gray-300">Badges requis</div>
              </div>
              <div class="text-center">
                <div class="text-lg font-bold text-white">‚úÖ</div>
                <div class="text-xs text-gray-300">D√©bloqu√©</div>
              </div>
              <div class="text-center">
                <div class="text-lg font-bold text-white">‚≠ê</div>
                <div class="text-xs text-gray-300">Exclusif</div>
              </div>
            </div>
            
            <!-- Lien vers le contenu ou message -->
            <div class="text-center">
              <% if @exclusif_content[:link] %>
                <a href="<%= @exclusif_content[:link] %>" target="_blank" 
                   class="inline-block bg-gradient-to-r from-purple-500 to-indigo-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform hover:scale-105 transition-all duration-200">
                  <%= @exclusif_content[:link_text] %>
                </a>
              <% else %>
                <div class="bg-gradient-to-r from-gray-600 to-gray-700 text-white font-bold py-3 px-6 rounded-lg">
                  <%= @exclusif_content[:link_text] %>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    <% else %>
      <!-- Carte par d√©faut pour les autres types de r√©compenses -->
      <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6 mb-2">
        <div class="bg-gradient-to-r from-gray-700 to-gray-800 rounded-lg p-6 text-center">
          <div class="text-6xl mb-4">üéÅ</div>
          <h3 class="text-xl font-bold text-white mb-2"><%= @reward.reward_type.humanize %></h3>
          <p class="text-gray-300 mb-4"><%= @reward.reward_description %></p>
          <div class="text-sm text-gray-400">D√©bloqu√© le <%= @reward.unlocked_at&.strftime('%d/%m/%Y') %></div>
        </div>
      </div>
    <% end %>
    
    <!-- Carte fusionn√©e - R√©compense et Playlist -->
    <% if @playlist %>
      <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6 mb-2">
        <div class="bg-gradient-to-r from-gray-700 to-gray-800 rounded-lg overflow-visible border border-gray-600 playlist-card">
          <!-- Banni√®re de la playlist avec thumbnail al√©atoire -->
          <div class="playlist-thumbnail relative flex items-center justify-center overflow-hidden">
            <% 
              # Utiliser la premi√®re vid√©o de la playlist pour le thumbnail (stable)
              first_video = @playlist.videos.first
              if first_video && first_video.youtube_id.present?
                # Essayer plusieurs qualit√©s de thumbnail
                thumbnail_url = "https://img.youtube.com/vi/#{first_video.youtube_id}/maxresdefault.jpg"
                # Fallback si maxresdefault n'existe pas
                fallback_url = "https://img.youtube.com/vi/#{first_video.youtube_id}/hqdefault.jpg"
              else
                thumbnail_url = nil
                fallback_url = nil
              end
            %>
            
            <!-- Thumbnail en arri√®re-plan -->
            <% if thumbnail_url %>
              <div class="absolute inset-0 w-full h-full">
           <img src="<%= thumbnail_url %>?v=20250115"
                alt="<%= first_video.title %>"
                class="w-full h-full object-cover"
                style="opacity: 0.7;"
                onerror="this.onerror=null; this.src='<%= fallback_url %>?v=20250115'; this.style.opacity='0.7';"
                onload="this.style.opacity='0.7';">
                <div class="absolute inset-0 bg-gradient-to-r from-purple-500/30 to-pink-600/30"></div>
              </div>
            <% else %>
              <div class="absolute inset-0 bg-gradient-to-r from-purple-500 to-pink-600"></div>
            <% end %>
            
            <!-- Contenu superpos√© -->
            <div class="relative z-10 text-center">
              <div class="text-white text-6xl mb-2">üéµ</div>
              <div class="text-white font-semibold text-2xl mb-2"><%= @playlist.title %></div>
            </div>
            
            <!-- Badge nombre de vid√©os -->
            <div class="absolute top-3 right-3">
              <span class="bg-white/20 text-white text-xs px-2 py-1 rounded-full"><%= @playlist.videos.count %> vid√©os</span>
            </div>
          </div>
          
          <!-- Contenu de la playlist -->
          <div class="playlist-content p-6">
            <!-- Informations de la r√©compense -->
            <div class="mb-4">
              <div class="flex items-center justify-between mb-2">
                <h3 class="text-lg font-bold text-white"><%= @reward.content_type&.humanize || @reward.reward_type&.humanize %></h3>
                <div class="text-2xl">
                  <% case @reward.reward_type %>
                  <% when 'challenge' %>
                    ü•â
                  <% when 'exclusif' %>
                    ü•à
                  <% when 'premium' %>
                    ü•á
                  <% when 'ultime' %>
                    üåà
                  <% end %>
                </div>
              </div>
              <div class="text-xs text-gray-400">D√©bloqu√© le <%= @reward.unlocked_at&.strftime('%d/%m/%Y') %></div>
            </div>
            
            <!-- Statistiques combin√©es -->
            <div class="grid grid-cols-3 gap-3 mb-2">
              <div class="text-center">
                <div class="text-lg font-bold text-white"><%= @reward.quantity_required %></div>
                <div class="text-xs text-gray-300">Badges requis</div>
              </div>
              <div class="text-center">
                <div class="text-lg font-bold text-white">
                  <% if @reward.unlocked? %>
                    ‚úÖ
                  <% else %>
                    üîí
                  <% end %>
                </div>
                <div class="text-xs text-gray-300">
                  <% if @reward.unlocked? %>
                    D√©bloqu√©
                  <% else %>
                    Verrouill√©
                  <% end %>
                </div>
              </div>
              <div class="text-center">
                <div class="text-lg font-bold text-white">
                  <% if @playlist.premium? %>
                    ‚≠ê
                  <% else %>
                    üéµ
                  <% end %>
                </div>
                <div class="text-xs text-gray-300">
                  <% if @playlist.premium? %>
                    Premium
                  <% else %>
                    Standard
                  <% end %>
                </div>
              </div>
            </div>
            
            <!-- Bouton pour acc√©der √† la playlist - Positionn√© en bas -->
            <div class="text-center mt-auto space-y-4">
              <% 
                # V√©rifier si l'utilisateur a d√©j√† un jeu en cours pour cette playlist
                existing_game = current_user.games.where(playlist: @playlist, completed_at: nil).last
                if existing_game
                  # Si un jeu existe, continuer la partie
                  playlist_game_path = playlist_game_path(@playlist, existing_game)
                else
                  # Sinon, cr√©er une nouvelle partie
                  playlist_game_path = new_playlist_game_path(@playlist)
                end
              %>
              <%= link_to "üéµ √âcouter la playlist", playlist_game_path, 
                  class: "playlist-button" %>
              
              <!-- Bouton D√©tails des vid√©os -->
              <%= link_to "üéµ D√©tails des vid√©os", video_details_reward_path(@reward), 
                  class: "playlist-button" %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  /* Modal styles */
  .youtube-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.8);
  }
  
  .youtube-modal-content {
    position: relative;
    margin: 5% auto;
    padding: 20px;
    width: 80%;
    max-width: 800px;
    background-color: #1a1a1a;
    border-radius: 12px;
  }
  
  .youtube-modal-close {
    position: absolute;
    right: 15px;
    top: 10px;
    color: #aaa;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
  }
  
  .youtube-modal-close:hover {
    color: white;
  }
  
  .youtube-iframe-container {
    position: relative;
    width: 100%;
    height: 0;
    padding-bottom: 56.25%; /* 16:9 aspect ratio */
  }
  
  .youtube-iframe-container iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: 8px;
  }

  .playlist-card {
    display: flex;
    flex-direction: column;
    height: 800px; /* Hauteur augment√©e pour accommoder les deux boutons */
  }

  .playlist-thumbnail {
    flex: 0 0 45%; /* Thumbnail prend 45% de la hauteur de la carte */
    position: relative;
    min-height: 360px; /* 45% de 800px */
  }

  .playlist-content {
    flex: 1; /* Contenu prend les 55% restants */
    padding: 2rem; /* Padding augment√© pour plus d'espace */
    display: flex;
    flex-direction: column;
    background: rgba(55, 65, 81, 0.95); /* Fond semi-transparent pour le contenu */
    z-index: 10;
    position: relative;
    min-height: 440px; /* Hauteur minimale pour le contenu */
    justify-content: space-between; /* Espacement optimal entre les √©l√©ments */
  }

  /* Style sp√©cifique pour le bouton */
  .playlist-button {
    background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
    color: white;
    padding: 1rem 2rem;
    border-radius: 0.5rem;
    font-weight: 600;
    font-size: 1.125rem;
    text-decoration: none;
    display: inline-block;
    transition: all 0.2s ease;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    border: 2px solid #8b5cf6;
  }

  .playlist-button:hover {
    background: linear-gradient(135deg, #7c3aed 0%, #db2777 100%);
    transform: translateY(-2px);
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
  }
</style>

<script>
function showYouTubeModal(videoId, title) {
  // Cr√©er la modal si elle n'existe pas
  let modal = document.getElementById('youtube-modal');
  if (!modal) {
    modal = document.createElement('div');
    modal.id = 'youtube-modal';
    modal.className = 'youtube-modal';
    modal.innerHTML = `
      <div class="youtube-modal-content">
        <span class="youtube-modal-close" onclick="closeYouTubeModal()">&times;</span>
        <h3 style="color: white; margin-bottom: 15px;">${title}</h3>
        <div class="youtube-iframe-container">
          <iframe src="https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0" 
                  frameborder="0" 
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                  allowfullscreen>
          </iframe>
        </div>
      </div>
    `;
    document.body.appendChild(modal);
  } else {
    // Mettre √† jour le contenu de la modal existante
    const iframe = modal.querySelector('iframe');
    const titleElement = modal.querySelector('h3');
    if (iframe) iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0`;
    if (titleElement) titleElement.textContent = title;
  }
  
  // Afficher la modal
  modal.style.display = 'block';
}

function closeYouTubeModal() {
  const modal = document.getElementById('youtube-modal');
  if (modal) {
    modal.style.display = 'none';
    // Arr√™ter la vid√©o en vidant la source de l'iframe
    const iframe = modal.querySelector('iframe');
    if (iframe) iframe.src = '';
  }
}

// Fermer la modal en cliquant en dehors
window.onclick = function(event) {
  const modal = document.getElementById('youtube-modal');
  if (event.target == modal) {
    closeYouTubeModal();
  }
}
</script> 