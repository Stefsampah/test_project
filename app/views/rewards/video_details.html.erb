<div class="min-h-screen bg-gray-900">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header avec logo -->
    <div class="text-center mb-8">
      <div class="flex items-center justify-center mb-6">
        <div class="w-16 h-16 bg-white/10 backdrop-blur-sm rounded-full flex items-center justify-center">
          <div class="w-8 h-8 text-purple-400">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M5 8h2v8H5zm7 0H9v8h3zm5 8h2V8h-2zM8 5h8v2H8z"/>
            </svg>
          </div>
        </div>
        <h1 class="text-2xl font-bold text-white ml-2">üì∫ D√©tails des Vid√©os</h1>
      </div>
      <p class="text-gray-300 text-lg">Contenu d√©taill√© de votre r√©compense</p>
    </div>

    <!-- Navigation -->
    <div class="flex justify-center mb-8">
      <div class="flex space-x-2">
        <%= link_to "‚Üê Retour √† la r√©compense", reward_path(@reward), 
            class: "px-4 py-2 rounded-lg text-sm font-medium text-gray-300 bg-gray-700 hover:bg-gray-600 transition-colors" %>
        <%= link_to "‚Üê Retour aux r√©compenses", my_rewards_path, 
            class: "px-4 py-2 rounded-lg text-sm font-medium text-gray-300 bg-gray-700 hover:bg-gray-600 transition-colors" %>
      </div>
    </div>

    <!-- Informations de la r√©compense -->
    <% if @playlist %>
      <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6 mb-8">
        <div class="text-center">
          <h2 class="text-3xl font-bold text-white mb-4"><%= @playlist.title %></h2>
          <div class="flex items-center justify-center space-x-4 mb-4">
            <span class="bg-white/20 text-white text-sm px-3 py-1 rounded-full">
              <%= @playlist.videos.count %> vid√©os
            </span>
            <span class="bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-white text-sm px-3 py-1 rounded-full">
              <%= @reward.reward_type&.humanize %>
            </span>
          </div>
          <p class="text-gray-300 text-lg">
            <%= @reward.content_type&.humanize %> - Collection exclusive d√©bloqu√©e via les r√©compenses
          </p>
        </div>
      </div>

      <!-- Liste des vid√©os -->
      <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6">
        <h3 class="text-xl font-bold text-white mb-6 text-center">üéµ Contenu de la Playlist</h3>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          <% @playlist.videos.each_with_index do |video, index| %>
            <div class="bg-gradient-to-r from-gray-700 to-gray-800 rounded-lg overflow-hidden border border-gray-600 hover:border-purple-500 transition-all duration-300 transform hover:scale-105">
              <!-- Thumbnail YouTube -->
              <div class="relative h-40 bg-gray-800">
                <img src="https://img.youtube.com/vi/<%= video.youtube_id %>/mqdefault.jpg" 
                     alt="<%= video.title %>" 
                     class="w-full h-full object-cover">
                <div class="absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center">
                  <div class="text-white text-3xl">üéµ</div>
                </div>
                <!-- Num√©ro de la vid√©o -->
                <div class="absolute top-2 left-2 bg-purple-600 text-white text-xs px-2 py-1 rounded-full font-bold">
                  #<%= index + 1 %>
                </div>
              </div>
              
              <!-- Informations de la vid√©o -->
              <div class="p-4">
                <h4 class="text-white font-semibold text-sm mb-3 line-clamp-2 leading-tight">
                  <%= video.title %>
                </h4>
                
                <% if video.description.present? %>
                  <p class="text-gray-300 text-xs mb-3 line-clamp-3 leading-relaxed">
                    <%= video.description %>
                  </p>
                <% end %>
                
                <!-- Bouton pour voir la vid√©o -->
                <div class="mt-4 text-center">
                  <button 
                     onclick="showYouTubeModal('<%= video.youtube_id %>', '<%= video.title %>')"
                     class="w-full inline-flex items-center justify-center px-8 py-4 text-lg font-medium rounded-full text-white bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700 transition-all focus:outline-none transform hover:scale-105 shadow-lg">
                    <span>üéµ Regarder la vid√©o</span>
                  </button>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Bouton pour lancer la playlist -->
      <div class="text-center mt-8">
        <% 
          # V√©rifier si l'utilisateur a d√©j√† un jeu en cours pour cette playlist
          existing_game = current_user.games.where(playlist: @playlist, completed_at: nil).last
          if existing_game
            # Si un jeu existe, continuer la partie
            playlist_game_path = playlist_game_path(@playlist, existing_game)
          else
            # Sinon, cr√©er une nouvelle partie
            playlist_game_path = new_playlist_game_path(@playlist)
          end
        %>
        <%= link_to "üéµ Lancer la Playlist", playlist_game_path, 
            class: "inline-flex items-center px-8 py-4 text-lg font-medium rounded-full text-white bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700 transition-all focus:outline-none transform hover:scale-105 shadow-lg" %>
      </div>
    <% end %>
  </div>
</div>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  /* Modal styles */
  .youtube-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.8);
  }
  
  .youtube-modal-content {
    position: relative;
    margin: 5% auto;
    padding: 20px;
    width: 80%;
    max-width: 800px;
    background-color: #1a1a1a;
    border-radius: 12px;
  }
  
  .youtube-modal-close {
    position: absolute;
    right: 15px;
    top: 10px;
    color: #aaa;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
  }
  
  .youtube-modal-close:hover {
    color: white;
  }
  
  .youtube-iframe-container {
    position: relative;
    width: 100%;
    height: 0;
    padding-bottom: 56.25%; /* 16:9 aspect ratio */
  }
  
  .youtube-iframe-container iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: 8px;
  }
</style>

<div data-controller="youtube-modal"></div>

<script>
// Fonctions de compatibilit√© pour les anciens appels
function showYouTubeModal(videoId, title) {
  const controller = document.querySelector('[data-controller*="youtube-modal"]');
  if (controller && controller.stimulusController) {
    controller.stimulusController.openModal({ params: { videoId, title } });
  }
}

function closeYouTubeModal() {
  const controller = document.querySelector('[data-controller*="youtube-modal"]');
  if (controller && controller.stimulusController) {
    controller.stimulusController.closeModal();
  }
}

// Ajouter l'√©couteur global pour Escape
document.addEventListener('keydown', function(event) {
  if (event.key === 'Escape') {
    closeYouTubeModal();
  }
});
</script>
