<div class="min-h-screen bg-gray-900">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header avec logo -->
    <div class="text-center mb-8">
      <div class="flex items-center justify-center mb-6">
        <div class="w-16 h-16 bg-white/10 backdrop-blur-sm rounded-full flex items-center justify-center">
          <div class="w-8 h-8 text-purple-400">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
          </div>
        </div>
        <h1 class="text-2xl font-bold text-white ml-2">üéÅ D√©tails de la R√©compense</h1>
      </div>
      <p class="text-gray-300 text-lg">D√©couvrez le contenu de votre r√©compense</p>
    </div>

    <!-- Navigation -->
    <div class="flex justify-center mb-8">
      <div class="flex space-x-2">
      <%= link_to "‚Üê Retour aux r√©compenses", all_rewards_path, 
            class: "px-4 py-2 rounded-lg text-sm font-medium text-gray-300 bg-gray-700 hover:bg-gray-600 transition-colors" %>
      </div>
    </div>

    <!-- Carte fusionn√©e - R√©compense et Contenu -->
    
    <% 
      # Utiliser les variables d√©finies par le contr√¥leur
      # @quantity et @reward_type sont d√©j√† d√©finis dans l'action reward_details
      
      # D√©finir la vid√©o Premium de mani√®re coh√©rente
      premium_video_id = nil
      if @quantity == 9
        user_id = current_user.id
        premium_videos = [
          '0tJz8JjPbHU', # Didi B F√©licia
          'QVvfSQP3JLM', # Didi B Bouak√©
          'JWrIfPCyedU', # Charles Dor√©
          'ICvSOFEKbgs', # Miki Accor Arena
          'ORfP-QudA1A', # Timeo
          'VFvDwn2r5RI'  # Marine
        ]
        premium_video_id = premium_videos[user_id % premium_videos.length]
      end
      
      if @sample_reward
        content_type = @sample_reward.content_type
        
        # D√©finir le contenu selon le type de r√©compense
        case @quantity
        when 3 # Challenge
          content_title = case content_type
            when 'challenge_reward_playlist_1' then 'Challenge Reward Playlist 1'
            when 'challenge_reward_playlist_2' then 'Challenge Reward Playlist 2'
            when 'challenge_reward_playlist_3' then 'Challenge Reward Playlist 3'
            when 'challenge_reward_playlist_4' then 'Challenge Reward Playlist 4'
            when 'challenge_reward_playlist_5' then 'Challenge Reward Playlist 5'
            when 'challenge_reward_playlist_6' then 'Challenge Reward Playlist 6'
            when 'challenge_reward_playlist_7' then 'Challenge Reward Playlist 7'
            when 'challenge_reward_playlist_8' then 'Challenge Reward Playlist 8'
            when 'challenge_reward_playlist_9' then 'Challenge Reward Playlist 9'
            when 'challenge_reward_playlist_10' then 'Challenge Reward Playlist 10'
            when 'challenge_reward_playlist_11' then 'Challenge Reward Playlist 11'
            when 'challenge_reward_playlist_12' then 'Challenge Reward Playlist 12'
            when 'challenge_reward_playlist_13' then 'Challenge Reward Playlist 13'
            when 'challenge_reward_playlist_14' then 'Challenge Reward Playlist 14'
            when 'challenge_reward_playlist_15' then 'Challenge Reward Playlist 15'
            else 'Challenge Reward Playlist'
            end
          content_subtitle = 'Playlist Challenge'
          content_icon = 'üéµ'
          content_description = 'Playlist exclusive d√©bloqu√©e via les r√©compenses challenge'
          video_count = '10 vid√©os'
          badge_icon = 'ü•â'
          reward_level = 'Challenge'
          
        when 6 # Exclusif
          content_title = case content_type
            when 'didi_b_nouvelle_generation' then 'DIDI B EN STUDIO AVEC LA NOUVELLE G√âN√âRATION'
            when 'didi_b_interview' then 'DIDI B - INTERVIEW EXCLUSIVE'
            when 'himra_legendes_urbaines' then 'HIMRA - L√âGENDES URBAINES'
            when 'zoh_cataleya_serge_dioman' then 'ZOH CATALEYA & SERGE DIOMAN'
            when 'do_it_together' then 'DO IT TOGETHER - COLLABORATION'
            when 'rumble_indians' then 'RUMBLE INDIANS - LIVE SESSION'
            when 'country_music_ken_burns' then 'COUNTRY MUSIC - KEN BURNS'
            when 'rap_odyssees_france_tv' then 'RAP ODYSSEES - FRANCE TV'
            when 'himra_number_one_live' then 'HIMRA - NUMBER ONE LIVE'
            when 'zoh_cataleya_live_toura' then 'ZOH CATALEYA - LIVE TOURA'
            when 'bigyne_wiz_abe_sounogola' then 'BIGYNE, WIZ & ABE SOUNOGOLA'
            when 'didi_b_mhd_studio' then 'DIDI B & MHD - STUDIO SESSION'
            when 'didi_b_naira_marley' then 'DIDI B & NAIRA MARLEY'
            when 'didi_b_enregistrement' then 'DIDI B - ENREGISTREMENT STUDIO'
            when 'werenoi_cstar_session' then 'WERENOI - CSTAR SESSION'
            when 'himra_top_boy_live' then 'HIMRA - TOP BOY LIVE'
            when 'timar_zz_lequel' then 'TIMAR ZZ & LEQUEL'
            when 'octogone_philipayne' then 'OCTOGONE - PHILIP AYNE'
            else 'Contenu Exclusif'
            end
          content_subtitle = case content_type
            when /didi_b/ then 'Session Studio'
            when /himra/ then 'Live Performance'
            when /zoh_cataleya/ then 'Collaboration'
            when /studio/ then 'Studio Session'
            when /live/ then 'Live Session'
            when /interview/ then 'Interview Exclusive'
            when /documentary/ then 'Documentary'
            else 'Contenu Exclusif'
            end
          content_icon = case content_type
            when /didi_b/ then 'üéπ'
            when /himra/ then 'üé§'
            when /zoh_cataleya/ then 'üéµ'
            when /studio/ then 'üéπ'
            when /live/ then 'üé§'
            when /interview/ then 'üéôÔ∏è'
            when /documentary/ then 'üìπ'
            else '‚≠ê'
            end
          content_description = case content_type
            when 'didi_b_nouvelle_generation' then 'Session studio avec Didi B et d\'autres artistes'
            when 'didi_b_interview' then 'Interview exclusive avec Didi B sur sa carri√®re'
            when 'himra_legendes_urbaines' then 'Performance live de Himra en concert'
            when 'zoh_cataleya_serge_dioman' then 'Collaboration entre Zoh Cataleya et Serge Dioman'
            when 'do_it_together' then 'Session studio collaborative entre artistes'
            when 'rumble_indians' then 'Session live des Rumble Indians'
            when 'country_music_ken_burns' then 'Documentaire sur la musique country'
            when 'rap_odyssees_france_tv' then '√âmission TV sur le rap fran√ßais'
            when 'himra_number_one_live' then 'Performance live de Himra'
            when 'zoh_cataleya_live_toura' then 'Extrait live de la tourn√©e de Zoh Cataleya'
            when 'bigyne_wiz_abe_sounogola' then 'Session studio avec Bigyne, Wiz et Abe Sounogola'
            when 'didi_b_mhd_studio' then 'Session studio avec Didi B et MHD'
            when 'didi_b_naira_marley' then 'Session studio avec Didi B et Naira Marley'
            when 'didi_b_enregistrement' then 'Session d\'enregistrement studio avec Didi B'
            when 'werenoi_cstar_session' then 'Session CSTAR avec Werenoi'
            when 'himra_top_boy_live' then 'Performance live de Himra'
            when 'timar_zz_lequel' then 'Collaboration entre Timar ZZ et Lequel'
            when 'octogone_philipayne' then 'Performance live de Philip Ayne'
            else 'Contenu exclusif et surprise - le d√©tail exact reste myst√©rieux jusqu\'√† l\'acc√®s !'
            end
          video_count = 'Session exclusive'
          badge_icon = 'ü•à'
          reward_level = 'Exclusif'
          
        when 9 # Premium
          # Utiliser la m√™me logique que get_premium_preview_image pour la coh√©rence
          user_id = current_user.id
          premium_images = [
            'https://img.youtube.com/vi/0tJz8JjPbHU/maxresdefault.jpg', # Didi B F√©licia
            'https://img.youtube.com/vi/QVvfSQP3JLM/maxresdefault.jpg', # Didi B Bouak√©
            'https://img.youtube.com/vi/JWrIfPCyedU/maxresdefault.jpg', # Charles Dor√©
            'https://img.youtube.com/vi/ICvSOFEKbgs/maxresdefault.jpg', # Miki Accor Arena
            'https://img.youtube.com/vi/ORfP-QudA1A/maxresdefault.jpg', # Timeo
            'https://img.youtube.com/vi/VFvDwn2r5RI/maxresdefault.jpg'  # Marine
          ]
          
          selected_image_index = user_id % premium_images.length
          selected_image = premium_images[selected_image_index]
          
          # D√©finir le contenu selon l'image s√©lectionn√©e
          case selected_image
          when 'https://img.youtube.com/vi/0tJz8JjPbHU/maxresdefault.jpg' # Didi B F√©licia
            content_title = 'DIDI B - F√âLICIA (CLIP OFFICIEL)'
            content_description = 'Clip officiel de "F√©licia" avec Didi B - Contenu premium exclusif'
            video_count = 'Clip Officiel'
          when 'https://img.youtube.com/vi/QVvfSQP3JLM/maxresdefault.jpg' # Didi B Bouak√©
            content_title = 'DIDI B - BOUAK√â (CLIP OFFICIEL)'
            content_description = 'Clip officiel de "Bouak√©" avec Didi B - Contenu premium exclusif'
            video_count = 'Clip Officiel'
          when 'https://img.youtube.com/vi/JWrIfPCyedU/maxresdefault.jpg' # Charles Dor√©
            content_title = 'CHARLES DOR√â - JE PARS MAIS JE RESTE'
            content_description = 'Session acoustique intimiste avec Charles Dor√© - Contenu premium exclusif'
            video_count = 'Session Acoustique'
          when 'https://img.youtube.com/vi/ICvSOFEKbgs/maxresdefault.jpg' # Miki Accor Arena
            content_title = 'MIKI - PARTICULE (LIVE ACCOR ARENA)'
            content_description = 'Performance live de "Particule" √† l\'Accor Arena - Contenu premium exclusif'
            video_count = 'Live Arena'
          when 'https://img.youtube.com/vi/ORfP-QudA1A/maxresdefault.jpg' # Timeo
            content_title = 'TIMEO - SI JE M\'EN VAIS (CLIP OFFICIEL)'
            content_description = 'Clip officiel de "Si je m\'en vais" avec Timeo - Contenu premium exclusif'
            video_count = 'Clip Officiel'
          when 'https://img.youtube.com/vi/VFvDwn2r5RI/maxresdefault.jpg' # Marine
            content_title = 'MARINE - C≈íUR MALADROIT (CLIP OFFICIEL)'
            content_description = 'Clip officiel de "C≈ìur maladroit" avec Marine - Contenu premium exclusif'
            video_count = 'Clip Officiel'
          else
            content_title = 'Contenu Premium Exclusif'
            content_description = 'Contenu premium exclusif d√©bloqu√© via les r√©compenses premium'
            video_count = 'Contenu premium'
          end
          
          content_subtitle = 'Session Premium'
          content_icon = 'üëë'
          badge_icon = 'ü•á'
          reward_level = 'Premium'
          
        when 12 # Ultime
          content_title = 'Contenu Ultime Exclusif'
          content_subtitle = 'Session Ultime'
          content_icon = 'üèÜ'
          content_description = 'Contenu ultime exclusif d√©bloqu√© via les r√©compenses ultimes'
          video_count = 'Contenu ultime'
          badge_icon = 'üåà'
          reward_level = 'Ultime'
          
          # D√©terminer le content_type de la r√©compense ultime de l'utilisateur
          ultime_reward = current_user.rewards.where(reward_type: 'ultime', unlocked: true).first
          if ultime_reward
            case ultime_reward.content_type
            when 'backstage_real'
              content_title = 'BACKSTAGE R√âEL - EXP√âRIENCE EXCLUSIVE'
              content_description = 'Acc√®s exclusif aux coulisses r√©elles d\'un concert - Exp√©rience backstage authentique'
              video_count = 'Backstage R√©el'
            when 'concert_invitation'
              content_title = 'INVITATION CONCERT EXCLUSIVE'
              content_description = 'Invitation exclusive √† un concert pr√®s de chez vous - Acc√®s privil√©gi√© garanti'
              video_count = 'Invitation Concert'
            when 'vip_experience'
              content_title = 'EXP√âRIENCE VIP - RENCONTRE PRIV√âE'
              content_description = 'Rencontre priv√©e avec un artiste + acc√®s backstage r√©el - Exp√©rience VIP exclusive'
              video_count = 'Exp√©rience VIP'
            else
              content_description = 'Contenu ultime exclusif d√©bloqu√© via les r√©compenses ultimes'
              video_count = 'Contenu ultime'
            end
          end
          
        else
          content_title = 'Contenu Exclusif'
          content_subtitle = 'Session Exclusive'
          content_icon = '‚≠ê'
          content_description = 'Contenu exclusif d√©bloqu√© via les r√©compenses'
          video_count = 'Contenu exclusif'
          badge_icon = '‚≠ê'
          reward_level = 'Exclusif'
        end
        
        # Image de fond selon le type de contenu
        background_image = case content_type
          when 'didi_b_nouvelle_generation' then 'https://img.youtube.com/vi/9ECNWJ1R0fg/maxresdefault.jpg'
          when 'himra_legendes_urbaines' then 'https://img.youtube.com/vi/qB7kLilZWwg/maxresdefault.jpg'
          when /challenge_reward_playlist_/ then 'https://img.youtube.com/vi/qB7kLilZWwg/maxresdefault.jpg'
          else
            # Pour les r√©compenses premium (9 badges), utiliser la m√™me logique que le helper
            if @quantity == 9
              # Utiliser la m√™me logique que get_premium_preview_image pour la coh√©rence
              user_id = current_user.id
              premium_images = [
                'https://img.youtube.com/vi/0tJz8JjPbHU/maxresdefault.jpg', # Didi B F√©licia
                'https://img.youtube.com/vi/QVvfSQP3JLM/maxresdefault.jpg', # Didi B Bouak√©
                'https://img.youtube.com/vi/JWrIfPCyedU/maxresdefault.jpg', # Charles Dor√©
                'https://img.youtube.com/vi/ICvSOFEKbgs/maxresdefault.jpg', # Miki Accor Arena
                'https://img.youtube.com/vi/ORfP-QudA1A/maxresdefault.jpg', # Timeo
                'https://img.youtube.com/vi/VFvDwn2r5RI/maxresdefault.jpg'  # Marine
              ]
              
              # S√©lection bas√©e sur l'ID utilisateur pour la coh√©rence
              premium_images[user_id % premium_images.length]
            # Pour les r√©compenses ultimes (12 badges), utiliser la m√™me logique que le helper
            elsif @quantity == 12
              # Utiliser la m√™me logique que get_ultime_preview_image pour la coh√©rence
              user_id = current_user.id
              ultime_images = [
                # Backstage r√©el
                '/assets/rewards/ultime/backstage_real/backstage_concert_1.jpg',
                '/assets/rewards/ultime/backstage_real/backstage_concert_2.jpg',
                '/assets/rewards/ultime/backstage_real/backstage_concert_3.jpg',
                '/assets/rewards/ultime/backstage_real/backstage_concert_4.jpg',
                # Invitation concert
                '/assets/rewards/ultime/concert_invitation/concert_stage_1.jpg',
                '/assets/rewards/ultime/concert_invitation/concert_stage_2.jpg',
                '/assets/rewards/ultime/concert_invitation/concert_stage_3.jpg',
                '/assets/rewards/ultime/concert_invitation/concert_stage_4.jpg',
                # Exp√©rience VIP
                '/assets/rewards/ultime/vip_experience/vip_meeting_1.jpg',
                '/assets/rewards/ultime/vip_experience/vip_meeting_2.jpg',
                '/assets/rewards/ultime/vip_experience/vip_meeting_3.jpg',
                '/assets/rewards/ultime/vip_experience/vip_meeting_4.jpg'
              ]
              
              # S√©lection bas√©e sur l'ID utilisateur pour la coh√©rence
              ultime_images[user_id % ultime_images.length]
            else
              'https://img.youtube.com/vi/9ECNWJ1R0fg/maxresdefault.jpg'
            end
        end
        
        fallback_image = case content_type
          when 'didi_b_nouvelle_generation' then 'https://img.youtube.com/vi/9ECNWJ1R0fg/hqdefault.jpg'
          when 'himra_legendes_urbaines' then 'https://img.youtube.com/vi/qB7kLilZWwg/hqdefault.jpg'
          when /challenge_reward_playlist_/ then 'https://img.youtube.com/vi/qB7kLilZWwg/hqdefault.jpg'
          else 
            # Pour les r√©compenses ultimes, utiliser une image locale comme fallback
            if @quantity == 12
              '/assets/rewards/ultime/backstage_real/backstage_concert_1.jpg'
            else
              'https://img.youtube.com/vi/9ECNWJ1R0fg/hqdefault.jpg'
            end
          end
    %>
    
    <!-- Carte fusionn√©e - R√©compense et Contenu -->
    <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6 mb-8">
      <div class="bg-gradient-to-r from-gray-700 to-gray-800 rounded-lg overflow-visible border border-gray-600 playlist-card">
        <!-- Banni√®re avec thumbnail dynamique -->
        <div class="playlist-thumbnail relative flex items-center justify-center overflow-hidden">
          
          <!-- Thumbnail en arri√®re-plan -->
          <div class="absolute inset-0 w-full h-full">
            <img src="<%= background_image %>" alt="<%= content_title %>" class="w-full h-full object-cover" style="opacity: 0.7;" onerror="this.onerror=null; this.src='<%= fallback_image %>'; this.style.opacity='0.7';" onload="this.style.opacity='0.7';">
            <div class="absolute inset-0 bg-gradient-to-r from-purple-500/30 to-pink-600/30"></div>
          </div>
          
          <!-- Contenu superpos√© -->
          <div class="relative z-10 text-center">
            <div class="text-white text-6xl mb-2"><%= content_icon %></div>
            <div class="text-white font-semibold text-2xl mb-2"><%= content_title %></div>
            <% if @quantity == 3 %>
              <div class="text-white text-lg"><%= content_subtitle %></div>
            <% end %>
        </div>

          <!-- Badge nombre de vid√©os ou type de contenu -->
          <div class="absolute top-3 right-3">
            <span class="bg-white/20 text-white text-xs px-2 py-1 rounded-full"><%= video_count %></span>
          </div>
          </div>

        <!-- Contenu de la r√©compense -->
        <div class="playlist-content p-6">
          <!-- Informations de la r√©compense -->
          <div class="mb-4">
            <div class="mb-2">
              <h3 class="text-lg font-bold text-white"><%= content_title %></h3>
            </div>
            <div class="text-xs text-gray-400">D√©bloqu√© le <%= Date.current.strftime('%d/%m/%Y') %></div>
          </div>

          <!-- Statistiques combin√©es -->
          <div class="grid grid-cols-2 gap-3 mb-6">
            <div class="text-center">
              <div class="text-lg font-bold text-white"><%= @quantity %></div>
              <div class="text-xs text-gray-300">Badges requis</div>
            </div>
            <div class="text-center">
              <div class="text-lg font-bold text-white">
                ‚úÖ
              </div>
              <div class="text-xs text-gray-300">
                D√©bloqu√©
              </div>
                </div>
          </div>
          
          <!-- Description -->
          <div class="mb-6">
            <p class="text-gray-300 text-sm text-center"><%= content_description %></p>
          </div>
          

            
          <!-- Bouton d'action -->
          <div class="text-center mt-auto space-y-4">
            <% if @current_count && @current_count >= @quantity %>
              <% if @quantity == 3 %>
                <!-- Pour les playlists challenge -->
                <a class="playlist-button" href="/playlists/31/games/new">üéµ √âcouter la playlist</a>
                <a class="playlist-button" href="/rewards/32/video_details">üéµ D√©tails des vid√©os</a>
              <% else %>
                <!-- Pour les autres types de r√©compenses -->
                <% if @sample_reward && @sample_reward.reward_type == 'exclusif' %>
                  <%
                    video_id = case @sample_reward.content_type
                               when 'didi_b_nouvelle_generation' then '9ECNWJ1R0fg'
                               when 'didi_b_interview' then 'dQw4w9WgXcQ'
                               when 'himra_legendes_urbaines' then 'qB7kLilZWwg'
                               else nil
                               end
                  %>
                  <button class="playlist-button" onclick="showExclusifVideo('<%= video_id %>', '<%= content_title %>')">
                    <%= case content_type
                        when /challenge_reward_playlist_/ then 'üéµ √âcouter la playlist'
                        when /studio/ then 'üéπ Regarder la session'
                        when /live/ then 'üé§ Regarder le live'
                        when /interview/ then 'üéôÔ∏è √âcouter l\'interview'
                        when /documentary/ then 'üìπ Regarder le documentaire'
                        else 'üé¨ Regarder le contenu'
                        end %>
                  </button>
                <% elsif @sample_reward && @sample_reward.reward_type == 'premium' %>
                  <!-- Pour les r√©compenses premium -->
                  <button class="playlist-button" onclick="showExclusifVideo('<%= premium_video_id %>', '<%= content_title %>')">
                    üé¨ Regarder le contenu
                  </button>
                <% else %>
                  <a class="playlist-button" href="#">
                    <%= case content_type
                        when /challenge_reward_playlist_/ then 'üéµ √âcouter la playlist'
                        when /studio/ then 'üéπ Regarder la session'
                        when /live/ then 'üé§ Regarder le live'
                        when /interview/ then 'üéôÔ∏è √âcouter l\'interview'
                        when /documentary/ then 'üìπ Regarder le documentaire'
                        else 'üé¨ Regarder le contenu'
                        end %>
                  </a>
                <% end %>
              <% end %>
            <% elsif @sample_reward && @sample_reward.unlocked %>
              <!-- Si la r√©compense est d√©bloqu√©e, afficher les boutons m√™me si la condition de badges n'est pas satisfaite -->
              <% if @quantity == 3 %>
                <!-- Pour les playlists challenge -->
                <a class="playlist-button" href="/playlists/31/games/new">üéµ √âcouter la playlist</a>
                <a class="playlist-button" href="/rewards/32/video_details">üéµ D√©tails des vid√©os</a>
              <% else %>
                <!-- Pour les autres types de r√©compenses -->
                <% if @sample_reward && @sample_reward.reward_type == 'exclusif' %>
                  <%
                    video_id = case @sample_reward.content_type
                               when 'didi_b_nouvelle_generation' then '9ECNWJ1R0fg'
                               when 'didi_b_interview' then 'dQw4w9WgXcQ'
                               when 'himra_legendes_urbaines' then 'qB7kLilZWwg'
                               else nil
                               end
                  %>
                  <button class="playlist-button" onclick="showExclusifVideo('<%= video_id %>', '<%= content_title %>')">
                    <%= case content_type
                        when /challenge_reward_playlist_/ then 'üéµ √âcouter la playlist'
                        when /studio/ then 'üéπ Regarder la session'
                        when /live/ then 'üé§ Regarder le live'
                        when /interview/ then 'üéôÔ∏è √âcouter l\'interview'
                        when /documentary/ then 'üìπ Regarder le documentaire'
                        else 'üé¨ Regarder le contenu'
                        end %>
                  </button>
                <% elsif @sample_reward && @sample_reward.reward_type == 'premium' %>
                  <!-- Pour les r√©compenses premium -->
                  <button class="playlist-button" onclick="showExclusifVideo('<%= premium_video_id %>', '<%= content_title %>')">
                    üé¨ Regarder le contenu
                  </button>
                <% elsif @sample_reward && @sample_reward.reward_type == 'ultime' %>
                  <!-- Pour les r√©compenses ultimes -->
                  <%
                    video_id = case @sample_reward.content_type
                               when 'backstage_real' then '0tJz8JjPbHU' # Didi B (fallback)
                               when 'concert_invitation' then 'QVvfSQP3JLM' # Didi B Bouak√© (fallback)
                               when 'vip_experience' then 'ICvSOFEKbgs' # Miki (fallback)
                               else nil
                               end
                  %>
                  <button class="playlist-button" onclick="showUltimeGallery('<%= @sample_reward.content_type %>', '<%= content_title %>')">
                    üñºÔ∏è Voir la galerie
                  </button>
                <% else %>
                  <a class="playlist-button" href="#">
                    <%= case content_type
                        when /challenge_reward_playlist_/ then 'üéµ √âcouter la playlist'
                        when /studio/ then 'üéπ Regarder la session'
                        when /live/ then 'üé§ Regarder le live'
                        when /interview/ then 'üéôÔ∏è √âcouter l\'interview'
                        when /documentary/ then 'üìπ Regarder le documentaire'
                        else 'üé¨ Regarder le contenu'
                        end %>
                  </a>
                <% end %>
              <% end %>
            <% else %>
              <div class="text-center py-3 bg-gray-600/20 rounded-lg">
                <p class="text-gray-400 text-sm">Collectez <%= @quantity - (@current_count || 0) %> badge(s) suppl√©mentaires pour d√©bloquer ce contenu</p>
              </div>
            <% end %>
          </div>
        </div>
          </div>
        </div>

          <% else %>
    <!-- Message si aucune r√©compense n'est trouv√©e -->
    <div class="text-center py-12">
      <div class="text-6xl mb-4">üéÅ</div>
      <h2 class="text-2xl font-bold text-white mb-4">Aucune r√©compense trouv√©e</h2>
      <p class="text-gray-300 mb-6">Collectez plus de badges pour d√©bloquer des r√©compenses</p>
              <%= link_to "Jouer pour gagner des badges", playlists_path, 
                  class: "inline-block bg-gradient-to-r from-blue-500 to-purple-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform hover:scale-105 transition-all duration-200" %>
            </div>
          <% end %>
        </div>
      </div>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .playlist-card {
    display: flex;
    flex-direction: column;
    height: 800px; /* Hauteur augment√©e pour accommoder les deux boutons */
  }

  .playlist-thumbnail {
    flex: 0 0 45%; /* Thumbnail prend 45% de la hauteur de la carte */
    position: relative;
    min-height: 360px; /* 45% de 800px */
  }

  .playlist-content {
    flex: 1; /* Contenu prend les 55% restants */
    padding: 2rem; /* Padding augment√© pour plus d'espace */
    display: flex;
    flex-direction: column;
    background: rgba(55, 65, 81, 0.95); /* Fond semi-transparent pour le contenu */
    z-index: 10;
    position: relative;
    min-height: 440px; /* Hauteur minimale pour le contenu */
    justify-content: space-between; /* Espacement optimal entre les √©l√©ments */
  }

  /* Style sp√©cifique pour le bouton */
  .playlist-button {
    background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
    color: white;
    padding: 1rem 2rem;
    border-radius: 0.5rem;
    font-weight: 600;
    font-size: 1.125rem;
    text-decoration: none;
    display: inline-block;
    transition: all 0.2s ease;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    border: 2px solid #8b5cf6;
    cursor: pointer;
  }

  .playlist-button:hover {
    background: linear-gradient(135deg, #7c3aed 0%, #db2777 100%);
    transform: translateY(-2px);
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
  }

  /* Modal styles pour contenu exclusif */
  .exclusif-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.8);
  }
  
  .exclusif-modal-content {
    position: relative;
    margin: 5% auto;
    padding: 20px;
    width: 80%;
    max-width: 800px;
    background-color: #1a1a1a;
    border-radius: 12px;
  }
  
  .exclusif-modal-close {
    position: absolute;
    right: 15px;
    top: 10px;
    color: #aaa;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
  }
  
  .exclusif-modal-close:hover {
    color: white;
  }
  
  .exclusif-iframe-container {
    position: relative;
    width: 100%;
    height: 0;
    padding-bottom: 56.25%; /* 16:9 aspect ratio */
  }
  
  .exclusif-iframe-container iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: 8px;
  }

  /* Styles pour la galerie d'images ultimes */
  .ultime-gallery-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 10px;
    padding: 10px;
  }

  .gallery-item {
    position: relative;
    width: 100%;
    height: 150px; /* Hauteur fixe pour les images */
    overflow: hidden;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  }

  .gallery-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .gallery-item:hover .gallery-image {
    transform: scale(1.1);
  }
</style>

<script>
// Variables ERB pour les chemins d'assets ultimes
const ULTIME_IMAGES = {
  backstage_real: [
    '/assets/rewards/ultime/backstage_real/backstage_concert_1.jpg',
    '/assets/rewards/ultime/backstage_real/backstage_concert_2.jpg',
    '/assets/rewards/ultime/backstage_real/backstage_concert_3.jpg',
    '/assets/rewards/ultime/backstage_real/backstage_concert_4.jpg'
  ],
  concert_invitation: [
    '/assets/rewards/ultime/concert_invitation/concert_stage_1.jpg',
    '/assets/rewards/ultime/concert_invitation/concert_stage_2.jpg',
    '/assets/rewards/ultime/concert_invitation/concert_stage_3.jpg',
    '/assets/rewards/ultime/concert_invitation/concert_stage_4.jpg'
  ],
  vip_experience: [
    '/assets/rewards/ultime/vip_experience/vip_meeting_1.jpg',
    '/assets/rewards/ultime/vip_experience/vip_meeting_2.jpg',
    '/assets/rewards/ultime/vip_experience/vip_meeting_3.jpg',
    '/assets/rewards/ultime/vip_experience/vip_meeting_4.jpg'
  ]
};

function showExclusifVideo(videoId, title) {
  if (!videoId) {
    alert('Vid√©o non disponible pour le moment');
    return;
  }

  // Cr√©er la modal si elle n'existe pas
  let modal = document.getElementById('exclusif-modal');
  if (!modal) {
    modal = document.createElement('div');
    modal.id = 'exclusif-modal';
    modal.className = 'exclusif-modal';
    modal.innerHTML = `
      <div class="exclusif-modal-content">
        <span class="exclusif-modal-close" onclick="closeExclusifModal()">&times;</span>
        <h3 style="color: white; margin-bottom: 15px;">${title}</h3>
        <div class="exclusif-iframe-container">
          <iframe src="https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0" 
                  frameborder="0" 
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                  allowfullscreen>
          </iframe>
        </div>
      </div>
    `;
    document.body.appendChild(modal);
  } else {
    // Mettre √† jour le contenu de la modal existante
    const iframe = modal.querySelector('iframe');
    const titleElement = modal.querySelector('h3');
    if (iframe) iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0`;
    if (titleElement) titleElement.textContent = title;
  }
  
  // Afficher la modal
  modal.style.display = 'block';
}

function showUltimeGallery(contentType, title) {
  // Utiliser les variables ERB pour les chemins d'assets
  let images = ULTIME_IMAGES[contentType] || ULTIME_IMAGES.backstage_real;
  let galleryTitle = '';
  
  switch(contentType) {
    case 'backstage_real':
      galleryTitle = 'Galerie Backstage R√©el';
      break;
    case 'concert_invitation':
      galleryTitle = 'Galerie Invitation Concert';
      break;
    case 'vip_experience':
      galleryTitle = 'Galerie Exp√©rience VIP';
      break;
    default:
      galleryTitle = 'Galerie Ultime';
  }

  // Cr√©er la modal pour la galerie d'images
  let modal = document.getElementById('ultime-gallery-modal');
  if (!modal) {
    modal = document.createElement('div');
    modal.id = 'ultime-gallery-modal';
    modal.className = 'exclusif-modal'; // R√©utiliser le style existant
    modal.innerHTML = `
      <div class="exclusif-modal-content">
        <span class="exclusif-modal-close" onclick="closeUltimeGalleryModal()">&times;</span>
        <h3 style="color: white; margin-bottom: 15px;">${title}</h3>
        <h4 style="color: #FF69B4; margin-bottom: 20px; text-align: center;">${galleryTitle}</h4>
        <div class="ultime-gallery-container">
          ${images.map((img, index) => `
            <div class="gallery-item">
              <img src="${img}" 
                   alt="Image ${index + 1}" 
                   class="gallery-image"
                   onerror="this.onerror=null; this.src='https://via.placeholder.com/300x200/FF69B4/FFFFFF?text=Image+${index + 1}';">
            </div>
          `).join('')}
        </div>
      </div>
    `;
    document.body.appendChild(modal);
  } else {
    // Mettre √† jour le contenu de la modal existante
    const titleElement = modal.querySelector('h3');
    const subtitleElement = modal.querySelector('h4');
    const galleryContainer = modal.querySelector('.ultime-gallery-container');
    
    if (titleElement) titleElement.textContent = title;
    if (subtitleElement) subtitleElement.textContent = galleryTitle;
    if (galleryContainer) {
      galleryContainer.innerHTML = images.map((img, index) => `
        <div class="gallery-item">
          <img src="${img}" 
               alt="Image ${index + 1}" 
               class="gallery-image"
               onerror="this.onerror=null; this.src='https://via.placeholder.com/300x200/FF69B4/FFFFFF?text=Image+${index + 1}';">
        </div>
      `).join('');
    }
  }
  
  // Afficher la modal
  modal.style.display = 'block';
}

function closeExclusifModal() {
  const modal = document.getElementById('exclusif-modal');
  if (modal) {
    modal.style.display = 'none';
    // Arr√™ter la vid√©o en vidant la source de l'iframe
    const iframe = modal.querySelector('iframe');
    if (iframe) iframe.src = '';
  }
}

function closeUltimeGalleryModal() {
  const modal = document.getElementById('ultime-gallery-modal');
  if (modal) {
    modal.style.display = 'none';
  }
}

// Fermer la modal en cliquant en dehors
window.onclick = function(event) {
  const modal = document.getElementById('exclusif-modal');
  if (event.target == modal) {
    closeExclusifModal();
  }
  const ultimeGalleryModal = document.getElementById('ultime-gallery-modal');
  if (event.target == ultimeGalleryModal) {
    closeUltimeGalleryModal();
  }
}
</script> 