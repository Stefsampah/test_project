<% content_for :title, "Admin - Test des Animations" %>

<div class="min-h-screen bg-gray-900 text-white">
  <div class="max-w-7xl mx-auto px-4 py-8">
    <div class="mb-8">
      <h1 class="text-4xl font-bold mb-4">Admin - Test des Animations</h1>
      <p class="text-gray-400">Interface d'administration pour tester les animations de r√©compenses et badges</p>
    </div>

    <!-- Alertes -->
    <% if flash[:success] %>
      <div class="bg-purple-600 text-white p-4 rounded-lg mb-6">
        ‚úÖ <%= flash[:success] %>
      </div>
    <% end %>

    <% if flash[:error] %>
      <div class="bg-red-600 text-white p-4 rounded-lg mb-6">
        ‚ùå <%= flash[:error] %>
      </div>
    <% end %>

    <!-- Informations utilisateur -->
    <div class="bg-gray-800 rounded-lg p-6 mb-8">
      <h2 class="text-2xl font-bold mb-4">üë§ Utilisateur de test</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <span class="text-gray-400">Email:</span>
          <span class="text-white font-semibold"><%= @user.email %></span>
        </div>
        <div>
          <span class="text-gray-400">ID:</span>
          <span class="text-white font-semibold"><%= @user.id %></span>
        </div>
        <div>
          <span class="text-gray-400">Admin:</span>
          <span class="text-white font-semibold"><%= @user.admin? ? "‚úÖ Oui" : "‚ùå Non" %></span>
        </div>
      </div>
    </div>

    <!-- Tests d'animations de r√©compenses -->
    <div class="bg-gray-800 rounded-lg p-6 mb-8">
      <h2 class="text-2xl font-bold mb-4">üéâ Tests d'animations de r√©compenses</h2>
      
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
        <%= link_to admin_animations_test_reward_animation_path(type: 'challenge'), 
            method: :post, 
            class: "bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-center transition-colors" do %>
          <div class="text-lg">üéØ</div>
          <div>Challenge</div>
        <% end %>
        
        <%= link_to admin_animations_test_reward_animation_path(type: 'exclusif'), 
            method: :post, 
            class: "bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-center transition-colors" do %>
          <div class="text-lg">‚≠ê</div>
          <div>Exclusif</div>
        <% end %>
        
        <%= link_to admin_animations_test_reward_animation_path(type: 'premium'), 
            method: :post, 
            class: "bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg text-center transition-colors" do %>
          <div class="text-lg">üëë</div>
          <div>Premium</div>
        <% end %>
        
        <%= link_to admin_animations_test_reward_animation_path(type: 'ultime'), 
            method: :post, 
            class: "bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-center transition-colors" do %>
          <div class="text-lg">üèÜ</div>
          <div>Ultime</div>
        <% end %>
      </div>
    </div>

    <!-- Tests d'animations de badges -->
    <div class="bg-gray-800 rounded-lg p-6 mb-8">
      <h2 class="text-2xl font-bold mb-4">üèÜ Tests d'animations de badges</h2>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Competitor -->
        <div class="bg-gray-700 rounded-lg p-4">
          <h3 class="text-lg font-semibold mb-3 text-blue-400">üèÜ Competitor</h3>
          <div class="grid grid-cols-3 gap-2">
            <%= link_to admin_animations_test_badge_animation_path(type: 'competitor', level: 'bronze'), 
                method: :post, 
                class: "bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-2 rounded text-center text-sm transition-colors" do %>
              Bronze
            <% end %>
            <%= link_to admin_animations_test_badge_animation_path(type: 'competitor', level: 'silver'), 
                method: :post, 
                class: "bg-gray-400 hover:bg-gray-500 text-white px-3 py-2 rounded text-center text-sm transition-colors" do %>
              Silver
            <% end %>
            <%= link_to admin_animations_test_badge_animation_path(type: 'competitor', level: 'gold'), 
                method: :post, 
                class: "bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-2 rounded text-center text-sm transition-colors" do %>
              Gold
            <% end %>
          </div>
        </div>

        <!-- Engager -->
        <div class="bg-gray-700 rounded-lg p-4">
          <h3 class="text-lg font-semibold mb-3 text-purple-400">üéÆ Engager</h3>
          <div class="grid grid-cols-3 gap-2">
            <%= link_to admin_animations_test_badge_animation_path(type: 'engager', level: 'bronze'), 
                method: :post, 
                class: "bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-2 rounded text-center text-sm transition-colors" do %>
              Bronze
            <% end %>
            <%= link_to admin_animations_test_badge_animation_path(type: 'engager', level: 'silver'), 
                method: :post, 
                class: "bg-gray-400 hover:bg-gray-500 text-white px-3 py-2 rounded text-center text-sm transition-colors" do %>
              Silver
            <% end %>
            <%= link_to admin_animations_test_badge_animation_path(type: 'engager', level: 'gold'), 
                method: :post, 
                class: "bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-2 rounded text-center text-sm transition-colors" do %>
              Gold
            <% end %>
          </div>
        </div>

        <!-- Critic -->
        <div class="bg-gray-700 rounded-lg p-4">
          <h3 class="text-lg font-semibold mb-3 text-purple-400">üéØ Critic</h3>
          <div class="grid grid-cols-3 gap-2">
            <%= link_to admin_animations_test_badge_animation_path(type: 'critic', level: 'bronze'), 
                method: :post, 
                class: "bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-2 rounded text-center text-sm transition-colors" do %>
              Bronze
            <% end %>
            <%= link_to admin_animations_test_badge_animation_path(type: 'critic', level: 'silver'), 
                method: :post, 
                class: "bg-gray-400 hover:bg-gray-500 text-white px-3 py-2 rounded text-center text-sm transition-colors" do %>
              Silver
            <% end %>
            <%= link_to admin_animations_test_badge_animation_path(type: 'critic', level: 'gold'), 
                method: :post, 
                class: "bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-2 rounded text-center text-sm transition-colors" do %>
              Gold
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <!-- Donn√©es r√©centes -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
      <!-- R√©compenses r√©centes -->
      <div class="bg-gray-800 rounded-lg p-6">
        <h2 class="text-xl font-bold mb-4">üì¶ R√©compenses r√©centes</h2>
        <% if @recent_rewards.any? %>
          <div class="space-y-3">
            <% @recent_rewards.each do |reward| %>
              <div class="bg-gray-700 rounded-lg p-3">
                <div class="flex justify-between items-center">
                  <div>
                    <div class="font-semibold"><%= reward.reward_description %></div>
                    <div class="text-sm text-gray-400"><%= reward.reward_type.humanize %></div>
                  </div>
                  <div class="text-right">
                    <div class="text-sm <%= reward.unlocked? ? 'text-purple-400' : 'text-gray-400' %>">
                      <%= reward.unlocked? ? '‚úÖ D√©bloqu√©' : 'üîí Verrouill√©' %>
                    </div>
                    <% if reward.unlocked_at %>
                      <div class="text-xs text-gray-500">
                        <%= reward.unlocked_at.strftime("%d/%m %H:%M") %>
                      </div>
                    <% end %>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <p class="text-gray-400">Aucune r√©compense r√©cente</p>
        <% end %>
      </div>

      <!-- Badges r√©cents -->
      <div class="bg-gray-800 rounded-lg p-6">
        <h2 class="text-xl font-bold mb-4">üèÜ Badges r√©cents</h2>
        <% if @recent_badges.any? %>
          <div class="space-y-3">
            <% @recent_badges.each do |user_badge| %>
              <div class="bg-gray-700 rounded-lg p-3">
                <div class="flex justify-between items-center">
                  <div>
                    <div class="font-semibold"><%= user_badge.badge.name %></div>
                    <div class="text-sm text-gray-400"><%= user_badge.badge.badge_type.humanize %></div>
                  </div>
                  <div class="text-right">
                    <div class="text-sm text-purple-400">‚úÖ Gagn√©</div>
                    <% if user_badge.earned_at %>
                      <div class="text-xs text-gray-500">
                        <%= user_badge.earned_at.strftime("%d/%m %H:%M") %>
                      </div>
                    <% end %>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <p class="text-gray-400">Aucun badge r√©cent</p>
        <% end %>
      </div>
    </div>

    <!-- Actions d'administration -->
    <div class="bg-gray-800 rounded-lg p-6">
      <h2 class="text-xl font-bold mb-4">üõ†Ô∏è Actions d'administration</h2>
      
      <div class="flex flex-wrap gap-4">
        <%= link_to admin_animations_cleanup_test_data_path, 
            method: :post, 
            class: "bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors",
            confirm: "√ätes-vous s√ªr de vouloir supprimer toutes les donn√©es de test ?" do %>
          üóëÔ∏è Nettoyer les donn√©es de test
        <% end %>
        
        <%= link_to reward_animations_demo_path, 
            target: "_blank",
            class: "bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors" do %>
          üéâ Voir la page des animations
        <% end %>
        
        <%= link_to root_path, 
            class: "bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-colors" do %>
          üè† Retour √† l'accueil
        <% end %>
      </div>
    </div>

    <!-- Test direct des animations -->
    <div class="bg-purple-900 rounded-lg p-6 mb-8">
      <h2 class="text-xl font-bold mb-4">Test Direct des Animations</h2>
      <p class="text-gray-300 mb-4">Testez les animations directement depuis le frontend (sans passer par le backend)</p>
      
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <button onclick="testDirectBadgeAnimation('competitor', 'bronze')" 
                class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg text-center transition-colors">
          <div class="text-lg"></div>
          <div>Badge Test</div>
        </button>
        
        <button onclick="testDirectRewardAnimation('challenge')" 
                class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-center transition-colors">
          <div class="text-lg"></div>
          <div>Reward Test</div>
        </button>
        
        <button onclick="checkAnimationSystem()" 
                class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-center transition-colors">
          <div class="text-lg"></div>
          <div>Debug System</div>
        </button>
        
        <button onclick="clearAllAnimations()" 
                class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-center transition-colors">
          <div class="text-lg"></div>
          <div>Clear All</div>
        </button>
      </div>
    </div>

    <!-- Instructions -->
    <div class="bg-blue-900 rounded-lg p-6 mt-8">
      <h2 class="text-xl font-bold mb-4">üí° Instructions</h2>
      <div class="space-y-2 text-sm">
        <p>‚Ä¢ <strong>R√©compenses:</strong> Cliquez sur un type pour cr√©er et d√©bloquer une r√©compense de test</p>
        <p>‚Ä¢ <strong>Badges:</strong> Cliquez sur un niveau pour cr√©er et attribuer un badge de test</p>
        <p>‚Ä¢ <strong>Animations:</strong> Les animations se d√©clenchent automatiquement lors de la cr√©ation</p>
        <p>‚Ä¢ <strong>Cache:</strong> Les donn√©es d'animation sont stock√©es en cache pour le frontend</p>
        <p>‚Ä¢ <strong>Nettoyage:</strong> Utilisez le bouton rouge pour supprimer les donn√©es de test</p>
        <p>‚Ä¢ <strong>Test Direct:</strong> Utilisez les boutons verts pour tester les animations sans backend</p>
      </div>
    </div>
  </div>
</div>

<!-- Styles des animations int√©gr√©s directement (copie exacte de reward_animations_demo) -->
<style>
  /* üéâ Syst√®me d'Animations de R√©compenses - Tube'NPlay */

  /* ===== POPUP DE NOTIFICATION ===== */
  .reward-notification-popup {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 9999;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px;
    padding: 20px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    transform: translateX(400px);
    transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    border: 3px solid #ffd700;
    animation: notificationGlow 2s infinite;
  }

  .reward-notification-popup.show {
    transform: translateX(0);
  }

  .reward-notification-popup .notification-content {
    display: flex;
    align-items: center;
    gap: 15px;
    color: white;
  }

  .reward-notification-popup .notification-icon {
    font-size: 2.5rem;
    animation: bounce 1s infinite;
  }

  .reward-notification-popup .notification-text {
    font-size: 1.1rem;
    font-weight: bold;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  }

  /* ===== ANIMATION DU CADEAU ===== */
  .reward-gift-container {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0);
    z-index: 10000;
    transition: all 0.3s ease;
  }

  .reward-gift-container.show {
    transform: translate(-50%, -50%) scale(1);
  }

  .reward-gift-box {
    width: 260px; /* Agrandi de 30% (200 * 1.3 = 260) */
    height: 260px; /* Agrandi de 30% (200 * 1.3 = 260) */
    background: linear-gradient(45deg, #ff6b6b, #ffd93d, #6bcf7f, #4d9de0);
    background-size: 400% 400%;
    border-radius: 26px; /* Agrandi de 30% (20 * 1.3 = 26) */
    position: relative;
    animation: giftGradient 3s ease infinite, giftFloat 2s ease-in-out infinite;
    box-shadow: 0 26px 52px rgba(0, 0, 0, 0.3); /* Agrandi de 30% */
    cursor: pointer;
    border: 5.2px solid #ffd700; /* Agrandi de 30% (4 * 1.3 = 5.2) */
  }

  .reward-gift-box::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 4px;
    background: #ffd700;
    transform: translateY(-50%);
    box-shadow: 0 0 20px #ffd700;
  }

  .reward-gift-box::after {
    content: 'üéÅ';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 5.2rem; /* Agrandi de 30% (4 * 1.3 = 5.2) */
    animation: giftShine 2s ease-in-out infinite;
  }

  .reward-gift-ribbon {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 26px; /* Agrandi de 30% (20 * 1.3 = 26) */
    height: 100%;
    background: linear-gradient(to bottom, #ff6b6b, #ff8e8e);
    border-radius: 13px; /* Agrandi de 30% (10 * 1.3 = 13) */
    box-shadow: 0 0 19.5px rgba(255, 107, 107, 0.5); /* Agrandi de 30% (15 * 1.3 = 19.5) */
  }

  /* ===== EXPLOSION ET EFFETS ===== */
  .reward-explosion-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 10001;
    pointer-events: none;
    overflow: hidden;
  }

  .confetti-piece {
    position: absolute;
    width: 10px;
    height: 10px;
    background: #ff6b6b;
    animation: confettiFall 3s linear infinite;
  }

  .confetti-piece:nth-child(2n) { background: #ff6b6b; animation-delay: 0.1s; }
  .confetti-piece:nth-child(3n) { background: #4d9de0; animation-delay: 0.2s; }
  .confetti-piece:nth-child(4n) { background: #6bcf7f; animation-delay: 0.3s; }
  .confetti-piece:nth-child(5n) { background: #ffd93d; animation-delay: 0.4s; }
  .confetti-piece:nth-child(6n) { background: #ff8e8e; animation-delay: 0.5s; }
  .confetti-piece:nth-child(7n) { background: #a855f7; animation-delay: 0.6s; }
  .confetti-piece:nth-child(8n) { background: #06b6d4; animation-delay: 0.7s; }

  .sparkle {
    position: absolute;
    width: 4px;
    height: 4px;
    background: #ffd700;
    border-radius: 50%;
    animation: sparkleFloat 2s ease-in-out infinite;
    box-shadow: 0 0 10px #ffd700;
  }

  /* ===== MESSAGES DE F√âLICITATIONS ===== */
  .congratulations-message {
    position: fixed;
    top: 30%;
    left: 50%;
    transform: translateX(-50%) scale(0);
    z-index: 10002;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 30px 50px;
    border-radius: 20px;
    font-size: 2rem;
    font-weight: bold;
    text-align: center;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    border: 3px solid #ffd700;
    animation: messagePop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
  }

  .congratulations-message .reward-title {
    font-size: 1.5rem;
    margin-top: 10px;
    color: #ffd700;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  }

  /* ===== ANIMATIONS KEYFRAMES ===== */
  @keyframes notificationGlow {
    0%, 100% { box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), 0 0 20px rgba(255, 215, 0, 0.5); }
    50% { box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), 0 0 40px rgba(255, 215, 0, 0.8); }
  }

  @keyframes bounce {
    0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
    40% { transform: translateY(-10px); }
    60% { transform: translateY(-5px); }
  }

  @keyframes giftGradient {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  @keyframes giftFloat {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-20px) rotate(5deg); }
  }

  @keyframes giftShine {
    0%, 100% { filter: brightness(1) drop-shadow(0 0 10px rgba(255, 215, 0, 0.5)); }
    50% { filter: brightness(1.5) drop-shadow(0 0 20px rgba(255, 215, 0, 0.8)); }
  }

  @keyframes confettiFall {
    0% {
      transform: translateY(-100vh) rotate(0deg);
      opacity: 1;
    }
    100% {
      transform: translateY(100vh) rotate(720deg);
      opacity: 0;
    }
  }

  @keyframes sparkleFloat {
    0%, 100% {
      transform: translateY(0px) scale(1);
      opacity: 1;
    }
    50% {
      transform: translateY(-30px) scale(1.5);
      opacity: 0.7;
    }
  }

  @keyframes messagePop {
    0% {
      transform: translateX(-50%) scale(0) rotate(-10deg);
      opacity: 0;
    }
    50% {
      transform: translateX(-50%) scale(1.1) rotate(5deg);
      opacity: 1;
    }
    100% {
      transform: translateX(-50%) scale(1) rotate(0deg);
      opacity: 1;
    }
  }

  @keyframes rewardCardPop {
    0% {
      transform: translate(-50%, -50%) scale(0) rotate(-15deg);
      opacity: 0;
    }
    30% {
      transform: translate(-50%, -50%) scale(1.2) rotate(10deg);
      opacity: 1;
    }
    60% {
      transform: translate(-50%, -50%) scale(0.9) rotate(-5deg);
      opacity: 1;
    }
    100% {
      transform: translate(-50%, -50%) scale(1) rotate(0deg);
      opacity: 1;
    }
  }

  /* ===== EFFETS DE PARTICULES ===== */
  .particle {
    position: absolute;
    width: 6px;
    height: 6px;
    background: #ffd700;
    border-radius: 50%;
    animation: particleExplode 1.5s ease-out forwards;
  }

  .particle:nth-child(2n) { background: #ff6b6b; }
  .particle:nth-child(3n) { background: #4d9de0; }
  .particle:nth-child(4n) { background: #6bcf7f; }

  @keyframes particleExplode {
    0% {
      transform: scale(0) rotate(0deg);
      opacity: 1;
    }
    100% {
      transform: scale(1) rotate(360deg) translate(var(--dx), var(--dy));
      opacity: 0;
    }
  }

  /* ===== RESPONSIVE ===== */
  @media (max-width: 768px) {
    .reward-notification-popup {
      right: 10px;
      top: 10px;
      padding: 15px;
    }
    
    .reward-gift-box {
      width: 150px;
      height: 150px;
    }
    
    .reward-gift-box::after {
      font-size: 3rem;
    }
    
    .congratulations-message {
      font-size: 1.5rem;
      padding: 20px 30px;
    }
  }
</style>

<!-- JavaScript des animations int√©gr√© directement (copie exacte de reward_animations_demo) -->
<script>
// üéâ Syst√®me d'Animations de R√©compenses - Tube'NPlay

class RewardAnimationSystem {
  constructor() {
    this.isAnimating = false;
    this.init();
  }

  init() {
    console.log('üéâ Reward Animation System initialized');
  }

  // üéØ D√©clencher l'animation compl√®te de r√©compense
  triggerRewardAnimation(rewardData) {
    if (this.isAnimating) return;
    this.isAnimating = true;

    const sequence = [
      () => this.showNotification(rewardData),
      () => this.showGift(rewardData),
      () => this.explodeGift(rewardData),
      () => this.showCongratulations(rewardData),
      () => this.cleanup()
    ];

    this.executeSequence(sequence, 0);
  }

  // üèÜ D√©clencher l'animation compl√®te de badge (adapt√©e)
  triggerBadgeAnimation(badgeData) {
    if (this.isAnimating) return;
    this.isAnimating = true;

    const sequence = [
      () => this.showNotification(badgeData),
      () => this.showGift(badgeData),
      () => this.explodeGift(badgeData),
      () => this.showCongratulations(badgeData),
      () => this.cleanup()
    ];

    this.executeSequence(sequence, 0);
  }

  // üì¢ Afficher la notification popup
  showNotification(data) {
    return new Promise((resolve) => {
      const type = data.type ? data.type.toLowerCase() : 'badge';
      const rewardType = data.reward_type ? data.reward_type.toLowerCase() : type;
      
      // D√©terminer l'ic√¥ne et le texte selon le type
      let icon, message;
      if (type === 'badge') {
        icon = '';
        message = 'Nouveau badge d√©bloqu√© !';
      } else {
        switch (rewardType) {
          case 'challenge':
            icon = '';
            message = 'R√©compense Challenge d√©bloqu√©e !';
            break;
          case 'exclusif':
            icon = '';
            message = 'R√©compense Exclusif d√©bloqu√©e !';
            break;
          case 'premium':
            icon = '';
            message = 'R√©compense Premium d√©bloqu√©e !';
            break;
          case 'ultime':
            icon = '';
            message = 'R√©compense Ultime d√©bloqu√©e !';
            break;
          default:
            icon = '';
            message = 'Nouvelle r√©compense d√©bloqu√©e !';
        }
      }
      
      const popup = document.createElement('div');
      popup.className = 'reward-notification-popup';
      popup.innerHTML = `
        <div class="notification-content">
          <div class="notification-icon">${icon}</div>
          <div class="notification-text">
            <div>${message}</div>
            <div style="font-size: 0.9rem; opacity: 0.9;">${data.title}</div>
          </div>
        </div>
      `;

      document.body.appendChild(popup);

      // Animation d'entr√©e
      setTimeout(() => {
        popup.classList.add('show');
      }, 100);

      // Auto-hide apr√®s 4 secondes
      setTimeout(() => {
        popup.classList.remove('show');
        setTimeout(() => {
          document.body.removeChild(popup);
          resolve();
        }, 500);
      }, 4000);
    });
  }

  // üéÅ Afficher le cadeau
  showGift(data) {
    return new Promise((resolve) => {
      const giftContainer = document.createElement('div');
      giftContainer.className = 'reward-gift-container';
      giftContainer.innerHTML = `
        <div class="reward-gift-box" style="cursor: pointer;">
          <div class="reward-gift-ribbon"></div>
        </div>
        <div style="position: absolute; bottom: -50px; left: 50%; transform: translateX(-50%); color: white; font-size: 1rem; text-align: center; text-shadow: 0 2px 4px rgba(0,0,0,0.8);">
          üëÜ Cliquez pour ouvrir !
        </div>
      `;

      document.body.appendChild(giftContainer);

      // Animation d'entr√©e
      setTimeout(() => {
        giftContainer.classList.add('show');
      }, 100);

      // Attacher l'√©v√©nement de clic directement sur le cadeau
      const giftBox = giftContainer.querySelector('.reward-gift-box');
      giftBox.addEventListener('click', () => {
        console.log('üéÅ Cadeau cliqu√© ! D√©clenchement de l\'explosion...');
        // Stocker la r√©f√©rence pour l'explosion
        this.giftContainer = giftContainer;
        resolve();
      });
    });
  }

  // üí• Explosion du cadeau
  explodeGift(data) {
    return new Promise((resolve) => {
      console.log('üí• Explosion du cadeau d√©clench√©e...');
      
      // Animation de sortie du cadeau
      this.giftContainer.style.transform = 'translate(-50%, -50%) scale(1.5)';
      this.giftContainer.style.opacity = '0';
      this.giftContainer.style.transition = 'all 0.3s ease';

      // Cr√©er l'explosion - CORRIG√â
      this.createExplosion();
      this.createSparkles();
      this.createParticles();

      setTimeout(() => {
        document.body.removeChild(this.giftContainer);
        console.log('‚úÖ Cadeau supprim√©, r√©solution de l\'explosion');
        resolve();
      }, 2000); // D√©lai plus long pour laisser les confettis s'afficher
    });
  }

  // üéä Cr√©er l'explosion de confettis
  createExplosion() {
    const explosionContainer = document.createElement('div');
    explosionContainer.className = 'reward-explosion-container';
    document.body.appendChild(explosionContainer);

    // Cr√©er 100 confettis plus visibles
    for (let i = 0; i < 100; i++) {
      const confetti = document.createElement('div');
      confetti.className = 'confetti-piece';
      confetti.style.left = Math.random() * 100 + '%';
      confetti.style.animationDelay = Math.random() * 2 + 's';
      confetti.style.animationDuration = (Math.random() * 2 + 3) + 's';
      confetti.style.width = (Math.random() * 15 + 8) + 'px';
      confetti.style.height = (Math.random() * 15 + 8) + 'px';
      confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
      confetti.style.boxShadow = '0 0 10px rgba(255, 255, 255, 0.8)';
      explosionContainer.appendChild(confetti);
    }

    // Nettoyer apr√®s l'animation
    setTimeout(() => {
      document.body.removeChild(explosionContainer);
    }, 6000);
  }

  // ‚ú® Cr√©er les √©tincelles
  createSparkles() {
    const sparkleContainer = document.createElement('div');
    sparkleContainer.className = 'reward-explosion-container';
    document.body.appendChild(sparkleContainer);

    // Cr√©er 60 √©tincelles plus brillantes
    for (let i = 0; i < 60; i++) {
      const sparkle = document.createElement('div');
      sparkle.className = 'sparkle';
      sparkle.style.left = Math.random() * 100 + '%';
      sparkle.style.top = Math.random() * 100 + '%';
      sparkle.style.animationDelay = Math.random() * 1 + 's';
      sparkle.style.width = (Math.random() * 8 + 4) + 'px';
      sparkle.style.height = (Math.random() * 8 + 4) + 'px';
      sparkle.style.boxShadow = '0 0 20px #ffd700, 0 0 40px #ffd700, 0 0 60px #ffd700';
      sparkleContainer.appendChild(sparkle);
    }

    setTimeout(() => {
      document.body.removeChild(sparkleContainer);
    }, 4000);
  }

  // üéÜ Cr√©er les particules d'explosion
  createParticles() {
    const particleContainer = document.createElement('div');
    particleContainer.className = 'reward-explosion-container';
    document.body.appendChild(particleContainer);

    // Cr√©er 40 particules plus visibles
    for (let i = 0; i < 40; i++) {
      const particle = document.createElement('div');
      particle.className = 'particle';
      particle.style.left = '50%';
      particle.style.top = '50%';
      particle.style.width = (Math.random() * 12 + 6) + 'px';
      particle.style.height = (Math.random() * 12 + 6) + 'px';
      particle.style.boxShadow = '0 0 15px rgba(255, 255, 255, 0.9)';
      
      const angle = (Math.PI * 2 * i) / 40;
      const distance = 150 + Math.random() * 300;
      const dx = Math.cos(angle) * distance;
      const dy = Math.sin(angle) * distance;
      
      particle.style.setProperty('--dx', dx + 'px');
      particle.style.setProperty('--dy', dy + 'px');
      particle.style.animationDelay = Math.random() * 0.5 + 's';
      
      particleContainer.appendChild(particle);
    }

    setTimeout(() => {
      document.body.removeChild(particleContainer);
    }, 3000);
  }

  // üéâ Afficher le message de f√©licitations
  showCongratulations(data) {
    return new Promise((resolve) => {
      console.log('üéâ Affichage du message de f√©licitations...');
      
      // Cr√©er le message principal avec styles simples
      const message = document.createElement('div');
      // Mots al√©atoires pour les f√©licitations
      const celebrationWords = ['BRAAAA !', 'BAM !', 'WOW !', 'TU DECHIRES !', 'F√âLICITATIONS !'];
      const randomWord = celebrationWords[Math.floor(Math.random() * celebrationWords.length)];
      
      message.innerHTML = `
        <div style="font-size: 2.5rem; margin-bottom: 15px; font-weight: bold; color: #ffd700;">
          ${randomWord}
        </div>
        <div style="font-size: 1.5rem; margin-bottom: 10px; color: white;">
          ${data.title}
        </div>
        <div style="font-size: 1rem; line-height: 1.3; opacity: 0.9;">
          ${data.description}
        </div>
      `;
      
      // Styles simples et robustes - Centrage absolu et taille r√©duite
      message.style.position = 'fixed';
      message.style.top = '20%';
      message.style.left = '0';
      message.style.right = '0';
      message.style.margin = '0 auto';
      message.style.zIndex = '99999';
      message.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
      message.style.color = 'white';
      message.style.padding = '20px 25px'; // R√©duit
      message.style.borderRadius = '15px'; // R√©duit
      message.style.fontSize = '1.5rem'; // R√©duit
      message.style.fontWeight = 'bold';
      message.style.textAlign = 'center';
      message.style.boxShadow = '0 15px 30px rgba(0, 0, 0, 0.5)'; // R√©duit
      message.style.border = '3px solid #ffd700';
      message.style.maxWidth = '85vw'; // R√©duit
      message.style.width = 'fit-content';
      message.style.minWidth = '280px'; // R√©duit
      message.style.wordWrap = 'break-word';
      message.style.overflow = 'hidden';
      message.style.boxSizing = 'border-box';
      message.style.display = 'block';
      message.style.marginLeft = 'auto';
      message.style.marginRight = 'auto';

      document.body.appendChild(message);
      console.log('‚úÖ Message de f√©licitations ajout√© au DOM');

      // Auto-hide apr√®s 6.3 secondes (allong√© de 5%)
      setTimeout(() => {
        message.style.opacity = '0';
        message.style.transition = 'opacity 0.8s ease';
        
        setTimeout(() => {
          if (document.body.contains(message)) {
            document.body.removeChild(message);
          }
          // Cr√©er l'affichage de la r√©compense d√©couverte APR√àS la disparition du message
          this.showRewardDiscovery(data);
          resolve();
        }, 800);
      }, 6300); // Allong√© de 5% (6000 * 1.05 = 6300)
    });
  }

  // üéÅ Afficher la r√©compense d√©couverte
  showRewardDiscovery(data) {
    console.log('üé´ Affichage de la carte de r√©compense d√©couverte...');
    
    // Obtenir les informations sp√©cifiques selon le type
    const rewardInfo = this.getRewardInfo(data);
    
    const rewardCard = document.createElement('div');
    rewardCard.innerHTML = `
      <!-- Banni√®re avec image sp√©cifique au type de r√©compense -->
      <div style="height: 200px; position: relative; overflow: hidden; background: linear-gradient(135deg, ${rewardInfo.gradient});">
        <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: url('${rewardInfo.backgroundImage}') center/cover; opacity: 0.8;"></div>
        <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(45deg, ${rewardInfo.overlayGradient});"></div>
        
        <!-- Badge type en haut √† droite -->
        <div style="position: absolute; top: 15px; right: 15px;">
          <span style="background: ${rewardInfo.badgeColor}; color: white; padding: 5px 10px; border-radius: 15px; font-size: 0.8rem; font-weight: bold;">
            ${rewardInfo.badgeText}
          </span>
        </div>
        
        <!-- Ic√¥ne du type de contenu -->
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 4rem; z-index: 10;">
          ${rewardInfo.icon}
        </div>
        
        <!-- Overlay avec titre -->
        <div style="position: absolute; inset: 0; background: rgba(0,0,0,0.4); display: flex; align-items: end; padding: 20px;">
          <div style="color: white;">
            <h3 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 5px; text-shadow: 0 2px 4px rgba(0,0,0,0.8);">
              ${data.title}
            </h3>
            <div style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">
              ${rewardInfo.subtitle}
            </div>
          </div>
        </div>
      </div>
      
      <!-- Contenu de la carte -->
      <div style="background: linear-gradient(135deg, ${rewardInfo.gradient}); padding: 20px; color: white;">
        <p style="font-size: 1rem; margin-bottom: 15px; line-height: 1.4; opacity: 0.9;">
          ${data.description}
        </p>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
          <div style="background: rgba(255, 255, 255, 0.2); padding: 6px 12px; border-radius: 15px; font-size: 0.8rem;">
            <span style="color: #ffd700; font-weight: bold;">${rewardInfo.requirement}</span>
          </div>
          <div style="background: #9333ea; color: white; padding: 6px 12px; border-radius: 15px; font-size: 0.8rem; font-weight: bold;">
            D√âBLOQU√â
          </div>
        </div>
      </div>
    `;
    
    // Styles identiques aux vraies cartes de r√©compenses
    rewardCard.style.position = 'fixed';
    rewardCard.style.top = '50%';
    rewardCard.style.left = '50%';
    rewardCard.style.transform = 'translate(-50%, -50%)';
    rewardCard.style.zIndex = '99999';
    rewardCard.style.borderRadius = '12px'; // Identique aux vraies cartes
    rewardCard.style.boxShadow = '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)'; // Identique aux vraies cartes
    rewardCard.style.border = '2px solid transparent'; // Identique aux vraies cartes
    rewardCard.style.maxWidth = '400px'; // Taille identique aux vraies cartes
    rewardCard.style.width = '90%';
    rewardCard.style.overflow = 'hidden';
    rewardCard.style.transition = 'all 0.3s ease'; // Identique aux vraies cartes

    document.body.appendChild(rewardCard);
    console.log('‚úÖ Carte de r√©compense ajout√©e au DOM');

    // Auto-hide apr√®s 4.5 secondes (r√©duit de 10%)
    setTimeout(() => {
      rewardCard.style.opacity = '0';
      rewardCard.style.transition = 'opacity 0.6s ease';
      
      setTimeout(() => {
        if (document.body.contains(rewardCard)) {
          document.body.removeChild(rewardCard);
        }
      }, 600);
    }, 4500); // R√©duit de 10% (5000 * 0.9 = 4500)
  }

  // üèÜ Obtenir les informations sp√©cifiques selon le type de badge
  getBadgeInfo(badgeType, level, data) {
    // Images sp√©cifiques selon le type et niveau de badge
    const badgeImages = {
      competitor: {
        bronze: 'dropmixpop.webp',
        silver: 'VIP-gold.jpg',
        gold: 'VIP-gold.jpg'
      },
      engager: {
        bronze: 'pandora-playlist-collage.webp',
        silver: 'photos-dedicacees.jpeg',
        gold: 'concert.jpeg'
      },
      critic: {
        bronze: 'photos-dedicacees.jpeg',
        silver: 'photos-dedicacees.jpeg',
        gold: 'interview.jpg'
      },
      challenger: {
        bronze: 'photos-dedicacees.jpeg',
        silver: 'photos-dedicacees.jpeg',
        gold: 'interview.jpg'
      }
    };
    
    // Couleurs et d√©grad√©s selon le niveau
    const levelColors = {
      bronze: {
        gradient: '#CD7F32 0%, #B8860B 100%',
        overlayGradient: 'rgba(205,127,50,0.8) 0%, rgba(184,134,11,0.8) 100%',
        badgeColor: '#CD7F32'
      },
      silver: {
        gradient: '#C0C0C0 0%, #808080 100%',
        overlayGradient: 'rgba(192,192,192,0.8) 0%, rgba(128,128,128,0.8) 100%',
        badgeColor: '#C0C0C0'
      },
      gold: {
        gradient: '#FFD700 0%, #FFA500 100%',
        overlayGradient: 'rgba(255,215,0,0.8) 0%, rgba(255,165,0,0.8) 100%',
        badgeColor: '#FFD700'
      }
    };
    
    // Descriptions selon le type de badge
    const badgeDescriptions = {
      competitor: 'Comp√©titeur',
      engager: 'Engag√©',
      critic: 'Critique',
      challenger: 'Challenger'
    };
    
    const imageFile = badgeImages[badgeType]?.[level] || 'photos-dedicacees.jpeg';
    const colors = levelColors[level] || levelColors.bronze;
    const icon = '';
    const description = badgeDescriptions[badgeType] || 'Badge';
    
    return {
      gradient: colors.gradient,
      backgroundImage: `/assets/badges/${imageFile}`,
      overlayGradient: colors.overlayGradient,
      badgeColor: colors.badgeColor,
      badgeText: `${level.toUpperCase()} ${description.toUpperCase()}`,
      icon: icon,
      subtitle: `${data.points_required || 'Nouveau'} points requis`,
      requirement: `${data.points_required || 'Nouveau'} points requis`
    };
  }

  // üéØ Obtenir les informations sp√©cifiques selon le type de r√©compense
  getRewardInfo(data) {
    const type = data.type ? data.type.toLowerCase() : 'badge';
    const rewardType = data.reward_type ? data.reward_type.toLowerCase() : type;
    const badgeType = data.badge_type ? data.badge_type.toLowerCase() : '';
    const level = data.level ? data.level.toLowerCase() : '';
    
    // Si c'est un badge
    if (type === 'badge') {
      return this.getBadgeInfo(badgeType, level, data);
    }
    
    // Si c'est une r√©compense
         switch (rewardType) {
           case 'challenge':
             return {
               gradient: '#FFD700 0%, #FFA500 100%',
               backgroundImage: 'https://img.youtube.com/vi/0tJz8JjPbHU/maxresdefault.jpg', // Didi B
               overlayGradient: 'rgba(255,215,0,0.8) 0%, rgba(255,165,0,0.8) 100%',
               badgeColor: '#FFD700',
               badgeText: 'CHALLENGE',
               icon: '',
               subtitle: 'Playlist exclusive d√©bloqu√©e',
               requirement: '3 badges requis'
             };
             
           case 'exclusif':
             return {
               gradient: '#C0C0C0 0%, #808080 100%',
               backgroundImage: 'https://img.youtube.com/vi/QVvfSQP3JLM/maxresdefault.jpg', // Didi B Bouak√©
               overlayGradient: 'rgba(192,192,192,0.8) 0%, rgba(128,128,128,0.8) 100%',
               badgeColor: '#C0C0C0',
               badgeText: 'EXCLUSIF',
               icon: '',
               subtitle: 'Contenu exclusif disponible',
               requirement: '6 badges requis'
             };
             
           case 'premium':
             return {
               gradient: '#CD7F32 0%, #B8860B 100%',
               backgroundImage: 'https://img.youtube.com/vi/JWrIfPCyedU/maxresdefault.jpg', // Charles Dor√©
               overlayGradient: 'rgba(205,127,50,0.8) 0%, rgba(184,134,11,0.8) 100%',
               badgeColor: '#CD7F32',
               badgeText: 'PREMIUM',
               icon: '',
               subtitle: 'Contenu premium d√©bloqu√©',
               requirement: '9 badges requis'
             };
             
           case 'ultime':
             return {
               gradient: '#FF69B4 0%, #FF1493 100%',
               backgroundImage: 'https://img.youtube.com/vi/ICvSOFEKbgs/maxresdefault.jpg', // Miki
               overlayGradient: 'rgba(255,105,180,0.8) 0%, rgba(255,20,147,0.8) 100%',
               badgeColor: '#FF69B4',
               badgeText: 'ULTIME',
               icon: '',
               subtitle: 'Exp√©rience ultime disponible',
               requirement: '12 badges requis'
             };
             
           default:
             return {
               gradient: '#667eea 0%, #764ba2 100%',
               backgroundImage: 'https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80',
               overlayGradient: 'rgba(102,126,234,0.8) 0%, rgba(118,75,162,0.8) 100%',
               badgeColor: '#808080',
               badgeText: 'R√âCOMPENSE',
               icon: '',
               subtitle: 'Nouvelle r√©compense disponible',
               requirement: 'Badges requis'
             };
         }
  }

  // üßπ Nettoyage final
  cleanup() {
    console.log('üßπ Nettoyage final...');
    this.isAnimating = false;
    this.giftContainer = null;
    this.giftResolve = null;
    console.log('‚úÖ Nettoyage termin√©');
    return Promise.resolve();
  }

  // üîÑ Ex√©cuter une s√©quence d'animations
  async executeSequence(sequence, index) {
    console.log(`üîÑ Ex√©cution de l'√©tape ${index + 1}/${sequence.length}`);
    
    if (index >= sequence.length) {
      console.log('‚úÖ S√©quence termin√©e !');
      return;
    }
    
    try {
      await sequence[index]();
      console.log(`‚úÖ √âtape ${index + 1} termin√©e, passage √† l'√©tape ${index + 2}`);
      this.executeSequence(sequence, index + 1);
    } catch (error) {
      console.error(`‚ùå Erreur √† l'√©tape ${index + 1}:`, error);
    }
  }
}

// Initialiser le syst√®me d'animations
if (!window.rewardAnimationSystem) {
  window.rewardAnimationSystem = new RewardAnimationSystem();
  console.log('‚úÖ Syst√®me d\'animations initialis√© pour la page admin !');
}

// Fonctions globales pour tester les animations
window.testBadgeAnimation = function(badgeType, level) {
  console.log('üèÜ Test animation badge:', badgeType, level);
  
  if (!window.rewardAnimationSystem) {
    console.error('‚ùå Syst√®me d\'animations non disponible');
    return;
  }
  
  const badgeData = {
    type: badgeType.toUpperCase(),
    title: `${level.charAt(0).toUpperCase() + level.slice(1)} ${badgeType.charAt(0).toUpperCase() + badgeType.slice(1)}`,
    description: getBadgeDescription(badgeType),
    points_required: getBadgePoints(level)
  };
  
  console.log('üéØ D√©clenchement animation badge avec:', badgeData);
  window.rewardAnimationSystem.triggerBadgeAnimation(badgeData);
};

window.testRewardAnimation = function(type) {
  console.log('üéâ Test animation r√©compense:', type);
  
  if (!window.rewardAnimationSystem) {
    console.error('‚ùå Syst√®me d\'animations non disponible');
    return;
  }
  
  const rewardData = {
    type: type.toUpperCase(),
    title: getRewardTitle(type),
    description: getRewardDescription(type)
  };
  
  console.log('üéØ D√©clenchement animation r√©compense avec:', rewardData);
  window.rewardAnimationSystem.triggerRewardAnimation(rewardData);
};

// Fonctions utilitaires
function getBadgeDescription(type) {
  const descriptions = {
    competitor: 'üèÜ Vous √™tes un vrai comp√©titeur ! Continuez √† jouer pour d√©bloquer plus de badges.',
    engager: 'üéÆ Vous vous engagez dans le jeu ! Votre participation est remarquable.',
    critic: 'üéØ Vous avez un ≈ìil critique ! Vos opinions comptent dans la communaut√©.',
    challenger: '‚ö° Vous relevez tous les d√©fis ! Vous √™tes un champion du jeu.'
  };
  return descriptions[type] || 'üèÖ Nouveau badge d√©bloqu√© ! Continuez √† jouer pour en d√©bloquer d\'autres.';
}

function getRewardDescription(type) {
  const descriptions = {
    challenge: 'Vous avez d√©bloqu√© une playlist exclusive !',
    exclusif: 'Acc√®s √† du contenu premium sp√©cial !',
    premium: 'Contenu VIP et rencontres avec artistes !',
    ultime: 'R√©compense ultime - vous √™tes un champion !'
  };
  return descriptions[type] || 'Nouvelle r√©compense disponible !';
}

function getBadgePoints(level) {
  const points = {
    bronze: 100,
    silver: 250,
    gold: 500
  };
  return points[level] || 100;
}

function getRewardTitle(type) {
  const titles = {
    challenge: 'R√©compense Challenge D√©bloqu√©e !',
    exclusif: 'R√©compense Exclusif D√©bloqu√©e !',
    premium: 'R√©compense Premium D√©bloqu√©e !',
    ultime: 'R√©compense Ultime D√©bloqu√©e !'
  };
  return titles[type] || 'R√©compense D√©bloqu√©e !';
}

// Fonction pour d√©clencher automatiquement les animations apr√®s les actions backend
window.triggerAnimationAfterSuccess = function(type, data) {
  console.log('üéâ D√©clenchement automatique apr√®s succ√®s:', type, data);
  
  if (!window.rewardAnimationSystem) {
    console.error('‚ùå Syst√®me d\'animations non disponible');
    return;
  }
  
  if (type === 'badge') {
    window.rewardAnimationSystem.triggerBadgeAnimation(data);
  } else if (type === 'reward') {
    window.rewardAnimationSystem.triggerRewardAnimation(data);
  }
};

// Test direct des animations
window.testDirectBadgeAnimation = function(badgeType, level) {
  console.log('Test direct badge animation:', badgeType, level);
  
  const badgeData = {
    type: badgeType.toUpperCase(),
    title: `${level.charAt(0).toUpperCase() + level.slice(1)} ${badgeType.charAt(0).toUpperCase() + badgeType.slice(1)}`,
    description: getBadgeDescription(badgeType),
    points_required: getBadgePoints(level)
  };
  
  window.triggerAnimationAfterSuccess('badge', badgeData);
};

window.testDirectRewardAnimation = function(type) {
  console.log('Test direct reward animation:', type);
  
  const rewardData = {
    type: type.toUpperCase(),
    title: getRewardTitle(type),
    description: getRewardDescription(type)
  };
  
  window.triggerAnimationAfterSuccess('reward', rewardData);
};

// V√©rifier le syst√®me d'animations
window.checkAnimationSystem = function() {
  console.log('üîç V√©rification du syst√®me d\'animations...');
  console.log('üìä window.rewardAnimationSystem:', window.rewardAnimationSystem);
  
  if (window.rewardAnimationSystem) {
    console.log('‚úÖ Syst√®me d\'animations disponible');
    console.log('üîß M√©thodes disponibles:', Object.getOwnPropertyNames(Object.getPrototypeOf(window.rewardAnimationSystem)));
    return true;
  } else {
    console.error('‚ùå Syst√®me d\'animations non disponible !');
    return false;
  }
};

// Nettoyer toutes les animations
window.clearAllAnimations = function() {
  console.log('üßπ Nettoyage de toutes les animations...');
  
  // Supprimer tous les √©l√©ments d'animation
  const elementsToRemove = document.querySelectorAll([
    '.reward-notification-popup',
    '.reward-gift-container',
    '.reward-explosion-container',
    '.congratulations-message'
  ].join(','));
  
  elementsToRemove.forEach(el => {
    if (el.parentNode) {
      el.parentNode.removeChild(el);
    }
  });
  
  console.log('‚úÖ Animations nettoy√©es');
};

document.addEventListener('DOMContentLoaded', function() {
  console.log('üéâ Page admin animations charg√©e');
  console.log('üîç V√©rification du syst√®me d\'animations...');
  console.log('üìä window.rewardAnimationSystem:', window.rewardAnimationSystem);
  
  // Test imm√©diat du syst√®me
  console.log('üß™ Test imm√©diat du syst√®me d\'animations...');
  if (window.rewardAnimationSystem) {
    console.log('‚úÖ Syst√®me d\'animations disponible');
    console.log('üîß M√©thodes disponibles:', Object.getOwnPropertyNames(Object.getPrototypeOf(window.rewardAnimationSystem)));
  } else {
    console.error('‚ùå Syst√®me d\'animations non disponible !');
  }
  
  // V√©rifier s'il y a des donn√©es d'animation dans le flash
  <% if flash[:animation_data] %>
    console.log('üéâ Donn√©es d\'animation trouv√©es dans le flash !');
    const animationData = <%= flash[:animation_data].html_safe %>;
    console.log('üìä Donn√©es d\'animation:', animationData);
    
    // D√©clencher l'animation automatiquement apr√®s 1 seconde
    setTimeout(() => {
      if (animationData.type === 'badge') {
        console.log('üèÜ D√©clenchement automatique animation badge');
        window.triggerAnimationAfterSuccess('badge', animationData);
      } else if (animationData.type === 'reward') {
        console.log('üéâ D√©clenchement automatique animation r√©compense');
        window.triggerAnimationAfterSuccess('reward', animationData);
      }
    }, 1000);
  <% end %>
  
  // V√©rifier s'il y a des donn√©es d'animation r√©centes
  const recentRewards = <%= @recent_rewards.to_json.html_safe %>;
  const recentBadges = <%= @recent_badges.to_json.html_safe %>;
  
  console.log('üì¶ R√©compenses r√©centes:', recentRewards);
  console.log('üèÜ Badges r√©cents:', recentBadges);
});
</script>
