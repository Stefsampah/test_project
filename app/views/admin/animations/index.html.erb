<% content_for :title, "Admin - Test des Animations" %>

<div class="min-h-screen bg-gray-900 text-white">
  <div class="max-w-7xl mx-auto px-4 py-8">
    <div class="mb-8">
      <h1 class="text-4xl font-bold mb-4">ğŸ‰ Admin - Test des Animations</h1>
      <p class="text-gray-400">Interface d'administration pour tester les animations de rÃ©compenses et badges</p>
    </div>

    <!-- Alertes -->
    <% if flash[:success] %>
      <div class="bg-green-600 text-white p-4 rounded-lg mb-6">
        âœ… <%= flash[:success] %>
      </div>
    <% end %>

    <% if flash[:error] %>
      <div class="bg-red-600 text-white p-4 rounded-lg mb-6">
        âŒ <%= flash[:error] %>
      </div>
    <% end %>

    <!-- Informations utilisateur -->
    <div class="bg-gray-800 rounded-lg p-6 mb-8">
      <h2 class="text-2xl font-bold mb-4">ğŸ‘¤ Utilisateur de test</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <span class="text-gray-400">Email:</span>
          <span class="text-white font-semibold"><%= @user.email %></span>
        </div>
        <div>
          <span class="text-gray-400">ID:</span>
          <span class="text-white font-semibold"><%= @user.id %></span>
        </div>
        <div>
          <span class="text-gray-400">Admin:</span>
          <span class="text-white font-semibold"><%= @user.admin? ? "âœ… Oui" : "âŒ Non" %></span>
        </div>
      </div>
    </div>

    <!-- Tests d'animations de rÃ©compenses -->
    <div class="bg-gray-800 rounded-lg p-6 mb-8">
      <h2 class="text-2xl font-bold mb-4">ğŸ‰ Tests d'animations de rÃ©compenses</h2>
      
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
        <%= link_to admin_animations_test_reward_animation_path(type: 'challenge'), 
            method: :post, 
            class: "bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-center transition-colors" do %>
          <div class="text-lg">ğŸ¯</div>
          <div>Challenge</div>
        <% end %>
        
        <%= link_to admin_animations_test_reward_animation_path(type: 'exclusif'), 
            method: :post, 
            class: "bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-center transition-colors" do %>
          <div class="text-lg">â­</div>
          <div>Exclusif</div>
        <% end %>
        
        <%= link_to admin_animations_test_reward_animation_path(type: 'premium'), 
            method: :post, 
            class: "bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg text-center transition-colors" do %>
          <div class="text-lg">ğŸ‘‘</div>
          <div>Premium</div>
        <% end %>
        
        <%= link_to admin_animations_test_reward_animation_path(type: 'ultime'), 
            method: :post, 
            class: "bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-center transition-colors" do %>
          <div class="text-lg">ğŸ†</div>
          <div>Ultime</div>
        <% end %>
      </div>
    </div>

    <!-- Tests d'animations de badges -->
    <div class="bg-gray-800 rounded-lg p-6 mb-8">
      <h2 class="text-2xl font-bold mb-4">ğŸ† Tests d'animations de badges</h2>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Competitor -->
        <div class="bg-gray-700 rounded-lg p-4">
          <h3 class="text-lg font-semibold mb-3 text-blue-400">ğŸ† Competitor</h3>
          <div class="grid grid-cols-3 gap-2">
            <%= link_to admin_animations_test_badge_animation_path(type: 'competitor', level: 'bronze'), 
                method: :post, 
                class: "bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-2 rounded text-center text-sm transition-colors" do %>
              Bronze
            <% end %>
            <%= link_to admin_animations_test_badge_animation_path(type: 'competitor', level: 'silver'), 
                method: :post, 
                class: "bg-gray-400 hover:bg-gray-500 text-white px-3 py-2 rounded text-center text-sm transition-colors" do %>
              Silver
            <% end %>
            <%= link_to admin_animations_test_badge_animation_path(type: 'competitor', level: 'gold'), 
                method: :post, 
                class: "bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-2 rounded text-center text-sm transition-colors" do %>
              Gold
            <% end %>
          </div>
        </div>

        <!-- Engager -->
        <div class="bg-gray-700 rounded-lg p-4">
          <h3 class="text-lg font-semibold mb-3 text-green-400">ğŸ® Engager</h3>
          <div class="grid grid-cols-3 gap-2">
            <%= link_to admin_animations_test_badge_animation_path(type: 'engager', level: 'bronze'), 
                method: :post, 
                class: "bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-2 rounded text-center text-sm transition-colors" do %>
              Bronze
            <% end %>
            <%= link_to admin_animations_test_badge_animation_path(type: 'engager', level: 'silver'), 
                method: :post, 
                class: "bg-gray-400 hover:bg-gray-500 text-white px-3 py-2 rounded text-center text-sm transition-colors" do %>
              Silver
            <% end %>
            <%= link_to admin_animations_test_badge_animation_path(type: 'engager', level: 'gold'), 
                method: :post, 
                class: "bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-2 rounded text-center text-sm transition-colors" do %>
              Gold
            <% end %>
          </div>
        </div>

        <!-- Critic -->
        <div class="bg-gray-700 rounded-lg p-4">
          <h3 class="text-lg font-semibold mb-3 text-purple-400">ğŸ¯ Critic</h3>
          <div class="grid grid-cols-3 gap-2">
            <%= link_to admin_animations_test_badge_animation_path(type: 'critic', level: 'bronze'), 
                method: :post, 
                class: "bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-2 rounded text-center text-sm transition-colors" do %>
              Bronze
            <% end %>
            <%= link_to admin_animations_test_badge_animation_path(type: 'critic', level: 'silver'), 
                method: :post, 
                class: "bg-gray-400 hover:bg-gray-500 text-white px-3 py-2 rounded text-center text-sm transition-colors" do %>
              Silver
            <% end %>
            <%= link_to admin_animations_test_badge_animation_path(type: 'critic', level: 'gold'), 
                method: :post, 
                class: "bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-2 rounded text-center text-sm transition-colors" do %>
              Gold
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <!-- DonnÃ©es rÃ©centes -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
      <!-- RÃ©compenses rÃ©centes -->
      <div class="bg-gray-800 rounded-lg p-6">
        <h2 class="text-xl font-bold mb-4">ğŸ“¦ RÃ©compenses rÃ©centes</h2>
        <% if @recent_rewards.any? %>
          <div class="space-y-3">
            <% @recent_rewards.each do |reward| %>
              <div class="bg-gray-700 rounded-lg p-3">
                <div class="flex justify-between items-center">
                  <div>
                    <div class="font-semibold"><%= reward.reward_description %></div>
                    <div class="text-sm text-gray-400"><%= reward.reward_type.humanize %></div>
                  </div>
                  <div class="text-right">
                    <div class="text-sm <%= reward.unlocked? ? 'text-green-400' : 'text-gray-400' %>">
                      <%= reward.unlocked? ? 'âœ… DÃ©bloquÃ©' : 'ğŸ”’ VerrouillÃ©' %>
                    </div>
                    <% if reward.unlocked_at %>
                      <div class="text-xs text-gray-500">
                        <%= reward.unlocked_at.strftime("%d/%m %H:%M") %>
                      </div>
                    <% end %>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <p class="text-gray-400">Aucune rÃ©compense rÃ©cente</p>
        <% end %>
      </div>

      <!-- Badges rÃ©cents -->
      <div class="bg-gray-800 rounded-lg p-6">
        <h2 class="text-xl font-bold mb-4">ğŸ† Badges rÃ©cents</h2>
        <% if @recent_badges.any? %>
          <div class="space-y-3">
            <% @recent_badges.each do |user_badge| %>
              <div class="bg-gray-700 rounded-lg p-3">
                <div class="flex justify-between items-center">
                  <div>
                    <div class="font-semibold"><%= user_badge.badge.name %></div>
                    <div class="text-sm text-gray-400"><%= user_badge.badge.badge_type.humanize %></div>
                  </div>
                  <div class="text-right">
                    <div class="text-sm text-green-400">âœ… GagnÃ©</div>
                    <% if user_badge.earned_at %>
                      <div class="text-xs text-gray-500">
                        <%= user_badge.earned_at.strftime("%d/%m %H:%M") %>
                      </div>
                    <% end %>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <p class="text-gray-400">Aucun badge rÃ©cent</p>
        <% end %>
      </div>
    </div>

    <!-- Actions d'administration -->
    <div class="bg-gray-800 rounded-lg p-6">
      <h2 class="text-xl font-bold mb-4">ğŸ› ï¸ Actions d'administration</h2>
      
      <div class="flex flex-wrap gap-4">
        <%= link_to admin_animations_cleanup_test_data_path, 
            method: :post, 
            class: "bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors",
            confirm: "ÃŠtes-vous sÃ»r de vouloir supprimer toutes les donnÃ©es de test ?" do %>
          ğŸ—‘ï¸ Nettoyer les donnÃ©es de test
        <% end %>
        
        <%= link_to reward_animations_demo_path, 
            target: "_blank",
            class: "bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors" do %>
          ğŸ‰ Voir la page des animations
        <% end %>
        
        <%= link_to root_path, 
            class: "bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-colors" do %>
          ğŸ  Retour Ã  l'accueil
        <% end %>
      </div>
    </div>

    <!-- Instructions -->
    <div class="bg-blue-900 rounded-lg p-6 mt-8">
      <h2 class="text-xl font-bold mb-4">ğŸ’¡ Instructions</h2>
      <div class="space-y-2 text-sm">
        <p>â€¢ <strong>RÃ©compenses:</strong> Cliquez sur un type pour crÃ©er et dÃ©bloquer une rÃ©compense de test</p>
        <p>â€¢ <strong>Badges:</strong> Cliquez sur un niveau pour crÃ©er et attribuer un badge de test</p>
        <p>â€¢ <strong>Animations:</strong> Les animations se dÃ©clenchent automatiquement lors de la crÃ©ation</p>
        <p>â€¢ <strong>Cache:</strong> Les donnÃ©es d'animation sont stockÃ©es en cache pour le frontend</p>
        <p>â€¢ <strong>Nettoyage:</strong> Utilisez le bouton rouge pour supprimer les donnÃ©es de test</p>
      </div>
    </div>
  </div>
</div>

<!-- Script pour dÃ©clencher les animations depuis le cache -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // VÃ©rifier s'il y a des donnÃ©es d'animation en cache Ã  afficher
  const rewardCacheKeys = <%= Rails.cache.instance_variable_get(:@data)&.keys&.grep(/reward_animation_#{@user.id}_/)&.to_json || [].to_json %>;
  const badgeCacheKeys = <%= Rails.cache.instance_variable_get(:@data)&.keys&.grep(/badge_animation_#{@user.id}_/)&.to_json || [].to_json %>;
  
  console.log('ğŸ‰ DonnÃ©es d\'animation en cache:');
  console.log('ğŸ“¦ RÃ©compenses:', rewardCacheKeys);
  console.log('ğŸ† Badges:', badgeCacheKeys);
  
  // Afficher les donnÃ©es en cache dans la console pour debug
  rewardCacheKeys.forEach(key => {
    const data = <%= Rails.cache.read("reward_animation_#{@user.id}_1")&.to_json || 'null' %>;
    if (data) console.log('ğŸ“¦ Cache reward:', key, data);
  });
  
  badgeCacheKeys.forEach(key => {
    const data = <%= Rails.cache.read("badge_animation_#{@user.id}_1")&.to_json || 'null' %>;
    if (data) console.log('ğŸ† Cache badge:', key, data);
  });
});
</script>
