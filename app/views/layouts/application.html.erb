<!DOCTYPE html>
<html lang="<%= I18n.locale %>">
  <head>
    <title>Tube'NPlay - <%= content_for?(:seo_title) ? yield(:seo_title) : t('seo.title', default: 'Jeu musical interactif sur YouTube') %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="<%= content_for?(:seo_description) ? yield(:seo_description) : t('seo.description', default: 'Tube\'NPlay - Découvrez et jouez avec vos playlists YouTube préférées. Quiz musical interactif, badges, récompenses et plus encore !') %>">
    <meta name="keywords" content="<%= content_for?(:seo_keywords) ? yield(:seo_keywords) : t('seo.keywords', default: 'Tube\'NPlay, jeu musical, YouTube, playlist, quiz musique, badges, récompenses, découverte musique') %>">
    <meta name="author" content="Tube'NPlay">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://www.tubenplay.com<%= request.path %>">
    
    <!-- Google Search Console Verification -->
    <!-- Ajoutez ici la balise meta de validation Google Search Console -->
    <!-- Exemple: <meta name="google-site-verification" content="VOTRE_CODE_ICI" /> -->
    
    <!-- Google Analytics 4 -->
    <% if ENV['GA_MEASUREMENT_ID'].present? %>
      <script async src="https://www.googletagmanager.com/gtag/js?id=<%= ENV['GA_MEASUREMENT_ID'] %>"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', '<%= ENV['GA_MEASUREMENT_ID'] %>', {
          'page_path': '<%= request.path %>',
          'page_title': '<%= t('seo.title', default: 'Jeu musical interactif sur YouTube') %>'
        });
      </script>
    <% end %>
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.tubenplay.com<%= request.path %>">
    <meta property="og:title" content="Tube'NPlay - <%= content_for?(:seo_title) ? yield(:seo_title) : t('seo.title', default: 'Jeu musical interactif sur YouTube') %>">
    <meta property="og:description" content="<%= content_for?(:seo_description) ? yield(:seo_description) : t('seo.description', default: 'Découvrez et jouez avec vos playlists YouTube préférées. Quiz musical interactif, badges, récompenses et plus encore !') %>">
    <meta property="og:image" content="<%= request.base_url %><%= asset_path('Logo/Copilot_20251006_162220.png') %>">
    <meta property="og:site_name" content="Tube'NPlay">
    <meta property="og:locale" content="<%= I18n.locale == :fr ? 'fr_FR' : 'en_US' %>">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://www.tubenplay.com<%= request.path %>">
    <meta name="twitter:title" content="Tube'NPlay - <%= content_for?(:seo_title) ? yield(:seo_title) : t('seo.title', default: 'Jeu musical interactif sur YouTube') %>">
    <meta name="twitter:description" content="<%= content_for?(:seo_description) ? yield(:seo_description) : t('seo.description', default: 'Découvrez et jouez avec vos playlists YouTube préférées. Quiz musical interactif, badges, récompenses et plus encore !') %>">
    <meta name="twitter:image" content="<%= request.base_url %><%= asset_path('Logo/Copilot_20251006_162220.png') %>">
    
    <%= favicon_link_tag "Logo/Copilot_20251006_162220.png" %>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= javascript_include_tag "application", "data-turbo-track": "reload" %>
    <style>
      /* Navigation Styles */
      .nav {
        background-color: #111827;
        color: white;
        position: sticky;
        top: 0;
        z-index: 1000;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      
      .nav-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1rem;
        position: relative;
      }
      
      .nav-content {
        display: flex;
        align-items: center;
        justify-content: space-between;
        height: 64px;
      }
      
      .logo {
        display: flex;
        align-items: center;
        font-weight: bold;
        font-size: 1.25rem;
        color: white;
        text-decoration: none;
        transition: all 0.3s ease;
        padding: 0.5rem;
        border-radius: 0.375rem;
      }
      
      .logo:hover {
        background-color: rgba(255, 255, 255, 0.1);
        transform: scale(1.05);
      }
      
      .logo svg {
        width: 32px;
        height: 32px;
        margin-right: 0.5rem;
      }
      
      .main-menu {
        display: flex;
        gap: 1.5rem;
      }
      
      .user-menu {
        display: flex;
        gap: 1rem;
      }
      
      .nav-link {
        color: #e5e7eb;
        text-decoration: none;
        font-size: 0.9rem;
        padding: 0.5rem 0.75rem;
        border-radius: 0.375rem;
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
        z-index: 1002;
      }
      
      .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.1);
        color: white;
        transform: scale(1.05);
      }
      
      .mobile-menu-button {
        display: none;
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        padding: 0.5rem;
      }
      
      .mobile-menu {
        display: none !important;
        flex-direction: column !important;
        padding: 0 !important;
        background-color: #1f2937 !important;
        border-radius: 0 0 0.5rem 0.5rem !important;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1) !important;
        z-index: 1001 !important;
        position: absolute !important;
        top: 100% !important;
        left: 0 !important;
        right: 0 !important;
        width: 100% !important;
        max-height: 300px !important;
        overflow-y: auto !important;
      }
      
      .mobile-menu.show {
        display: flex !important;
        padding: 1rem 0 !important;
      }
      
      .mobile-menu .nav-link {
        padding: 0.75rem 1rem !important;
        border-radius: 0 !important;
        font-size: 1rem !important;
      }
      
      .mobile-menu .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.05) !important;
      }
      
      /* Responsive - garantir les mêmes dimensions sur mobile */
      @media (max-width: 1024px) {
        .mobile-menu {
          display: none !important;
          flex-direction: column !important;
          padding: 0 !important;
          background-color: #1f2937 !important;
          border-radius: 0 0 0.5rem 0.5rem !important;
          box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1) !important;
          z-index: 1001 !important;
          position: absolute !important;
          top: 100% !important;
          left: 0 !important;
          right: 0 !important;
          width: 100% !important;
          max-height: 300px !important;
          overflow-y: auto !important;
        }
        
        .mobile-menu.show {
          display: flex !important;
          padding: 1rem 0 !important;
        }
        
        .mobile-menu .nav-link {
          padding: 0.75rem 1rem !important;
          border-radius: 0 !important;
          font-size: 1rem !important;
        }
        
        #game-in-progress-notification {
          max-width: 1200px !important;
          margin: 1rem auto !important;
          padding: 0 1rem !important;
        }
        
        #game-in-progress-notification .flash-notice {
          padding: 0.75rem 1rem !important;
          font-size: 1rem !important;
          margin-bottom: 1rem !important;
          display: flex !important;
          align-items: center !important;
          justify-content: space-between !important;
          gap: 1rem !important;
          flex-wrap: wrap !important;
          line-height: 1.5 !important;
          box-sizing: border-box !important;
          min-height: 48px !important;
        }
      }
      
      /* Flash messages */
      .flash {
        max-width: 1200px !important;
        margin: 1rem auto !important;
        padding: 0 1rem !important;
      }
      
      .flash-notice, .flash-alert {
        padding: 0.75rem 1rem !important;
        border-radius: 0.375rem !important;
        margin-bottom: 1rem !important;
      }
      
      .flash-notice {
        background-color: #9333ea !important;
        color: white !important;
      }
      
      .flash-alert {
        background-color: #ef4444 !important;
        color: white !important;
      }
      
      /* Notification partie en cours - dimensions fixes */
      #game-in-progress-notification {
        max-width: 1200px !important;
        margin: 1rem auto !important;
        padding: 0 1rem !important;
      }
      
      #game-in-progress-notification .flash-notice {
        padding: 0.75rem 1rem !important;
        font-size: 1rem !important;
        margin-bottom: 1rem !important;
        display: flex !important;
        align-items: center !important;
        justify-content: space-between !important;
        gap: 1rem !important;
        flex-wrap: wrap !important;
        line-height: 1.5 !important;
        box-sizing: border-box !important;
        min-height: 48px !important;
      }
      
      #game-in-progress-notification .flash-notice span {
        font-size: 1rem !important;
        flex: 1 !important;
        min-width: 200px !important;
        line-height: 1.5 !important;
      }
      
      #game-in-progress-notification .flash-notice a {
        font-size: 1rem !important;
        padding: 0.5rem 1rem !important;
        line-height: 1.5 !important;
        white-space: nowrap !important;
        flex-shrink: 0 !important;
        text-decoration: none !important;
      }
      
      .main-content {
        min-height: calc(100vh - 64px);
      }

      .site-footer {
        background-color: #0b1220;
        color: #9ca3af;
        padding: 2.5rem 1rem;
        margin-top: 2rem;
        border-top: 1px solid rgba(255, 255, 255, 0.05);
      }

      .footer-container {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        flex-wrap: wrap;
        gap: 2rem;
        justify-content: space-between;
      }

      .footer-brand {
        max-width: 280px;
      }

      .footer-heading {
        color: white;
        font-weight: 600;
        margin-bottom: 0.75rem;
      }

      .footer-links,
      .footer-social {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .footer-link {
        color: #e5e7eb;
        text-decoration: none;
        transition: color 0.2s ease;
      }

      .footer-link:hover {
        color: white;
      }

      .footer-bottom {
        margin-top: 2rem;
        text-align: center;
        font-size: 0.85rem;
        color: #6b7280;
      }
      
      /* Responsive styles */
      @media (max-width: 1024px) {
        .main-menu, .user-menu {
          display: none !important;
        }
        
        .mobile-menu-button {
          display: block !important;
        }
        
        .logo {
          font-size: 1rem !important;
          padding: 0.25rem !important;
        }
        
        .logo svg,
        .logo img {
          width: 24px !important;
          height: 24px !important;
        }
        
        .nav-content {
          height: auto !important;
          min-height: 47px !important;
          display: flex !important;
          align-items: center !important;
          justify-content: space-between !important;
        }
      }
    </style>
  </head>

  <body class="bg-gray-900 text-white">
    <nav class="nav">
      <div class="nav-container">
        <div class="nav-content">
          <!-- Logo -->
          <a href="<%= root_path %>" class="logo" title="<%= t('layout.logo_title') %>" onclick="window.location.href='<%= root_path %>'; return false;">
            <%= image_tag "Logo/Copilot_20251006_162220.png", alt: "Tube'NPlay", class: "w-8 h-8 mr-2 object-contain" %>
            <span>Tube'<span style="color: #9333ea;">N</span>Play</span>
          </a>

          <!-- Menu principal -->
          <div class="main-menu">
            <%= link_to t('nav.playlists'), playlists_path, class: "nav-link" %>
            <%= link_to t('nav.scores'), scores_path, class: "nav-link" %>
            <%= link_to t('nav.badges'), my_badges_path, class: "nav-link" %>
            <%= link_to t('nav.rewards'), my_rewards_path, class: "nav-link" %>
            <%= link_to t('nav.store'), store_path, class: "nav-link" %>
            <%= link_to t('nav.about'), about_path, class: "nav-link" %>
            <%= link_to t('nav.blog'), blog_path, class: "nav-link" %>
          </div>

          <!-- Menu utilisateur -->
          <div class="user-menu">
            <!-- Sélecteur de langue -->
            <div class="language-selector" style="display: flex; gap: 0.5rem; align-items: center; margin-right: 1rem;">
              <%= link_to "FR", url_for(locale: :fr), class: "nav-link #{'font-bold text-purple-400' if I18n.locale == :fr}", style: "padding: 0.25rem 0.5rem; min-width: 32px; text-align: center;" %>
              <span class="text-gray-500">|</span>
              <%= link_to "EN", url_for(locale: :en), class: "nav-link #{'font-bold text-purple-400' if I18n.locale == :en}", style: "padding: 0.25rem 0.5rem; min-width: 32px; text-align: center;" %>
            </div>
            
            <% if user_signed_in? %>
              <span class="nav-link text-purple-400 font-medium">
                <%= current_user.email %>
              </span>
              <%= link_to t('nav.profile'), profile_path, class: "nav-link" %>
              <%= form_with url: destroy_user_session_path, method: :delete, local: true, class: "inline" do |f| %>
                <%= f.submit t('nav.sign_out'), class: "nav-link bg-transparent border-0 cursor-pointer" %>
              <% end %>
            <% else %>
              <%= link_to t('nav.sign_in'), new_user_session_path, class: "nav-link" %>
            <% end %>
          </div>

          <!-- Bouton menu mobile -->
          <button class="mobile-menu-button" id="mobile-menu-button" aria-label="Menu" aria-expanded="false" aria-controls="mobile-menu">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
        </div>

        <!-- Menu mobile -->
        <div class="mobile-menu" id="mobile-menu">
          <%= link_to t('nav.playlists'), playlists_path, class: "nav-link" %>
          <%= link_to t('nav.scores'), scores_path, class: "nav-link" %>
          <%= link_to t('nav.badges'), my_badges_path, class: "nav-link" %>
          <%= link_to t('nav.rewards'), my_rewards_path, class: "nav-link" %>
          <%= link_to t('nav.store'), store_path, class: "nav-link" %>
          <%= link_to t('nav.about'), about_path, class: "nav-link" %>
          <%= link_to t('nav.blog'), blog_path, class: "nav-link" %>

          <!-- Sélecteur de langue mobile -->
          <div class="border-t border-gray-700 my-2"></div>
          <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 0.5rem 1rem;">
            <%= link_to "FR", url_for(locale: :fr), class: "nav-link #{'font-bold text-purple-400' if I18n.locale == :fr}", style: "padding: 0.25rem 0.5rem; min-width: 40px; text-align: center;" %>
            <span class="text-gray-500">|</span>
            <%= link_to "EN", url_for(locale: :en), class: "nav-link #{'font-bold text-purple-400' if I18n.locale == :en}", style: "padding: 0.25rem 0.5rem; min-width: 40px; text-align: center;" %>
          </div>
          
          <% if user_signed_in? %>
            <div class="border-t border-gray-700 my-2"></div>
            <span class="nav-link text-purple-400 font-medium">
              <%= current_user.email %>
            </span>
            <%= link_to t('nav.profile'), profile_path, class: "nav-link" %>
            <%= form_with url: destroy_user_session_path, method: :delete, local: true, class: "inline w-full" do |f| %>
              <%= f.submit t('nav.sign_out'), class: "nav-link text-left w-full bg-transparent border-0 cursor-pointer" %>
            <% end %>
          <% else %>
            <div class="border-t border-gray-700 my-2"></div>
            <%= link_to t('nav.sign_in'), new_user_session_path, class: "nav-link" %>
          <% end %>
        </div>
      </div>
    </nav>

    <!-- Messages flash -->
    <% if notice %>
      <div class="flash">
        <div class="flash-notice">
          <%= notice.html_safe %>
        </div>
      </div>
    <% end %>

    <% if alert %>
      <div class="flash">
        <div class="flash-alert">
          <%= alert.html_safe %>
        </div>
      </div>
    <% end %>

    <!-- Notification partie en cours -->
    <% if user_signed_in? && has_game_in_progress? %>
      <% game = current_game_in_progress %>
      <% # Ne pas afficher la notification sur les pages de jeu %>
      <% is_game_page = request.path.match?(%r{/playlists/\d+/games(/\d+)?(/swipe|/results)?$}) %>
      <% unless is_game_page %>
        <div class="flash" id="game-in-progress-notification">
          <div class="flash-notice" style="display: flex; align-items: center; justify-content: space-between; gap: 1rem; flex-wrap: wrap; font-size: 1rem;">
            <span style="flex: 1; min-width: 200px; font-size: 1rem;">
              <%= t('layout.game_in_progress_html', playlist: game.playlist.title).html_safe %>
            </span>
            <%= link_to t('layout.resume_game'), playlist_game_path_with_locale(game.playlist, game), 
                class: "bg-white text-purple-600 px-4 py-2 rounded font-semibold hover:bg-gray-100 transition-colors",
                style: "text-decoration: none; white-space: nowrap; flex-shrink: 0; font-size: 1rem;" %>
          </div>
        </div>
      <% end %>
    <% end %>

    <div class="main-content">
      <%= yield %>
    </div>

    <footer class="site-footer">
      <% social_links = {
        instagram: ENV['SOCIAL_INSTAGRAM_URL'],
        tiktok: ENV['SOCIAL_TIKTOK_URL'],
        youtube: ENV['SOCIAL_YOUTUBE_URL'],
        twitter: ENV['SOCIAL_TWITTER_URL'],
        facebook: ENV['SOCIAL_FACEBOOK_URL'],
        linkedin: ENV['SOCIAL_LINKEDIN_URL']
      }.compact %>
      <div class="footer-container">
        <div class="footer-brand">
          <div class="footer-heading">Tube'NPlay</div>
          <p><%= t('footer.tagline') %></p>
        </div>
        <div class="footer-links">
          <div class="footer-heading"><%= t('footer.about_heading') %></div>
          <%= link_to t('nav.about'), about_path, class: "footer-link" %>
          <%= link_to t('nav.blog'), blog_path, class: "footer-link" %>
          <%= link_to t('footer.contact'), contact_path, class: "footer-link" %>
        </div>
        <div class="footer-links">
          <div class="footer-heading"><%= t('footer.resources_heading') %></div>
          <%= link_to t('nav.playlists'), playlists_path, class: "footer-link" %>
          <%= link_to t('nav.scores'), scores_path, class: "footer-link" %>
          <%= link_to t('nav.store'), store_path, class: "footer-link" %>
        </div>
        <div class="footer-social">
          <div class="footer-heading"><%= t('footer.social_heading') %></div>
          <% if social_links.any? %>
            <% social_links.each do |name, url| %>
              <%= link_to t("footer.social_links.#{name}"), url, class: "footer-link", target: "_blank", rel: "noopener noreferrer" %>
            <% end %>
          <% else %>
            <span><%= t('footer.social_missing') %></span>
          <% end %>
        </div>
      </div>
      <div class="footer-bottom">
        <%= t('footer.copyright', year: Time.current.year) %>
      </div>
    </footer>

    <script>
      (function() {
        // Utiliser window pour éviter les conflits de variables
        if (!window.mobileMenuInitialized) {
          window.mobileMenuDocumentClick = null;
          window.mobileMenuKeydown = null;
          window.mobileMenuInitialized = true;
        }

        function setupMobileMenu() {
          console.log('setupMobileMenu called');
          const mobileMenuButton = document.getElementById('mobile-menu-button');
          const mobileMenu = document.getElementById('mobile-menu');
          const nav = document.querySelector('.nav');
          
          console.log('mobileMenuButton:', mobileMenuButton);
          console.log('mobileMenu:', mobileMenu);
          console.log('nav:', nav);
          
          if (!mobileMenuButton || !mobileMenu) {
            console.log('Menu elements not found');
            return;
          }

          if (window.mobileMenuDocumentClick) document.removeEventListener('click', window.mobileMenuDocumentClick);
          if (window.mobileMenuKeydown) document.removeEventListener('keydown', window.mobileMenuKeydown);

          function closeMobileMenuDirect(menuElement, buttonElement) {
            menuElement.classList.remove('show');
            menuElement.style.display = 'none';
            buttonElement.setAttribute('aria-expanded', 'false');
            buttonElement.innerHTML = `
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
              </svg>
            `;
          }

          function openMobileMenuDirect(menuElement, buttonElement) {
            console.log('openMobileMenuDirect called with elements:', menuElement, buttonElement);
            menuElement.classList.add('show');
            
            // Forcer l'application des styles CSS
            menuElement.style.display = 'flex';
            menuElement.style.position = 'absolute';
            menuElement.style.top = '100%';
            menuElement.style.left = '0';
            menuElement.style.right = '0';
            menuElement.style.width = '100%';
            menuElement.style.backgroundColor = '#1f2937';
            menuElement.style.zIndex = '1001';
            menuElement.style.padding = '1rem 0';
            menuElement.style.borderRadius = '0 0 0.5rem 0.5rem';
            menuElement.style.boxShadow = '0 10px 15px -3px rgba(0, 0, 0, 0.1)';
            menuElement.style.flexDirection = 'column';
            
            console.log('Menu classes after adding show:', menuElement.className);
            console.log('Menu display style:', window.getComputedStyle(menuElement).display);
            console.log('Menu position:', window.getComputedStyle(menuElement).position);
            console.log('Menu top:', window.getComputedStyle(menuElement).top);
            console.log('Menu left:', window.getComputedStyle(menuElement).left);
            console.log('Menu width:', window.getComputedStyle(menuElement).width);
            console.log('Menu height:', window.getComputedStyle(menuElement).height);
            console.log('Menu z-index:', window.getComputedStyle(menuElement).zIndex);
            console.log('Menu background:', window.getComputedStyle(menuElement).backgroundColor);
            console.log('Menu is visible:', menuElement.offsetParent !== null);
            console.log('Menu offsetHeight:', menuElement.offsetHeight);
            console.log('Menu offsetWidth:', menuElement.offsetWidth);
            console.log('Menu innerHTML length:', menuElement.innerHTML.length);
            buttonElement.setAttribute('aria-expanded', 'true');
            buttonElement.innerHTML = `
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            `;
          }

          // Utiliser la délégation d'événement au niveau du document
          // Nettoyer l'ancien écouteur global
          if (window.mobileMenuGlobalClick) {
            document.removeEventListener('click', window.mobileMenuGlobalClick);
          }
          
                  // Créer le gestionnaire global
        window.mobileMenuGlobalClick = function(event) {
          // Vérifier si on clique spécifiquement sur le bouton du menu mobile
          const mobileMenuButton = event.target.closest('#mobile-menu-button');
          if (mobileMenuButton && !event.target.closest('.logo')) {
            console.log('Mobile menu button clicked!');
            event.preventDefault();
            event.stopPropagation();
            
            // Récupérer les éléments actuels à chaque clic
            const currentMobileMenu = document.getElementById('mobile-menu');
            const currentMobileMenuButton = document.getElementById('mobile-menu-button');
            console.log('Current mobile menu found:', currentMobileMenu);
            console.log('Current mobile menu button found:', currentMobileMenuButton);
            
            if (currentMobileMenu && currentMobileMenu.classList.contains('show')) {
              console.log('Closing mobile menu');
              closeMobileMenuDirect(currentMobileMenu, currentMobileMenuButton);
            } else if (currentMobileMenu) {
              console.log('Opening mobile menu');
              openMobileMenuDirect(currentMobileMenu, currentMobileMenuButton);
            }
          }
        };
          
          // Attacher l'écouteur global
          document.addEventListener('click', window.mobileMenuGlobalClick);

          mobileMenu.onclick = function(event) {
            if (event.target.closest('a, button')) {
              setTimeout(() => {
                closeMobileMenuDirect(mobileMenu, mobileMenuButton);
              }, 100);
            }
            event.stopPropagation();
          };

          window.mobileMenuDocumentClick = function(event) {
            if (mobileMenu.classList.contains('show') && !nav.contains(event.target)) {
              closeMobileMenuDirect(mobileMenu, mobileMenuButton);
            }
          };
          document.addEventListener('click', window.mobileMenuDocumentClick);

          window.mobileMenuKeydown = function(event) {
            if (event.key === 'Escape' && mobileMenu.classList.contains('show')) {
              closeMobileMenuDirect(mobileMenu, mobileMenuButton);
            }
          };
          document.addEventListener('keydown', window.mobileMenuKeydown);
        }

        document.addEventListener('turbo:before-cache', function() {
          if (window.mobileMenuDocumentClick) document.removeEventListener('click', window.mobileMenuDocumentClick);
          if (window.mobileMenuKeydown) document.removeEventListener('keydown', window.mobileMenuKeydown);
          if (window.mobileMenuGlobalClick) document.removeEventListener('click', window.mobileMenuGlobalClick);
        });

        document.addEventListener('turbo:load', function() {
          setTimeout(setupMobileMenu, 100);
        });
        document.addEventListener('DOMContentLoaded', setupMobileMenu);
        
        // Gestionnaire pour le logo (supprimé pour éviter les conflits avec Turbo)
      })();
    </script>
  </body>
</html>
