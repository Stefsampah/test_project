<!DOCTYPE html>
<html>
  <head>
    <title>Tube'NPlay - Shorts</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no,viewport-fit=cover,minimal-ui">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <%= favicon_link_tag "logo/Copilot_20251006_162220.png" %>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= javascript_include_tag "application", "data-turbo-track": "reload" %>
    
    <style>
      :root {
        --bottom-gap: calc(env(safe-area-inset-bottom, 0px) + 60px) !important;
        --url-bar-height: 60px !important;
      }
      
      /* Ligne de référence pour marquer la limite de l'URL - CACHÉE */
      .url-limit-line {
        display: none !important;
      }
      
      /* Supprimer complètement toutes les bordures et barres */
      .url-limit-line,
      .rainbow-line,
      .yellow-band,
      .color-band,
      .border,
      .outline {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
        height: 0 !important;
        width: 0 !important;
        border: none !important;
        outline: none !important;
      }
      
      /* Permettre la visibilité de la barre d'URL */
      html, body {
        background: transparent !important;
      }
      
      /* Forcer la suppression de tous les styles de fond et bordures SAUF pour les éléments spécifiques */
      .shorts-container, .shorts-player, .shorts-video {
        background: #000 !important;
      }
      
      /* Exception pour les boutons seulement */
      .action-btn {
        background: rgba(239,68,68,0.9) !important;
        border: 8px solid rgba(255,255,255,1) !important;
        box-shadow: 0 20px 60px rgba(239,68,68,1) !important;
      }
      
      .action-btn.like {
        background: rgba(34,197,94,0.9) !important;
        box-shadow: 0 20px 60px rgba(34,197,94,1) !important;
      }
      
      /* Cibler la div background spécifique pour définir la limite */
      div[data-v-0473de6c].background {
        position: relative !important;
        z-index: 0 !important;
      }
      
      /* Ajuster la vidéo pour s'arrêter au niveau de cette div */
      .shorts-video,
      .shorts-video iframe,
      #youtube-iframe,
      iframe {
        max-height: 100vh !important;
        max-height: 100dvh !important;
        max-height: 100svh !important;
      }
      /* Reset COMPLET - Override tout */
      * {
        margin: 0 !important;
        padding: 0 !important;
        box-sizing: border-box !important;
        border: none !important;
        outline: none !important;
      }
      
      html {
        width: 100vw !important;
        height: 100vh !important;
        height: 100dvh !important;
        height: 100svh !important;
        overflow: hidden !important;
        background: #000 !important;
        margin: 0 !important;
        padding: 0 !important;
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        z-index: 99999 !important;
        font-size: 16px !important;
        -webkit-text-size-adjust: 100% !important;
        -ms-text-size-adjust: 100% !important;
      }
      
      /* Permettre le scroll sur les pages de résultats */
      html.results-page, body.results-page {
        overflow: auto !important;
        position: relative !important;
        height: auto !important;
        min-height: 100vh !important;
      }
      
      body {
        width: 100vw !important;
        height: 100vh !important;
        height: 100dvh !important;
        height: 100svh !important;
        overflow: hidden !important;
        background: #000 !important;
        color: white !important;
        margin: 0 !important;
        padding: 0 !important;
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        z-index: 99999 !important;
        -webkit-overflow-scrolling: touch;
        overscroll-behavior: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        font-family: system-ui, -apple-system, sans-serif !important;
        -webkit-text-size-adjust: 100% !important;
        -ms-text-size-adjust: 100% !important;
        touch-action: none !important;
      }
      
      /* Masquer TOUS les éléments de navigation et layout */
      nav, .nav, .main-content, .flash, header, footer, .header, .footer {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
        height: 0 !important;
        width: 0 !important;
        margin: 0 !important;
        padding: 0 !important;
      }
      
      /* Forcer le plein écran ABSOLU - Version mobile ultra-optimisée */
      .shorts-container,
      .new-game-container,
      .play-container {
        width: 100vw !important;
        height: 100vh !important;
        height: 100dvh !important; /* Dynamic viewport height */
        height: 100svh !important; /* Small viewport height */
        height: 100lvh !important; /* Large viewport height */
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        bottom: 0 !important;
        z-index: 99999 !important;
        margin: 0 !important;
        padding: 0 !important;
        border-radius: 0 !important;
        box-shadow: none !important;
        max-width: none !important;
        max-height: none !important;
        background: #000 !important;
        display: flex !important;
        justify-content: center !important;
        align-items: center !important;
        transform: translateZ(0) !important;
        will-change: transform !important;
        touch-action: none !important;
        -webkit-touch-callout: none !important;
        -webkit-tap-highlight-color: transparent !important;
        overflow-y: auto !important;
      }
      
      /* Pages de résultats - permettre le scroll avec respect des safe areas */
      .results-container,
      .reward-results-container {
        width: 100vw !important;
        min-height: 100vh !important;
        min-height: 100dvh !important;
        min-height: 100svh !important;
        position: relative !important;
        top: auto !important;
        left: auto !important;
        right: auto !important;
        bottom: auto !important;
        z-index: 99999 !important;
        margin: 0 !important;
        padding-top: env(safe-area-inset-top, 0px) !important;
        padding-bottom: env(safe-area-inset-bottom, 0px) !important;
        padding-left: 0 !important;
        padding-right: 0 !important;
        border-radius: 0 !important;
        box-shadow: none !important;
        max-width: none !important;
        max-height: none !important;
        background: #000 !important;
        display: block !important;
        transform: none !important;
        will-change: auto !important;
        touch-action: auto !important;
        -webkit-touch-callout: default !important;
        -webkit-tap-highlight-color: auto !important;
        overflow-y: auto !important;
        overflow-x: hidden !important;
        box-sizing: border-box !important;
        height: auto !important;
      }
      
      /* Contenu interne avec padding pour éviter le débordement */
      .results-container > div,
      .reward-results-container > div {
        padding-top: max(env(safe-area-inset-top, 0px), 20px) !important;
        padding-bottom: max(env(safe-area-inset-bottom, 0px), 20px) !important;
        box-sizing: border-box !important;
        max-width: 100vw !important;
        overflow-x: hidden !important;
        overflow-y: visible !important;
        height: auto !important;
        min-height: auto !important;
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
      }
      
      /* Empêcher le débordement horizontal */
      .results-container *,
      .reward-results-container * {
        max-width: 100% !important;
        box-sizing: border-box !important;
      }
      
      /* Forcer la visibilité des listes de chansons */
      .results-container .space-y-4,
      .results-container .space-y-4 > * {
        visibility: visible !important;
        opacity: 1 !important;
        display: block !important;
        height: auto !important;
        min-height: auto !important;
        max-height: none !important;
        overflow: visible !important;
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
      }
      
      .results-container .space-y-4 > div {
        display: flex !important;
        visibility: visible !important;
        opacity: 1 !important;
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
        overflow: hidden !important;
        word-wrap: break-word !important;
      }
      
      .results-container .space-y-4 span {
        display: inline-block !important;
        visibility: visible !important;
        opacity: 1 !important;
        word-wrap: break-word !important;
        overflow-wrap: break-word !important;
      }
      
      
      /* Assurer que le contenu respecte les limites du viewport */
      @supports (height: 100dvh) {
        .results-container,
        .reward-results-container {
          min-height: 100dvh !important;
        }
      }
      
      @supports (height: 100svh) {
        .results-container,
        .reward-results-container {
          min-height: 100svh !important;
        }
      }

      /* Styles ultra-agressifs pour forcer le plein écran complet */
      .shorts-video {
        width: 100vw !important;
        height: 100vh !important;
        height: 100svh !important;
        height: 100dvh !important;
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        bottom: 0 !important;
        overflow: hidden !important;
        z-index: 1 !important;
        /* Forcer le remplissage complet */
        background: #000 !important;
        display: block !important;
      }

      /* Styles pour forcer le plein écran - Couvrir tout l'écran */
      .shorts-video iframe,
      #youtube-iframe,
      iframe {
        width: 100vw !important;
        height: 100vh !important;
        height: 100svh !important;
        height: 100dvh !important;
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        bottom: 0 !important;
        border: none !important;
        margin: 0 !important;
        padding: 0 !important;
        max-width: none !important;
        max-height: 100vh !important;
        max-height: 100svh !important;
        max-height: 100dvh !important;
        min-width: 100vw !important;
        min-height: 100vh !important;
        min-height: 100svh !important;
        min-height: 100dvh !important;
        /* Utiliser un scale pour forcer le remplissage complet */
        transform: scale(1.2) !important;
        transform-origin: center center !important;
        object-fit: cover !important;
        z-index: 1 !important;
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
        /* Forcer le remplissage complet de l'écran */
        background-size: cover !important;
        background-position: center !important;
        background-repeat: no-repeat !important;
      }

      /* Forcer tous les éléments iframe - Couvrir tout l'écran */
      iframe[src*="youtube"] {
        width: 100vw !important;
        height: 100vh !important;
        height: 100svh !important;
        height: 100dvh !important;
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        bottom: 0 !important;
        margin: 0 !important;
        padding: 0 !important;
        border: none !important;
        margin: 0 !important;
        padding: 0 !important;
        max-width: none !important;
        max-height: 100vh !important;
        max-height: 100svh !important;
        max-height: 100dvh !important;
        min-width: 100vw !important;
        min-height: 100vh !important;
        min-height: 100svh !important;
        min-height: 100dvh !important;
        /* Utiliser un scale pour forcer le remplissage complet */
        transform: scale(2.8) !important;
        transform-origin: center center !important;
        z-index: 1 !important;
        /* Forcer le remplissage complet */
        background-size: cover !important;
        background-position: center !important;
        background-repeat: no-repeat !important;
        /* Contourner les limitations de ratio d'aspect de YouTube */
        aspect-ratio: unset !important;
        object-fit: cover !important;
        object-position: center !important;
      }

      /* Contrôles et overlay - Superposés sur l'image au bas */
      .shorts-controls {
        position: fixed !important;
        bottom: 170px !important;
        left: 0 !important;
        right: 0 !important;
        background: linear-gradient(transparent, rgba(0,0,0,0.8)) !important;
        padding: 20px 20px 30px 20px !important;
        z-index: 999999 !important;
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
        pointer-events: auto !important;
      }

      .shorts-info {
        margin-bottom: 5px !important;
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
        text-align: left !important;
        padding: 0 20px !important;
        z-index: 9999999 !important;
        position: relative !important;
      }

      .shorts-info h2 {
        color: white !important;
        font-size: 1.8rem !important;
        font-weight: 900 !important;
        margin-bottom: 10px !important;
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
        line-height: 1.2 !important;
        text-shadow: 0 6px 12px rgba(0,0,0,1) !important;
        background: transparent !important;
        padding: 0 !important;
        border-radius: 0 !important;
        backdrop-filter: none !important;
        border: none !important;
      }

      .shorts-info p {
        color: rgba(255,255,255,1) !important;
        font-size: 1.3rem !important;
        font-weight: 700 !important;
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
        margin: 0 !important;
        text-shadow: 0 4px 8px rgba(0,0,0,1) !important;
        background: transparent !important;
        padding: 0 !important;
        border-radius: 0 !important;
        backdrop-filter: none !important;
        border: none !important;
      }

      .shorts-actions {
        display: flex !important;
        gap: 20px !important;
        margin-top: 15px !important;
        justify-content: center !important;
        visibility: visible !important;
        opacity: 1 !important;
        z-index: 10000000 !important;
        padding: 0 20px !important;
        position: relative !important;
        /* Forcer l'affichage des boutons */
        height: auto !important;
        min-height: 100px !important;
        max-height: none !important;
        overflow: visible !important;
      }

      .action-btn {
        width: 60px !important;
        height: 60px !important;
        border-radius: 50% !important;
        border: 3px solid rgba(255,255,255,0.8) !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        cursor: pointer !important;
        transition: all 0.3s ease !important;
        padding: 0 !important;
        margin: 0 8px !important;
        position: relative !important;
        z-index: 10000000 !important;
        visibility: visible !important;
        opacity: 1 !important;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3) !important;
        backdrop-filter: blur(8px) !important;
      }

      .action-btn input[type="submit"] {
        width: 100% !important;
        height: 100% !important;
        border: none !important;
        background: transparent !important;
        color: white !important;
        cursor: pointer !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        padding: 0 !important;
        margin: 0 !important;
        font-size: 0 !important;
        line-height: 0 !important;
      }

      .action-btn.dislike {
        background: rgba(239,68,68,1) !important;
        color: white !important;
        border: 8px solid rgba(255,255,255,1) !important;
        box-shadow: 0 20px 60px rgba(239,68,68,1) !important;
      }

      .action-btn.like {
        background: rgba(34,197,94,1) !important;
        color: white !important;
        border: 8px solid rgba(255,255,255,1) !important;
        box-shadow: 0 20px 60px rgba(34,197,94,1) !important;
      }

      .action-btn:hover {
        transform: scale(1.2) !important;
        box-shadow: 0 8px 25px rgba(0,0,0,0.8) !important;
        border-color: rgba(255,255,255,0.9) !important;
      }

      .action-btn.dislike:hover {
        box-shadow: 0 8px 25px rgba(239,68,68,0.6) !important;
        background: rgba(239,68,68,1) !important;
      }

      .action-btn.like:hover {
        box-shadow: 0 8px 25px rgba(34,197,94,0.6) !important;
        background: rgba(34,197,94,1) !important;
      }

      .action-icon {
        width: 50px !important;
        height: 50px !important;
        color: white !important;
        filter: drop-shadow(0 5px 10px rgba(0,0,0,1)) !important;
      }

      .action-btn.dislike .action-icon {
        stroke: white !important;
        stroke-width: 2.5 !important;
      }

      .action-btn.like .action-icon {
        fill: white !important;
      }
      
      .shorts-player {
        width: 100vw !important;
        height: 100vh !important;
        height: 100dvh !important;
        height: 100svh !important;
        height: 100lvh !important;
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        bottom: 0 !important;
        z-index: 99999 !important;
        overflow: hidden !important;
        background: #000 !important;
        border-radius: 0 !important;
        box-shadow: none !important;
        max-width: none !important;
        max-height: none !important;
        margin: 0 !important;
        padding: 0 !important;
        transform: translateZ(0) !important;
        will-change: transform !important;
        touch-action: none !important;
        -webkit-touch-callout: none !important;
        -webkit-tap-highlight-color: transparent !important;
      }
      
      .shorts-end {
        width: 100vw !important;
        height: 100vh !important;
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        z-index: 99999 !important;
        margin: 0 !important;
        padding: 0 !important;
        border-radius: 0 !important;
        box-shadow: none !important;
        max-width: none !important;
        max-height: none !important;
        background: #000 !important;
        display: flex !important;
        justify-content: center !important;
        align-items: center !important;
      }
      
      /* Override Tailwind et autres frameworks */
      .min-h-screen, .max-w-6xl, .mx-auto, .px-4, .sm\\:px-6, .lg\\:px-8, .py-4, .sm\\:py-0 {
        width: 100vw !important;
        height: 100vh !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 0 !important;
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        z-index: 99999 !important;
      }
      
      /* Styles pour mobile - masquer les barres de navigation */
      @supports (-webkit-touch-callout: none) {
        html, body {
          height: -webkit-fill-available !important;
        }
        
        .shorts-container,
        .shorts-player,
        .shorts-end,
        .results-container,
        .reward-results-container,
        .new-game-container,
        .play-container {
          height: -webkit-fill-available !important;
        }
      }
      
      /* Masquer les barres de navigation sur iOS */
      @media screen and (max-width: 768px) {
        html, body {
          height: 100vh !important;
          height: calc(var(--vh, 1vh) * 100) !important;
        }
        
        .shorts-container,
        .shorts-player,
        .shorts-end,
        .results-container,
        .reward-results-container,
        .new-game-container,
        .play-container {
          height: 100vh !important;
          height: calc(var(--vh, 1vh) * 100) !important;
        }
      }
      
      /* Masquer les éléments de debug et développement */
      .debug, .development, .rails, .turbo {
        display: none !important;
      }
    </style>
  </head>

  <body>
    <%= yield %>
    
    <!-- Ligne de référence pour marquer la limite de l'URL -->
    <div class="url-limit-line"></div>
    
    <script>
      // Détecter si on est sur une page de résultats et permettre le scroll
      (function() {
        function enableScrollForResults() {
          const resultsContainer = document.querySelector('.results-container, .reward-results-container');
          if (resultsContainer) {
            // Calculer les safe areas
            const safeAreaTop = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--safe-area-inset-top') || '0') || 0;
            const safeAreaBottom = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--safe-area-inset-bottom') || '0') || 0;
            
            // Utiliser la hauteur du viewport dynamique (sans les barres du navigateur)
            const viewportHeight = window.innerHeight || document.documentElement.clientHeight;
            
            // Permettre le scroll sur html et body pour les pages de résultats
            document.documentElement.classList.add('results-page');
            document.body.classList.add('results-page');
            document.documentElement.style.cssText = `
              width: 100% !important;
              height: auto !important;
              min-height: ${viewportHeight}px !important;
              overflow: auto !important;
              background: #000 !important;
              margin: 0 !important;
              padding: 0 !important;
              position: relative !important;
              z-index: 1 !important;
            `;
            document.body.style.cssText = `
              width: 100% !important;
              height: auto !important;
              min-height: ${viewportHeight}px !important;
              overflow: visible !important;
              background: #000 !important;
              color: white !important;
              margin: 0 !important;
              padding: 0 !important;
              position: relative !important;
              z-index: 1 !important;
              -webkit-overflow-scrolling: touch !important;
              touch-action: auto !important;
            `;
            
            // Ajuster le conteneur de résultats pour respecter les safe areas
            if (resultsContainer) {
              const containerPaddingTop = Math.max(safeAreaTop, 20);
              const containerPaddingBottom = Math.max(safeAreaBottom, 20);
              resultsContainer.style.cssText = `
                width: 100vw !important;
                min-height: ${viewportHeight}px !important;
                position: relative !important;
                padding-top: ${containerPaddingTop}px !important;
                padding-bottom: ${containerPaddingBottom}px !important;
                padding-left: 0 !important;
                padding-right: 0 !important;
                box-sizing: border-box !important;
                overflow-y: visible !important;
              `;
              
              // Ajuster le contenu interne
              const innerContent = resultsContainer.querySelector('> div');
              if (innerContent) {
                const currentPaddingTop = parseInt(getComputedStyle(innerContent).paddingTop) || 0;
                const currentPaddingBottom = parseInt(getComputedStyle(innerContent).paddingBottom) || 0;
                innerContent.style.cssText += `
                  padding-top: ${Math.max(containerPaddingTop, currentPaddingTop)}px !important;
                  padding-bottom: ${Math.max(containerPaddingBottom, currentPaddingBottom)}px !important;
                  box-sizing: border-box !important;
                `;
              }
            }
            
            return true;
          }
          return false;
        }
        
        // Fonction pour calculer et appliquer les safe areas
        function applySafeAreas() {
          const resultsContainer = document.querySelector('.results-container, .reward-results-container');
          if (!resultsContainer) return;
          
          // Calculer la hauteur réelle du viewport visible
          const viewportHeight = window.innerHeight || document.documentElement.clientHeight;
          const screenHeight = window.screen.height;
          
          // Calculer les safe areas en comparant la hauteur de l'écran avec le viewport
          // La différence indique la hauteur des barres du navigateur
          const browserBarsHeight = screenHeight - viewportHeight;
          
          // Estimer les safe areas
          // Top : généralement la barre de statut (44px sur iOS, variable sur Android)
          const safeAreaTop = Math.max(
            parseInt(getComputedStyle(document.documentElement).getPropertyValue('--safe-area-inset-top')) || 0,
            44 // Minimum pour la barre de statut
          );
          
          // Bottom : la barre d'URL du navigateur (généralement 60-80px)
          const safeAreaBottom = Math.max(
            parseInt(getComputedStyle(document.documentElement).getPropertyValue('--safe-area-inset-bottom')) || 0,
            Math.max(browserBarsHeight - safeAreaTop, 60) // Au moins 60px pour la barre d'URL
          );
          
          // Appliquer les safe areas au conteneur
          resultsContainer.style.paddingTop = `${safeAreaTop}px`;
          resultsContainer.style.paddingBottom = `${safeAreaBottom}px`;
          resultsContainer.style.minHeight = `${viewportHeight}px`;
          resultsContainer.style.height = 'auto';
          resultsContainer.style.maxHeight = 'none';
          resultsContainer.style.boxSizing = 'border-box';
          resultsContainer.style.overflowY = 'auto';
          resultsContainer.style.overflowX = 'hidden';
          resultsContainer.style.position = 'relative';
          resultsContainer.style.display = 'block';
          resultsContainer.style.visibility = 'visible';
          resultsContainer.style.opacity = '1';
          
              // Ajuster le contenu interne pour qu'il ne déborde pas
              const innerContent = resultsContainer.querySelector('> div');
              if (innerContent) {
                // Ne pas écraser les paddings existants, juste s'assurer qu'ils ne sont pas trop petits
                const currentPaddingTop = parseInt(getComputedStyle(innerContent).paddingTop) || 0;
                const currentPaddingBottom = parseInt(getComputedStyle(innerContent).paddingBottom) || 0;
                
                // Utiliser le padding existant s'il est suffisant, sinon utiliser les safe areas
                innerContent.style.paddingTop = `${Math.max(safeAreaTop / 2, currentPaddingTop)}px`;
                innerContent.style.paddingBottom = `${Math.max(safeAreaBottom / 2, currentPaddingBottom)}px`;
                innerContent.style.boxSizing = 'border-box';
                innerContent.style.maxWidth = '100%';
                innerContent.style.overflowX = 'hidden';
                innerContent.style.overflowY = 'visible';
                innerContent.style.height = 'auto';
                innerContent.style.minHeight = 'auto';
                
                // Forcer la visibilité de tous les éléments enfants
                const allChildren = innerContent.querySelectorAll('*');
                allChildren.forEach(child => {
                  child.style.visibility = 'visible';
                  child.style.opacity = '1';
                  if (getComputedStyle(child).display === 'none') {
                    child.style.display = '';
                  }
                });
              }
        }
        
        // Vérifier immédiatement
        if (enableScrollForResults()) {
          applySafeAreas();
          return; // Si on est sur une page de résultats, ne pas exécuter le reste du script
        }
        
        // Vérifier après le chargement du DOM
        document.addEventListener('DOMContentLoaded', function() {
          if (enableScrollForResults()) {
            applySafeAreas();
            return;
          }
        });
        
        // Réappliquer sur resize/orientation change
        window.addEventListener('resize', applySafeAreas);
        window.addEventListener('orientationchange', function() {
          setTimeout(applySafeAreas, 100);
        });
      })();
      
      // Solution ULTRA-AGRESSIVE pour forcer le plein écran sur mobile
      (function() {
        // Fonction pour calculer la vraie hauteur de l'écran
        function getTrueScreenHeight() {
          const methods = [
            () => window.screen.height,
            () => window.screen.availHeight,
            () => window.outerHeight,
            () => window.innerHeight + (window.outerHeight - window.innerHeight),
            () => document.documentElement.clientHeight,
            () => document.body.clientHeight
          ];
          
          let maxHeight = 0;
          methods.forEach(method => {
            try {
              const height = method();
              if (height > maxHeight) maxHeight = height;
            } catch (e) {}
          });
          
          return maxHeight || window.innerHeight;
        }
        
        // Fonction pour forcer le plein écran
        function forceFullscreen() {
          const trueHeight = getTrueScreenHeight();
          const trueWidth = window.screen.width || window.innerWidth;
          
          // Forcer les styles sur html et body
        document.documentElement.style.cssText = `
            width: ${trueWidth}px !important;
          height: ${trueHeight}px !important; 
          overflow: hidden !important; 
          background: #000 !important; 
          margin: 0 !important; 
          padding: 0 !important; 
          position: fixed !important; 
          top: 0 !important; 
          left: 0 !important; 
          z-index: 99999 !important;
        `;
        
        document.body.style.cssText = `
            width: ${trueWidth}px !important;
          height: ${trueHeight}px !important; 
          overflow: hidden !important; 
          background: #000 !important; 
          color: white !important; 
          margin: 0 !important; 
          padding: 0 !important; 
          position: fixed !important; 
          top: 0 !important; 
          left: 0 !important; 
          z-index: 99999 !important;
          touch-action: none !important;
        `;
        
          // Forcer les styles sur les conteneurs
          const containers = document.querySelectorAll('.shorts-container, .shorts-player, .shorts-end, .results-container, .reward-results-container, .new-game-container, .play-container');
        containers.forEach(container => {
          container.style.cssText = `
              width: ${trueWidth}px !important;
            height: ${trueHeight}px !important; 
            position: fixed !important; 
            top: 0 !important; 
            left: 0 !important; 
            right: 0 !important;
            bottom: 0 !important;
            z-index: 99999 !important; 
            margin: 0 !important; 
            padding: 0 !important; 
            border-radius: 0 !important; 
            box-shadow: none !important; 
            max-width: none !important; 
            max-height: none !important; 
            background: #000 !important;
              transform: translateZ(0) !important;
              will-change: transform !important;
            touch-action: none !important;
          `;
        });
        
        // Masquer tous les éléments de navigation
          const hideElements = ['nav', '.nav', '.main-content', '.flash', 'header', 'footer'];
        hideElements.forEach(selector => {
          const elements = document.querySelectorAll(selector);
          elements.forEach(el => {
            el.style.cssText = 'display: none !important; visibility: hidden !important; opacity: 0 !important; height: 0 !important; width: 0 !important; margin: 0 !important; padding: 0 !important;';
          });
        });
        }
        
        // Fonction pour forcer les styles de l'iframe
        function forceIframeStyles() {
          const allIframes = document.querySelectorAll('iframe[src*="youtube"]');
          allIframes.forEach(function(iframe) {
            if (iframe) {
              iframe.style.setProperty('width', '100vw', 'important');
              iframe.style.setProperty('height', 'calc(100svh - var(--bottom-gap))', 'important');
              iframe.style.setProperty('height', 'calc(100dvh - var(--bottom-gap))', 'important');
              iframe.style.setProperty('height', 'calc(100vh - var(--bottom-gap))', 'important');
              iframe.style.setProperty('position', 'fixed', 'important');
              iframe.style.setProperty('top', '0', 'important');
              iframe.style.setProperty('left', '0', 'important');
              iframe.style.setProperty('right', '0', 'important');
              iframe.style.setProperty('bottom', 'var(--bottom-gap)', 'important');
              iframe.style.setProperty('border', 'none', 'important');
              iframe.style.setProperty('margin', '0', 'important');
              iframe.style.setProperty('padding', '0', 'important');
              iframe.style.setProperty('max-width', 'none', 'important');
              iframe.style.setProperty('max-height', '100vh', 'important');
              iframe.style.setProperty('max-height', '100svh', 'important');
              iframe.style.setProperty('max-height', '100dvh', 'important');
              iframe.style.setProperty('min-width', '100vw', 'important');
              iframe.style.setProperty('min-height', '100vh', 'important');
              iframe.style.setProperty('min-height', '100svh', 'important');
              iframe.style.setProperty('min-height', '100dvh', 'important');
              iframe.style.setProperty('transform', 'scale(2.8)', 'important');
              iframe.style.setProperty('z-index', '1', 'important');
              iframe.style.setProperty('display', 'block', 'important');
              iframe.style.setProperty('visibility', 'visible', 'important');
              iframe.style.setProperty('opacity', '1', 'important');
            }
          });
          
          const videoContainer = document.querySelector('.shorts-video');
          if (videoContainer) {
            videoContainer.style.setProperty('width', '100vw', 'important');
            videoContainer.style.setProperty('height', '100vh', 'important');
            videoContainer.style.setProperty('height', '100svh', 'important');
            videoContainer.style.setProperty('height', '100dvh', 'important');
            videoContainer.style.setProperty('position', 'fixed', 'important');
            videoContainer.style.setProperty('top', '0', 'important');
            videoContainer.style.setProperty('left', '0', 'important');
            videoContainer.style.setProperty('right', '0', 'important');
            videoContainer.style.setProperty('bottom', '0', 'important');
            videoContainer.style.setProperty('overflow', 'hidden', 'important');
            videoContainer.style.setProperty('z-index', '1', 'important');
          }
        }
        
        // Masquer les barres de navigation avec scroll
        function hideBrowserBars() {
          window.scrollTo(0, 1);
        }
        
        // Appliquer immédiatement
        forceFullscreen();
        forceIframeStyles();
        hideBrowserBars();
        
        // Variable pour stocker la limite calculée une seule fois
        let backgroundDivLimit = null;
        
        // Fonction pour détecter la div background et ajuster la limite (une seule fois)
        function adjustToBackgroundDiv() {
          // Si déjà calculé, ne pas refaire
          if (backgroundDivLimit !== null) return backgroundDivLimit;
          
          const backgroundDiv = document.querySelector('div[data-v-0473de6c].background');
          if (backgroundDiv) {
            const rect = backgroundDiv.getBoundingClientRect();
            backgroundDivLimit = window.innerHeight - rect.bottom;
            
            console.log('Background div found, limit set to:', backgroundDivLimit);
            
            // Appliquer la limite une seule fois
            const allIframes = document.querySelectorAll('iframe[src*="youtube"]');
            allIframes.forEach(function(iframe) {
              if (iframe) {
                iframe.style.setProperty('bottom', `${backgroundDivLimit}px`, 'important');
                iframe.style.setProperty('max-height', `calc(100vh - ${backgroundDivLimit}px)`, 'important');
              }
            });
            
            const controls = document.querySelector('.shorts-controls');
            if (controls) {
              controls.style.setProperty('bottom', `${backgroundDivLimit}px`, 'important');
            }
            
            return backgroundDivLimit;
          }
          return null;
        }
        
        // Fonction pour forcer la visibilité des contrôles
        function forceControlsVisibility() {
          const controls = document.querySelector('.shorts-controls');
          const actions = document.querySelector('.shorts-actions');
          const buttons = document.querySelectorAll('.action-btn');
          
          console.log('Debug controls:', { controls, actions, buttons: buttons.length });
          
          // Debug plus détaillé
          if (controls) {
            console.log('Controls found:', controls);
            console.log('Controls computed style:', window.getComputedStyle(controls));
          }
          if (actions) {
            console.log('Actions found:', actions);
            console.log('Actions computed style:', window.getComputedStyle(actions));
          }
          buttons.forEach((btn, index) => {
            console.log(`Button ${index}:`, btn);
            console.log(`Button ${index} computed style:`, window.getComputedStyle(btn));
          });
          
          if (controls) {
            controls.style.cssText = `
              position: fixed !important;
              bottom: 170px !important;
              left: 0 !important;
              right: 0 !important;
              background: linear-gradient(transparent, rgba(0,0,0,0.8)) !important;
              padding: 20px 20px 30px 20px !important;
              z-index: 999999 !important;
              display: block !important;
              visibility: visible !important;
              opacity: 1 !important;
              pointer-events: auto !important;
              transform: translateZ(0) !important;
            `;
          }
          
          if (actions) {
            actions.style.cssText = `
              display: flex !important;
              gap: 20px !important;
              margin-top: 15px !important;
              justify-content: center !important;
              visibility: visible !important;
              opacity: 1 !important;
              z-index: 10000000 !important;
              position: relative !important;
              min-height: 100px !important;
              max-height: none !important;
              overflow: visible !important;
            `;
          }
          
          buttons.forEach((btn, index) => {
            console.log(`Button ${index}:`, btn);
            const isLike = btn.classList.contains('like');
            const isDislike = btn.classList.contains('dislike');
            
            btn.style.cssText = `
              width: 60px !important;
              height: 60px !important;
              border-radius: 50% !important;
              border: 3px solid rgba(255,255,255,0.8) !important;
              display: flex !important;
              align-items: center !important;
              justify-content: center !important;
              cursor: pointer !important;
              transition: all 0.3s ease !important;
              background: ${isLike ? 'rgba(147,51,234,0.9)' : 'rgba(239,68,68,0.9)'} !important;
              padding: 0 !important;
              margin: 0 8px !important;
              position: relative !important;
              z-index: 10000000 !important;
              visibility: visible !important;
              opacity: 1 !important;
              transform: translateZ(0) !important;
              box-shadow: 0 4px 12px rgba(0,0,0,0.3) !important;
            `;
            
            // Forcer aussi les styles sur les inputs submit
            const submitInput = btn.querySelector('input[type="submit"]');
            if (submitInput) {
              submitInput.style.cssText = `
                width: 100% !important;
                height: 100% !important;
                border: none !important;
                background: transparent !important;
                color: white !important;
                cursor: pointer !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                padding: 0 !important;
                margin: 0 !important;
                font-size: 0 !important;
                line-height: 0 !important;
                z-index: 10002 !important;
              `;
            }
          });
          
          // Si aucun bouton trouvé, créer des boutons de test
          if (buttons.length === 0) {
            console.log('Aucun bouton trouvé, création de boutons de test');
            if (actions) {
              actions.innerHTML = `
                <button class="action-btn dislike" style="background: red !important; border: 3px solid yellow !important; width: 50px !important; height: 50px !important; border-radius: 50% !important; z-index: 1002 !important;">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5">
                    <path d="M18 6L6 18M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
                <button class="action-btn like" style="background: #9333ea !important; border: 3px solid yellow !important; width: 50px !important; height: 50px !important; border-radius: 50% !important; z-index: 1002 !important;">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                  </svg>
                </button>
              `;
            }
          }
        }
        
        // Appliquer au chargement du DOM
        document.addEventListener('DOMContentLoaded', function() {
          forceFullscreen();
          forceIframeStyles();
          hideBrowserBars();
          forceControlsVisibility();
          adjustToBackgroundDiv();
          
          // Observer les changements sur l'iframe
          const iframe = document.querySelector('iframe');
          if (iframe) {
            const observer = new MutationObserver(function(mutations) {
              mutations.forEach(function(mutation) {
                if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                  setTimeout(forceIframeStyles, 10);
                }
              });
            });
            
            observer.observe(iframe, {
              attributes: true,
              attributeFilter: ['style']
            });
          }
        });
        
        // Appliquer en continu toutes les 50ms (sans forcer constamment)
        setInterval(function() {
          forceFullscreen();
          forceIframeStyles();
          forceControlsVisibility();
          // Ne pas appeler adjustToBackgroundDiv constamment
        }, 50);
        
        // Masquer les barres du navigateur
        setInterval(hideBrowserBars, 2000);
        
        // Maintenir le plein écran en continu
        setInterval(function() {
          forceFullscreen();
          forceIframeStyles();
          forceControlsVisibility();
          // Ne pas appeler adjustToBackgroundDiv constamment
        }, 500);
        
        // Forcer les styles de l'iframe encore plus fréquemment
      setInterval(function() {
          forceIframeStyles();
          forceControlsVisibility();
          // Ne pas appeler adjustToBackgroundDiv constamment
        }, 1);
        
        // Appliquer sur tous les événements de redimensionnement
        ['resize', 'orientationchange', 'focus', 'blur'].forEach(event => {
          window.addEventListener(event, function() {
            forceFullscreen();
            forceIframeStyles();
            hideBrowserBars();
            forceControlsVisibility();
            // Réinitialiser la limite sur resize pour recalculer
            backgroundDivLimit = null;
            adjustToBackgroundDiv();
          });
        });
        
      })();
    </script>
  </body>
</html>
