<div class="min-h-screen bg-gray-900 py-8">
  <div class="max-w-6xl mx-auto px-4">
    
    <!-- En-tÃªte du profil -->
    <div class="bg-gradient-to-r from-purple-800 to-blue-800 rounded-lg p-8 mb-8">
      <div class="flex flex-col md:flex-row items-center">
        <!-- Avatar avec possibilitÃ© de modification -->
        <div class="relative mb-6 md:mb-0 md:mr-8">
          <% if @user.avatar.attached? %>
            <%= image_tag @user.avatar, class: "w-32 h-32 rounded-full border-4 border-white/30 object-cover shadow-xl" %>
          <% else %>
            <div class="w-32 h-32 rounded-full border-4 border-white/30 bg-gray-700 flex items-center justify-center shadow-xl">
              <span class="text-white text-4xl font-bold"><%= @user.email.first.upcase %></span>
            </div>
          <% end %>
          
          <!-- Bouton modifier avatar -->
          <button onclick="document.getElementById('avatar-input').click()" 
                  class="absolute bottom-0 right-0 bg-blue-600 hover:bg-blue-700 text-white rounded-full p-2 shadow-lg transition-all">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
            </svg>
          </button>
          
          <!-- Input cachÃ© pour upload -->
          <%= form_with url: profile_path, method: :patch, local: true, class: "hidden" do |f| %>
            <%= f.file_field :avatar, id: "avatar-input", accept: "image/*", onchange: "this.form.submit()" %>
          <% end %>
        </div>
        
        <!-- Informations utilisateur -->
        <div class="text-center md:text-left">
          <h1 class="text-4xl font-bold text-white mb-2">
            ğŸ¯ <%= @user.username || @user.email.split('@').first %>
          </h1>
          <p class="text-xl text-white/80 mb-4">
            ğŸ“§ <%= @user.email %>
          </p>
          
          <!-- Statistiques rapides alignÃ©es avec le systÃ¨me de badges -->
          <div class="flex flex-wrap justify-center md:justify-start gap-4">
            <div class="bg-white/10 rounded-lg px-4 py-2">
              <span class="text-2xl font-bold text-yellow-400"><%= @user.total_points %></span>
              <span class="text-white/80 text-sm">points totaux</span>
            </div>
            <div class="bg-white/10 rounded-lg px-4 py-2">
              <span class="text-2xl font-bold text-blue-400"><%= @user.games.count %></span>
              <span class="text-white/80 text-sm">parties</span>
            </div>
            <div class="bg-white/10 rounded-lg px-4 py-2">
              <span class="text-2xl font-bold text-green-400"><%= @user.win_ratio %>%</span>
              <span class="text-white/80 text-sm">victoires</span>
            </div>
            <div class="bg-white/10 rounded-lg px-4 py-2">
              <span class="text-2xl font-bold text-purple-400"><%= @badges.count %></span>
              <span class="text-white/80 text-sm">badges</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Grille des sections -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      
      <!-- ğŸ† Badges et RÃ©compenses -->
      <div class="bg-gray-800 rounded-lg p-6">
        <h2 class="text-2xl font-bold text-white mb-6 flex items-center">
          ğŸ† <span class="ml-2">Mes Badges</span>
        </h2>
        
        <% if @badges.any? %>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <% @badges.each do |user_badge| %>
              <div class="bg-gray-700 rounded-lg p-4 border-l-4 border-yellow-400">
                <div class="flex items-center justify-between mb-2">
                  <h3 class="font-semibold text-white"><%= user_badge.badge.name %></h3>
                  <% if user_badge.claimed_at %>
                    <span class="text-xs bg-green-600 text-white px-2 py-1 rounded">RÃ©clamÃ©</span>
                  <% else %>
                    <span class="text-xs bg-yellow-600 text-white px-2 py-1 rounded">Ã€ rÃ©clamer</span>
                  <% end %>
                </div>
                <p class="text-gray-300 text-sm mb-2"><%= user_badge.badge.description %></p>
                <p class="text-gray-400 text-xs">
                  GagnÃ© le <%= user_badge.earned_at.strftime("%d/%m/%Y") %>
                </p>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="text-center py-8">
            <div class="text-6xl mb-4">ğŸ†</div>
            <p class="text-gray-400">Aucun badge encore gagnÃ©</p>
            <p class="text-gray-500 text-sm mt-2">Jouez pour gagner vos premiers badges !</p>
          </div>
        <% end %>
      </div>

      <!-- ğŸ“Š Nouvelles statistiques alignÃ©es avec le systÃ¨me de badges -->
      <div class="bg-gray-800 rounded-lg p-6">
        <h2 class="text-2xl font-bold text-white mb-6 flex items-center">
          ğŸ“Š <span class="ml-2">Mes Statistiques</span>
        </h2>
        
        <div class="space-y-4">
          <!-- Points totaux -->
          <div class="bg-gradient-to-r from-yellow-600 to-orange-600 rounded-lg p-4">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-white/80 text-sm">Points totaux</p>
                <p class="text-3xl font-bold text-white"><%= @user.total_points %></p>
              </div>
              <div class="text-4xl">ğŸ¯</div>
            </div>
          </div>
          
          <!-- Win Ratio -->
          <div class="bg-gradient-to-r from-green-600 to-teal-600 rounded-lg p-4">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-white/80 text-sm">Ratio de victoires</p>
                <p class="text-3xl font-bold text-white"><%= @user.win_ratio %>%</p>
                <p class="text-white/60 text-xs">
                  <%= @user.games.count %> parties jouÃ©es
                </p>
              </div>
              <div class="text-4xl">ğŸ†</div>
            </div>
          </div>
          
          <!-- Top 3 Count -->
          <div class="bg-gradient-to-r from-yellow-600 to-amber-600 rounded-lg p-4">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-white/80 text-sm">Top 3</p>
                <p class="text-3xl font-bold text-white"><%= @user.top_3_finishes_count %></p>
                <p class="text-white/60 text-xs">
                  fois dans le top 3
                </p>
              </div>
              <div class="text-4xl">ğŸ¥‰</div>
            </div>
          </div>
          
          <!-- Unique Playlists -->
          <div class="bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg p-4">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-white/80 text-sm">Playlists uniques</p>
                <p class="text-3xl font-bold text-white"><%= @user.unique_playlists_played_count %></p>
                <p class="text-white/60 text-xs">
                  playlists diffÃ©rentes
                </p>
              </div>
              <div class="text-4xl">ğŸµ</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Progression vers les badges -->
    <div class="bg-gray-800 rounded-lg p-6 mt-8">
      <h2 class="text-2xl font-bold text-white mb-6 flex items-center">
        ğŸ¯ <span class="ml-2">Progression vers les badges</span>
      </h2>
      
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <% @user.next_badges.each do |badge_type, data| %>
          <% if data[:badge] %>
            <div class="bg-gray-700 rounded-lg p-4">
              <div class="flex items-center justify-between mb-3">
                <h3 class="font-semibold text-white text-sm"><%= data[:badge].name %></h3>
                <span class="bg-<%= badge_type == 'competitor' ? 'amber' : (badge_type == 'engager' ? 'blue' : (badge_type == 'critic' ? 'red' : 'purple')) %>-600 text-white px-2 py-1 rounded text-xs">
                  <%= badge_type.capitalize %>
                </span>
              </div>
              <div class="mb-3">
                <div class="flex justify-between text-xs text-white/80 mb-1">
                  <span>Progression</span>
                  <span><%= data[:current_score] %> / <%= data[:badge].points_required %></span>
                </div>
                <div class="w-full bg-gray-600 rounded-full h-2">
                  <% progress = (data[:current_score].to_f / data[:badge].points_required * 100).round %>
                  <div class="bg-<%= badge_type == 'competitor' ? 'amber' : (badge_type == 'engager' ? 'blue' : (badge_type == 'critic' ? 'red' : 'purple')) %>-500 h-2 rounded-full" style="width: <%= [progress, 100].min %>%"></div>
                </div>
              </div>
              <p class="text-xs text-white/60">
                <% if data[:points_needed] > 0 %>
                  Il manque <%= data[:points_needed] %> points
                <% else %>
                  Badge disponible !
                <% end %>
              </p>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>

    <!-- Historique des scores -->
    <% if @scores.any? %>
      <div class="bg-gray-800 rounded-lg p-6 mt-8">
        <h2 class="text-2xl font-bold text-white mb-6 flex items-center">
          ğŸ“ˆ <span class="ml-2">Historique des Scores</span>
        </h2>
        
        <div class="overflow-x-auto">
          <table class="w-full text-sm">
            <thead>
              <tr class="border-b border-gray-700">
                <th class="text-left py-3 text-white">Playlist</th>
                <th class="text-left py-3 text-white">Score</th>
                <th class="text-left py-3 text-white">Date</th>
                <th class="text-left py-3 text-white">Position</th>
              </tr>
            </thead>
            <tbody>
              <% @scores.order(points: :desc).each do |score| %>
                <tr class="border-b border-gray-700 hover:bg-gray-700/50">
                  <td class="py-3 text-white">
                    <div class="flex items-center">
                      <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center mr-3">
                        <span class="text-white text-xs font-bold">ğŸµ</span>
                      </div>
                      <%= score.playlist.title %>
                    </div>
                  </td>
                  <td class="py-3">
                    <span class="text-yellow-400 font-bold"><%= score.points %></span>
                  </td>
                  <td class="py-3 text-gray-300">
                    <%= score.created_at.strftime("%d/%m/%Y") %>
                  </td>
                  <td class="py-3">
                    <% position = Score.where(playlist: score.playlist).where('points > ?', score.points).count + 1 %>
                    <span class="px-2 py-1 rounded text-xs font-medium
                      <%= position == 1 ? 'bg-yellow-600 text-white' : 
                          position == 2 ? 'bg-gray-400 text-white' : 
                          position == 3 ? 'bg-orange-600 text-white' : 
                          'bg-gray-600 text-gray-300' %>">
                      <%= position %>Ã¨me
                    </span>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    <% end %>

    <!-- Actions -->
    <div class="flex justify-center mt-8 gap-4">
      <button onclick="window.location.href='<%= playlists_path %>'" 
          class="inline-flex items-center px-6 py-3 text-lg font-medium rounded-full text-white bg-blue-600 hover:bg-blue-700 transition-all">
        <span>ğŸµ Jouer</span>
      </button>
      
      <button onclick="window.location.href='<%= scores_path %>'" 
          class="inline-flex items-center px-6 py-3 text-lg font-medium rounded-full text-white bg-purple-600 hover:bg-purple-700 transition-all">
        <span>ğŸ† Classements</span>
      </button>
      
      <button onclick="window.location.href='<%= my_badges_path %>'" 
          class="inline-flex items-center px-6 py-3 text-lg font-medium rounded-full text-white bg-yellow-600 hover:bg-yellow-700 transition-all">
        <span>ğŸ… Badges</span>
      </button>
    </div>
  </div>
</div>

<script>
  // Auto-submit du formulaire d'avatar
  document.getElementById('avatar-input')?.addEventListener('change', function() {
    this.form.submit();
  });
</script> 