<!-- üéâ Page de D√©monstration des Animations de R√©compenses - Tube'NPlay -->

<div class="min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900">
  <!-- Header -->
  <div class="bg-black/20 backdrop-blur-sm border-b border-white/10">
    <div class="max-w-7xl mx-auto px-4 py-6">
      <div class="flex items-center justify-between">
        <div class="flex items-center">
          <%= image_tag "logo/Copilot_20251006_162220.png", alt: "Tube'NPlay", class: "w-12 h-12 mr-4 object-contain" %>
          <div>
            <h1 class="text-3xl font-bold text-white">üéâ Animations de R√©compenses</h1>
            <p class="text-gray-300">D√©monstration du syst√®me d'animations spectaculaires</p>
          </div>
        </div>
        <%= link_to "‚Üê Retour", root_path, class: "bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg transition-colors" %>
      </div>
    </div>
  </div>

  <!-- Contenu principal -->
  <div class="max-w-7xl mx-auto px-4 py-8">
    
    <!-- Section de test des animations -->
    <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-8 mb-8">
      <h2 class="text-2xl font-bold text-white mb-6">üéÆ Testez les Animations</h2>
      <p class="text-gray-300 mb-6">
        Cliquez sur les boutons ci-dessous pour d√©clencher les diff√©rentes animations de r√©compenses.
        Chaque animation comprend : notification popup ‚Üí cadeau ‚Üí explosion ‚Üí f√©licitations !
      </p>
      
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <button onclick="testRewardAnimation('challenge')" 
                class="bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white px-6 py-4 rounded-xl font-bold transition-all transform hover:scale-105 shadow-lg">
          üéØ Challenge
        </button>
        
        <button onclick="testRewardAnimation('exclusif')" 
                class="bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white px-6 py-4 rounded-xl font-bold transition-all transform hover:scale-105 shadow-lg">
          ‚≠ê Exclusif
        </button>
        
        <button onclick="testRewardAnimation('premium')" 
                class="bg-gradient-to-r from-yellow-500 to-orange-600 hover:from-yellow-600 hover:to-orange-700 text-white px-6 py-4 rounded-xl font-bold transition-all transform hover:scale-105 shadow-lg">
          üëë Premium
        </button>
        
        <button onclick="testRewardAnimation('ultime')" 
                class="bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700 text-white px-6 py-4 rounded-xl font-bold transition-all transform hover:scale-105 shadow-lg">
          üåà Ultime
        </button>
      </div>
      
      <!-- Boutons de test -->
      <div class="mt-6 text-center space-y-4">
        <div>
          <button onclick="testDirectAnimation()" 
                  class="bg-gradient-to-r from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700 text-white px-8 py-4 rounded-xl font-bold transition-all transform hover:scale-105 shadow-lg text-lg">
            üöÄ TEST DIRECT - Challenge
          </button>
          <p class="text-gray-400 text-sm mt-2">Animation compl√®te avec explosion</p>
        </div>
        
        <div>
          <button onclick="testSimpleMessages()" 
                  class="bg-gradient-to-r from-green-500 to-blue-600 hover:from-green-600 hover:to-blue-700 text-white px-8 py-4 rounded-xl font-bold transition-all transform hover:scale-105 shadow-lg text-lg">
            üß™ TEST SIMPLE - Messages
          </button>
          <p class="text-gray-400 text-sm mt-2">Test simple pour v√©rifier l'affichage des messages</p>
        </div>
        
        <div>
          <button onclick="testCongratulationsDirect()" 
                  class="bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700 text-white px-8 py-4 rounded-xl font-bold transition-all transform hover:scale-105 shadow-lg text-lg">
            üéâ TEST DIRECT - F√©licitations
          </button>
          <p class="text-gray-400 text-sm mt-2">Test direct des messages de f√©licitations et carte</p>
        </div>
      </div>
    </div>

    <!-- Section d'information sur les animations -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
      
      <!-- Animation Sequence -->
      <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-6">
        <h3 class="text-xl font-bold text-white mb-4">üé¨ S√©quence d'Animation</h3>
        <div class="space-y-3">
          <div class="flex items-center text-gray-300">
            <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold mr-3">1</span>
            <span>Popup de notification appara√Æt en haut √† droite</span>
          </div>
          <div class="flex items-center text-gray-300">
            <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold mr-3">2</span>
            <span>Cadeau anim√© appara√Æt au centre de l'√©cran</span>
          </div>
          <div class="flex items-center text-gray-300">
            <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold mr-3">3</span>
            <span>Cliquez sur le cadeau pour l'ouvrir</span>
          </div>
          <div class="flex items-center text-gray-300">
            <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold mr-3">4</span>
            <span>Explosion avec confettis et √©tincelles</span>
          </div>
          <div class="flex items-center text-gray-300">
            <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold mr-3">5</span>
            <span>Message de f√©licitations avec effet pop</span>
          </div>
        </div>
      </div>

      <!-- Effets Visuels -->
      <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-6">
        <h3 class="text-xl font-bold text-white mb-4">‚ú® Effets Visuels</h3>
        <div class="space-y-3">
          <div class="flex items-center text-gray-300">
            <span class="text-2xl mr-3">üéä</span>
            <span>Confettis color√©s qui tombent</span>
          </div>
          <div class="flex items-center text-gray-300">
            <span class="text-2xl mr-3">‚ú®</span>
            <span>√âtincelles dor√©es flottantes</span>
          </div>
          <div class="flex items-center text-gray-300">
            <span class="text-2xl mr-3">üí•</span>
            <span>Particules d'explosion radiales</span>
          </div>
          <div class="flex items-center text-gray-300">
            <span class="text-2xl mr-3">üéÅ</span>
            <span>Cadeau avec d√©grad√© anim√©</span>
          </div>
          <div class="flex items-center text-gray-300">
            <span class="text-2xl mr-3">üéâ</span>
            <span>Messages avec animations pop</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Section int√©gration -->
    <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-6 mb-8">
      <h3 class="text-xl font-bold text-white mb-4">üîß Int√©gration dans l'Application</h3>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        
        <div class="bg-gray-800/50 rounded-lg p-4">
          <h4 class="font-bold text-white mb-2">üì± C√¥t√© Client</h4>
          <ul class="text-sm text-gray-300 space-y-1">
            <li>‚Ä¢ CSS animations avanc√©es</li>
            <li>‚Ä¢ JavaScript pour les interactions</li>
            <li>‚Ä¢ Stimulus controller</li>
            <li>‚Ä¢ Effets de particules</li>
          </ul>
        </div>
        
        <div class="bg-gray-800/50 rounded-lg p-4">
          <h4 class="font-bold text-white mb-2">üñ•Ô∏è C√¥t√© Serveur</h4>
          <ul class="text-sm text-gray-300 space-y-1">
            <li>‚Ä¢ Helper Rails</li>
            <li>‚Ä¢ Int√©gration avec le mod√®le Reward</li>
            <li>‚Ä¢ D√©clenchement automatique</li>
            <li>‚Ä¢ Gestion des √©tats</li>
          </ul>
        </div>
        
        <div class="bg-gray-800/50 rounded-lg p-4">
          <h4 class="font-bold text-white mb-2">üéØ Utilisation</h4>
          <ul class="text-sm text-gray-300 space-y-1">
            <li>‚Ä¢ D√©clenchement automatique</li>
            <li>‚Ä¢ Test manuel possible</li>
            <li>‚Ä¢ Responsive design</li>
            <li>‚Ä¢ Performance optimis√©e</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Section code d'exemple -->
    <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-6">
      <h3 class="text-xl font-bold text-white mb-4">üíª Code d'Exemple</h3>
      <div class="bg-gray-900 rounded-lg p-4 overflow-x-auto">
        <pre class="text-green-400 text-sm"><code># Dans votre contr√¥leur Rails
def unlock_reward
  @reward = current_user.rewards.find(params[:id])
  @reward.update!(unlocked: true, unlocked_at: Time.current)
  
  # D√©clencher l'animation
  render json: { 
    success: true, 
    animation: {
      type: @reward.reward_type,
      title: @reward.reward_description,
      description: "R√©compense d√©bloqu√©e !"
    }
  }
end

# Dans votre vue ERB
&lt;%= show_reward_animation(@reward) %&gt;

# JavaScript pour d√©clencher manuellement
testRewardAnimation('challenge');</code></pre>
      </div>
    </div>
  </div>
</div>

<!-- Panel de test en mode d√©veloppement -->
<% if Rails.env.development? %>
  <%= reward_animation_test_panel %>
<% end %>

<!-- Styles des animations int√©gr√©s directement -->
<style>
  /* üéâ Syst√®me d'Animations de R√©compenses - Tube'NPlay */

  /* ===== POPUP DE NOTIFICATION ===== */
  .reward-notification-popup {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 9999;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px;
    padding: 20px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    transform: translateX(400px);
    transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    border: 3px solid #ffd700;
    animation: notificationGlow 2s infinite;
  }

  .reward-notification-popup.show {
    transform: translateX(0);
  }

  .reward-notification-popup .notification-content {
    display: flex;
    align-items: center;
    gap: 15px;
    color: white;
  }

  .reward-notification-popup .notification-icon {
    font-size: 2.5rem;
    animation: bounce 1s infinite;
  }

  .reward-notification-popup .notification-text {
    font-size: 1.1rem;
    font-weight: bold;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  }

  /* ===== ANIMATION DU CADEAU ===== */
  .reward-gift-container {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0);
    z-index: 10000;
    transition: all 0.3s ease;
  }

  .reward-gift-container.show {
    transform: translate(-50%, -50%) scale(1);
  }

  .reward-gift-box {
    width: 260px; /* Agrandi de 30% (200 * 1.3 = 260) */
    height: 260px; /* Agrandi de 30% (200 * 1.3 = 260) */
    background: linear-gradient(45deg, #ff6b6b, #ffd93d, #6bcf7f, #4d9de0);
    background-size: 400% 400%;
    border-radius: 26px; /* Agrandi de 30% (20 * 1.3 = 26) */
    position: relative;
    animation: giftGradient 3s ease infinite, giftFloat 2s ease-in-out infinite;
    box-shadow: 0 26px 52px rgba(0, 0, 0, 0.3); /* Agrandi de 30% */
    cursor: pointer;
    border: 5.2px solid #ffd700; /* Agrandi de 30% (4 * 1.3 = 5.2) */
  }

  .reward-gift-box::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 4px;
    background: #ffd700;
    transform: translateY(-50%);
    box-shadow: 0 0 20px #ffd700;
  }

  .reward-gift-box::after {
    content: 'üéÅ';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 5.2rem; /* Agrandi de 30% (4 * 1.3 = 5.2) */
    animation: giftShine 2s ease-in-out infinite;
  }

  .reward-gift-ribbon {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 26px; /* Agrandi de 30% (20 * 1.3 = 26) */
    height: 100%;
    background: linear-gradient(to bottom, #ff6b6b, #ff8e8e);
    border-radius: 13px; /* Agrandi de 30% (10 * 1.3 = 13) */
    box-shadow: 0 0 19.5px rgba(255, 107, 107, 0.5); /* Agrandi de 30% (15 * 1.3 = 19.5) */
  }

  /* ===== EXPLOSION ET EFFETS ===== */
  .reward-explosion-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 10001;
    pointer-events: none;
    overflow: hidden;
  }

  .confetti-piece {
    position: absolute;
    width: 10px;
    height: 10px;
    background: #ff6b6b;
    animation: confettiFall 3s linear infinite;
  }

  .confetti-piece:nth-child(2n) { background: #ff6b6b; animation-delay: 0.1s; }
  .confetti-piece:nth-child(3n) { background: #4d9de0; animation-delay: 0.2s; }
  .confetti-piece:nth-child(4n) { background: #6bcf7f; animation-delay: 0.3s; }
  .confetti-piece:nth-child(5n) { background: #ffd93d; animation-delay: 0.4s; }
  .confetti-piece:nth-child(6n) { background: #ff8e8e; animation-delay: 0.5s; }
  .confetti-piece:nth-child(7n) { background: #a855f7; animation-delay: 0.6s; }
  .confetti-piece:nth-child(8n) { background: #06b6d4; animation-delay: 0.7s; }

  .sparkle {
    position: absolute;
    width: 4px;
    height: 4px;
    background: #ffd700;
    border-radius: 50%;
    animation: sparkleFloat 2s ease-in-out infinite;
    box-shadow: 0 0 10px #ffd700;
  }

  /* ===== MESSAGES DE F√âLICITATIONS ===== */
  .congratulations-message {
    position: fixed;
    top: 30%;
    left: 50%;
    transform: translateX(-50%) scale(0);
    z-index: 10002;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 30px 50px;
    border-radius: 20px;
    font-size: 2rem;
    font-weight: bold;
    text-align: center;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    border: 3px solid #ffd700;
    animation: messagePop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
  }

  .congratulations-message .reward-title {
    font-size: 1.5rem;
    margin-top: 10px;
    color: #ffd700;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  }

  /* ===== ANIMATIONS KEYFRAMES ===== */
  @keyframes notificationGlow {
    0%, 100% { box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), 0 0 20px rgba(255, 215, 0, 0.5); }
    50% { box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), 0 0 40px rgba(255, 215, 0, 0.8); }
  }

  @keyframes bounce {
    0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
    40% { transform: translateY(-10px); }
    60% { transform: translateY(-5px); }
  }

  @keyframes giftGradient {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  @keyframes giftFloat {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-20px) rotate(5deg); }
  }

  @keyframes giftShine {
    0%, 100% { filter: brightness(1) drop-shadow(0 0 10px rgba(255, 215, 0, 0.5)); }
    50% { filter: brightness(1.5) drop-shadow(0 0 20px rgba(255, 215, 0, 0.8)); }
  }

  @keyframes confettiFall {
    0% {
      transform: translateY(-100vh) rotate(0deg);
      opacity: 1;
    }
    100% {
      transform: translateY(100vh) rotate(720deg);
      opacity: 0;
    }
  }

  @keyframes sparkleFloat {
    0%, 100% {
      transform: translateY(0px) scale(1);
      opacity: 1;
    }
    50% {
      transform: translateY(-30px) scale(1.5);
      opacity: 0.7;
    }
  }

  @keyframes messagePop {
    0% {
      transform: translateX(-50%) scale(0) rotate(-10deg);
      opacity: 0;
    }
    50% {
      transform: translateX(-50%) scale(1.1) rotate(5deg);
      opacity: 1;
    }
    100% {
      transform: translateX(-50%) scale(1) rotate(0deg);
      opacity: 1;
    }
  }

  @keyframes rewardCardPop {
    0% {
      transform: translate(-50%, -50%) scale(0) rotate(-15deg);
      opacity: 0;
    }
    30% {
      transform: translate(-50%, -50%) scale(1.2) rotate(10deg);
      opacity: 1;
    }
    60% {
      transform: translate(-50%, -50%) scale(0.9) rotate(-5deg);
      opacity: 1;
    }
    100% {
      transform: translate(-50%, -50%) scale(1) rotate(0deg);
      opacity: 1;
    }
  }

  /* ===== EFFETS DE PARTICULES ===== */
  .particle {
    position: absolute;
    width: 6px;
    height: 6px;
    background: #ffd700;
    border-radius: 50%;
    animation: particleExplode 1.5s ease-out forwards;
  }

  .particle:nth-child(2n) { background: #ff6b6b; }
  .particle:nth-child(3n) { background: #4d9de0; }
  .particle:nth-child(4n) { background: #6bcf7f; }

  @keyframes particleExplode {
    0% {
      transform: scale(0) rotate(0deg);
      opacity: 1;
    }
    100% {
      transform: scale(1) rotate(360deg) translate(var(--dx), var(--dy));
      opacity: 0;
    }
  }

  /* ===== RESPONSIVE ===== */
  @media (max-width: 768px) {
    .reward-notification-popup {
      right: 10px;
      top: 10px;
      padding: 15px;
    }
    
    .reward-gift-box {
      width: 150px;
      height: 150px;
    }
    
    .reward-gift-box::after {
      font-size: 3rem;
    }
    
    .congratulations-message {
      font-size: 1.5rem;
      padding: 20px 30px;
    }
  }

  /* Styles sp√©cifiques √† la page de d√©monstration */
  .demo-button {
    transition: all 0.3s ease;
  }
  
  .demo-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
  }
  
  .step-number {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }
  
  .code-block {
    background: #1a1a1a;
    border: 1px solid #333;
    border-radius: 8px;
  }
</style>

<!-- JavaScript des animations int√©gr√© directement -->
<script>
// üéâ Syst√®me d'Animations de R√©compenses - Tube'NPlay

class RewardAnimationSystem {
  constructor() {
    this.isAnimating = false;
    this.init();
  }

  init() {
    console.log('üéâ Reward Animation System initialized');
  }

  // üéØ D√©clencher l'animation compl√®te de r√©compense
  triggerRewardAnimation(rewardData) {
    if (this.isAnimating) return;
    this.isAnimating = true;

    const sequence = [
      () => this.showNotification(rewardData),
      () => this.showGift(rewardData),
      () => this.explodeGift(rewardData),
      () => this.showCongratulations(rewardData),
      () => this.cleanup()
    ];

    this.executeSequence(sequence, 0);
  }

  // üì¢ Afficher la notification popup
  showNotification(rewardData) {
    return new Promise((resolve) => {
      const popup = document.createElement('div');
      popup.className = 'reward-notification-popup';
      popup.innerHTML = `
        <div class="notification-content">
          <div class="notification-icon">üéâ</div>
          <div class="notification-text">
            <div>Nouvelle r√©compense disponible !</div>
            <div style="font-size: 0.9rem; opacity: 0.9;">${rewardData.type}</div>
          </div>
        </div>
      `;

      document.body.appendChild(popup);

      // Animation d'entr√©e
      setTimeout(() => {
        popup.classList.add('show');
      }, 100);

      // Auto-hide apr√®s 4 secondes
      setTimeout(() => {
        popup.classList.remove('show');
        setTimeout(() => {
          document.body.removeChild(popup);
          resolve();
        }, 500);
      }, 4000);
    });
  }

  // üéÅ Afficher le cadeau
  showGift(rewardData) {
    return new Promise((resolve) => {
      const giftContainer = document.createElement('div');
      giftContainer.className = 'reward-gift-container';
      giftContainer.innerHTML = `
        <div class="reward-gift-box" style="cursor: pointer;">
          <div class="reward-gift-ribbon"></div>
        </div>
        <div style="position: absolute; bottom: -50px; left: 50%; transform: translateX(-50%); color: white; font-size: 1rem; text-align: center; text-shadow: 0 2px 4px rgba(0,0,0,0.8);">
          üëÜ Cliquez pour ouvrir !
        </div>
      `;

      document.body.appendChild(giftContainer);

      // Animation d'entr√©e
      setTimeout(() => {
        giftContainer.classList.add('show');
      }, 100);

      // Attacher l'√©v√©nement de clic directement sur le cadeau
      const giftBox = giftContainer.querySelector('.reward-gift-box');
      giftBox.addEventListener('click', () => {
        console.log('üéÅ Cadeau cliqu√© ! D√©clenchement de l\'explosion...');
        // Stocker la r√©f√©rence pour l'explosion
        this.giftContainer = giftContainer;
        resolve();
      });
    });
  }


  // üí• Explosion du cadeau
  explodeGift(rewardData) {
    return new Promise((resolve) => {
      console.log('üí• Explosion du cadeau d√©clench√©e...');
      
      // Animation de sortie du cadeau
      this.giftContainer.style.transform = 'translate(-50%, -50%) scale(1.5)';
      this.giftContainer.style.opacity = '0';
      this.giftContainer.style.transition = 'all 0.3s ease';

      // Cr√©er l'explosion - CORRIG√â
      this.createExplosion();
      this.createSparkles();
      this.createParticles();

      setTimeout(() => {
        document.body.removeChild(this.giftContainer);
        console.log('‚úÖ Cadeau supprim√©, r√©solution de l\'explosion');
        resolve();
      }, 2000); // D√©lai plus long pour laisser les confettis s'afficher
    });
  }

  // üéä Cr√©er l'explosion de confettis
  createExplosion() {
    const explosionContainer = document.createElement('div');
    explosionContainer.className = 'reward-explosion-container';
    document.body.appendChild(explosionContainer);

    // Cr√©er 100 confettis plus visibles
    for (let i = 0; i < 100; i++) {
      const confetti = document.createElement('div');
      confetti.className = 'confetti-piece';
      confetti.style.left = Math.random() * 100 + '%';
      confetti.style.animationDelay = Math.random() * 2 + 's';
      confetti.style.animationDuration = (Math.random() * 2 + 3) + 's';
      confetti.style.width = (Math.random() * 15 + 8) + 'px';
      confetti.style.height = (Math.random() * 15 + 8) + 'px';
      confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
      confetti.style.boxShadow = '0 0 10px rgba(255, 255, 255, 0.8)';
      explosionContainer.appendChild(confetti);
    }

    // Nettoyer apr√®s l'animation
    setTimeout(() => {
      document.body.removeChild(explosionContainer);
    }, 6000);
  }

  // ‚ú® Cr√©er les √©tincelles
  createSparkles() {
    const sparkleContainer = document.createElement('div');
    sparkleContainer.className = 'reward-explosion-container';
    document.body.appendChild(sparkleContainer);

    // Cr√©er 60 √©tincelles plus brillantes
    for (let i = 0; i < 60; i++) {
      const sparkle = document.createElement('div');
      sparkle.className = 'sparkle';
      sparkle.style.left = Math.random() * 100 + '%';
      sparkle.style.top = Math.random() * 100 + '%';
      sparkle.style.animationDelay = Math.random() * 1 + 's';
      sparkle.style.width = (Math.random() * 8 + 4) + 'px';
      sparkle.style.height = (Math.random() * 8 + 4) + 'px';
      sparkle.style.boxShadow = '0 0 20px #ffd700, 0 0 40px #ffd700, 0 0 60px #ffd700';
      sparkleContainer.appendChild(sparkle);
    }

    setTimeout(() => {
      document.body.removeChild(sparkleContainer);
    }, 4000);
  }

  // üéÜ Cr√©er les particules d'explosion
  createParticles() {
    const particleContainer = document.createElement('div');
    particleContainer.className = 'reward-explosion-container';
    document.body.appendChild(particleContainer);

    // Cr√©er 40 particules plus visibles
    for (let i = 0; i < 40; i++) {
      const particle = document.createElement('div');
      particle.className = 'particle';
      particle.style.left = '50%';
      particle.style.top = '50%';
      particle.style.width = (Math.random() * 12 + 6) + 'px';
      particle.style.height = (Math.random() * 12 + 6) + 'px';
      particle.style.boxShadow = '0 0 15px rgba(255, 255, 255, 0.9)';
      
      const angle = (Math.PI * 2 * i) / 40;
      const distance = 150 + Math.random() * 300;
      const dx = Math.cos(angle) * distance;
      const dy = Math.sin(angle) * distance;
      
      particle.style.setProperty('--dx', dx + 'px');
      particle.style.setProperty('--dy', dy + 'px');
      particle.style.animationDelay = Math.random() * 0.5 + 's';
      
      particleContainer.appendChild(particle);
    }

    setTimeout(() => {
      document.body.removeChild(particleContainer);
    }, 3000);
  }

  // üéâ Afficher le message de f√©licitations
  showCongratulations(rewardData) {
    return new Promise((resolve) => {
      console.log('üéâ Affichage du message de f√©licitations...');
      
      // Cr√©er le message principal avec styles simples
      const message = document.createElement('div');
      // Mots al√©atoires pour les f√©licitations
      const celebrationWords = ['BRAAAA !', 'BAM !', 'WOW !', 'TU DECHIRES !', 'F√âLICITATIONS !'];
      const randomWord = celebrationWords[Math.floor(Math.random() * celebrationWords.length)];
      
      message.innerHTML = `
        <div style="font-size: 2.5rem; margin-bottom: 15px; font-weight: bold; color: #ffd700;">
          ${randomWord}
        </div>
        <div style="font-size: 1.5rem; margin-bottom: 10px; color: white;">
          ${rewardData.title}
        </div>
        <div style="font-size: 1rem; line-height: 1.3; opacity: 0.9;">
          ${rewardData.description}
        </div>
      `;
      
      // Styles simples et robustes - Centrage absolu et taille r√©duite
      message.style.position = 'fixed';
      message.style.top = '20%';
      message.style.left = '0';
      message.style.right = '0';
      message.style.margin = '0 auto';
      message.style.zIndex = '99999';
      message.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
      message.style.color = 'white';
      message.style.padding = '20px 25px'; // R√©duit
      message.style.borderRadius = '15px'; // R√©duit
      message.style.fontSize = '1.5rem'; // R√©duit
      message.style.fontWeight = 'bold';
      message.style.textAlign = 'center';
      message.style.boxShadow = '0 15px 30px rgba(0, 0, 0, 0.5)'; // R√©duit
      message.style.border = '3px solid #ffd700';
      message.style.maxWidth = '85vw'; // R√©duit
      message.style.width = 'fit-content';
      message.style.minWidth = '280px'; // R√©duit
      message.style.wordWrap = 'break-word';
      message.style.overflow = 'hidden';
      message.style.boxSizing = 'border-box';
      message.style.display = 'block';
      message.style.marginLeft = 'auto';
      message.style.marginRight = 'auto';

      document.body.appendChild(message);
      console.log('‚úÖ Message de f√©licitations ajout√© au DOM');

      // Auto-hide apr√®s 6.3 secondes (allong√© de 5%)
      setTimeout(() => {
        message.style.opacity = '0';
        message.style.transition = 'opacity 0.8s ease';
        
        setTimeout(() => {
          if (document.body.contains(message)) {
            document.body.removeChild(message);
          }
          // Cr√©er l'affichage de la r√©compense d√©couverte APR√àS la disparition du message
          this.showRewardDiscovery(rewardData);
          resolve();
        }, 800);
      }, 6300); // Allong√© de 5% (6000 * 1.05 = 6300)
    });
  }

  // üéÅ Afficher la r√©compense d√©couverte
  showRewardDiscovery(rewardData) {
    console.log('üé´ Affichage de la carte de r√©compense d√©couverte...');
    
    const rewardCard = document.createElement('div');
    rewardCard.innerHTML = `
      <!-- Banni√®re avec image de concert -->
      <div style="height: 200px; position: relative; overflow: hidden; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: url('https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80') center/cover; opacity: 0.8;"></div>
        <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(45deg, rgba(102,126,234,0.8) 0%, rgba(118,75,162,0.8) 100%);"></div>
        
        <!-- Badge ULTIME en haut √† droite -->
        <div style="position: absolute; top: 15px; right: 15px;">
          <span style="background: #10b981; color: white; padding: 5px 10px; border-radius: 15px; font-size: 0.8rem; font-weight: bold;">
            ULTIME
          </span>
        </div>
        
        <!-- Overlay avec titre -->
        <div style="position: absolute; inset: 0; background: rgba(0,0,0,0.4); display: flex; align-items: end; padding: 20px;">
          <div style="color: white;">
            <h3 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 5px; text-shadow: 0 2px 4px rgba(0,0,0,0.8);">
              Invitation Concert VIP
            </h3>
            <div style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">
              12 badges requis
            </div>
          </div>
        </div>
      </div>
      
      <!-- Contenu de la carte -->
      <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; color: white;">
        <p style="font-size: 1rem; margin-bottom: 15px; line-height: 1.4; opacity: 0.9;">
          Acc√®s backstage exclusif + Rencontre avec l'artiste
        </p>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
          <div style="background: rgba(255, 255, 255, 0.2); padding: 6px 12px; border-radius: 15px; font-size: 0.8rem;">
            <span style="color: #ffd700; font-weight: bold;">12 badges</span> requis
          </div>
          <div style="background: #10b981; color: white; padding: 6px 12px; border-radius: 15px; font-size: 0.8rem; font-weight: bold;">
            D√âBLOQU√â
          </div>
        </div>
      </div>
    `;
    
    // Styles identiques aux vraies cartes de r√©compenses
    rewardCard.style.position = 'fixed';
    rewardCard.style.top = '50%';
    rewardCard.style.left = '50%';
    rewardCard.style.transform = 'translate(-50%, -50%)';
    rewardCard.style.zIndex = '99999';
    rewardCard.style.borderRadius = '12px'; // Identique aux vraies cartes
    rewardCard.style.boxShadow = '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)'; // Identique aux vraies cartes
    rewardCard.style.border = '2px solid transparent'; // Identique aux vraies cartes
    rewardCard.style.maxWidth = '400px'; // Taille identique aux vraies cartes
    rewardCard.style.width = '90%';
    rewardCard.style.overflow = 'hidden';
    rewardCard.style.transition = 'all 0.3s ease'; // Identique aux vraies cartes

    document.body.appendChild(rewardCard);
    console.log('‚úÖ Carte de r√©compense ajout√©e au DOM');

    // Auto-hide apr√®s 4.5 secondes (r√©duit de 10%)
    setTimeout(() => {
      rewardCard.style.opacity = '0';
      rewardCard.style.transition = 'opacity 0.6s ease';
      
      setTimeout(() => {
        if (document.body.contains(rewardCard)) {
          document.body.removeChild(rewardCard);
        }
      }, 600);
    }, 4500); // R√©duit de 10% (5000 * 0.9 = 4500)
  }

  // üßπ Nettoyage final
  cleanup() {
    console.log('üßπ Nettoyage final...');
    this.isAnimating = false;
    this.giftContainer = null;
    this.giftResolve = null;
    console.log('‚úÖ Nettoyage termin√©');
    return Promise.resolve();
  }

  // üîÑ Ex√©cuter une s√©quence d'animations
  async executeSequence(sequence, index) {
    console.log(`üîÑ Ex√©cution de l'√©tape ${index + 1}/${sequence.length}`);
    
    if (index >= sequence.length) {
      console.log('‚úÖ S√©quence termin√©e !');
      return;
    }
    
    try {
      await sequence[index]();
      console.log(`‚úÖ √âtape ${index + 1} termin√©e, passage √† l'√©tape ${index + 2}`);
      this.executeSequence(sequence, index + 1);
    } catch (error) {
      console.error(`‚ùå Erreur √† l'√©tape ${index + 1}:`, error);
    }
  }

  // üéÆ M√©thode de test pour d√©clencher une animation
  testAnimation(rewardType = 'challenge') {
    const testData = {
      type: rewardType.toUpperCase(),
      title: this.getRewardTitle(rewardType),
      description: this.getRewardDescription(rewardType)
    };

    this.triggerRewardAnimation(testData);
  }

  // üìù Obtenir le titre de la r√©compense
  getRewardTitle(type) {
    const titles = {
      challenge: 'R√©compense Challenge D√©bloqu√©e !',
      exclusif: 'R√©compense Exclusif D√©bloqu√©e !',
      premium: 'R√©compense Premium D√©bloqu√©e !',
      ultime: 'R√©compense Ultime D√©bloqu√©e !'
    };
    return titles[type] || 'R√©compense D√©bloqu√©e !';
  }

  // üìÑ Obtenir la description de la r√©compense
  getRewardDescription(type) {
    const descriptions = {
      challenge: 'Vous avez d√©bloqu√© une playlist exclusive !',
      exclusif: 'Acc√®s √† du contenu premium sp√©cial !',
      premium: 'Contenu VIP et rencontres avec artistes !',
      ultime: 'R√©compense ultime - vous √™tes un champion !'
    };
    return descriptions[type] || 'Nouvelle r√©compense disponible !';
  }
}

// üöÄ Initialiser le syst√®me d'animations - VERSION CORRIG√âE
function initializeRewardAnimations() {
  console.log('üéâ Initialisation du syst√®me d\'animations...');
  
  if (!window.rewardAnimationSystem) {
    window.rewardAnimationSystem = new RewardAnimationSystem();
    console.log('‚úÖ Syst√®me d\'animations cr√©√©');
  }
  
  // Exposer les m√©thodes de test globalement
  window.testRewardAnimation = (type) => {
    console.log('üéâ D√©clenchement de l\'animation:', type);
    if (window.rewardAnimationSystem) {
      window.rewardAnimationSystem.testAnimation(type);
    } else {
      console.error('‚ùå Syst√®me d\'animations non initialis√©');
    }
  };
  
  console.log('üéâ Syst√®me d\'animations pr√™t !');
  console.log('üéÆ Testez avec: testRewardAnimation("challenge")');
}

// Fonction de test direct
function testDirectAnimation() {
  console.log('üöÄ Test direct d√©clench√© !');
  
  // V√©rifier si le syst√®me existe
  if (!window.rewardAnimationSystem) {
    console.error('‚ùå Syst√®me d\'animations non trouv√©, recr√©ation...');
    window.rewardAnimationSystem = new RewardAnimationSystem();
  }
  
  // D√©clencher l'animation directement
  const testData = {
    type: 'CHALLENGE',
    title: 'R√©compense Challenge D√©bloqu√©e !',
    description: 'Vous avez d√©bloqu√© une playlist exclusive !'
  };
  
  console.log('üéØ D√©clenchement de l\'animation avec:', testData);
  window.rewardAnimationSystem.triggerRewardAnimation(testData);
}

// Fonction de test simple pour les messages
function testSimpleMessages() {
  console.log('üß™ Test simple des messages...');
  
  // Test 1: Message de f√©licitations simple
  const message = document.createElement('div');
  message.innerHTML = 'üéâ F√âLICITATIONS ! üéâ';
  message.style.cssText = `
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: red;
    color: white;
    padding: 50px;
    font-size: 3rem;
    z-index: 99999;
    border: 5px solid yellow;
  `;
  document.body.appendChild(message);
  console.log('‚úÖ Message simple ajout√©');
  
  // Test 2: Carte de r√©compense simple
  setTimeout(() => {
    const card = document.createElement('div');
    card.innerHTML = 'üé´ INVITATION CONCERT VIP';
    card.style.cssText = `
      position: fixed;
      top: 20%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: blue;
      color: white;
      padding: 30px;
      font-size: 2rem;
      z-index: 99999;
      border: 5px solid gold;
    `;
    document.body.appendChild(card);
    console.log('‚úÖ Carte simple ajout√©e');
    
    // Nettoyer apr√®s 5 secondes
    setTimeout(() => {
      if (document.body.contains(message)) document.body.removeChild(message);
      if (document.body.contains(card)) document.body.removeChild(card);
    }, 5000);
  }, 2000);
}

// Fonction de test directe pour les messages de f√©licitations
function testCongratulationsDirect() {
  console.log('üéâ Test direct des messages de f√©licitations...');
  
  if (!window.rewardAnimationSystem) {
    console.error('‚ùå Syst√®me d\'animations non trouv√©');
    return;
  }
  
  const testData = {
    type: 'CHALLENGE',
    title: 'R√©compense Challenge D√©bloqu√©e !',
    description: 'Vous avez d√©bloqu√© une playlist exclusive !'
  };
  
  // Appeler directement la fonction showCongratulations
  window.rewardAnimationSystem.showCongratulations(testData);
}

// Initialiser imm√©diatement
initializeRewardAnimations();

// √âgalement sur DOMContentLoaded au cas o√π
document.addEventListener('DOMContentLoaded', initializeRewardAnimations);

// √âgalement sur turbo:load pour Rails
document.addEventListener('turbo:load', initializeRewardAnimations);
</script>
