<style>
/* Reset complet pour plein écran */
* {
  margin: 0 !important;
  padding: 0 !important;
  box-sizing: border-box !important;
}

html, body {
  width: 100vw !important;
  height: 100vh !important;
  overflow: hidden !important;
  background: #000 !important;
  margin: 0 !important;
  padding: 0 !important;
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  z-index: 99999 !important;
}

/* Masquer toutes les barres de navigation */
body {
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

/* Forcer le plein écran sur tous les éléments */
.shorts-container,
.shorts-player {
  width: 100vw !important;
  height: 100vh !important;
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  z-index: 99999 !important;
  margin: 0 !important;
  padding: 0 !important;
  border-radius: 0 !important;
  box-shadow: none !important;
  max-width: none !important;
  max-height: none !important;
}

/* Masquer les éléments de navigation */
nav, .nav, .main-content, .flash {
  display: none !important;
}

/* Styles pour mobile - masquer les barres de navigation */
@supports (-webkit-touch-callout: none) {
  html, body {
    height: -webkit-fill-available !important;
  }
  
  .shorts-container,
  .shorts-player {
    height: -webkit-fill-available !important;
  }
}

/* Masquer les barres de navigation sur iOS */
@media screen and (max-width: 768px) {
  html, body {
    height: 100vh !important;
    height: calc(var(--vh, 1vh) * 100) !important;
  }
  
  .shorts-container,
  .shorts-player {
    height: 100vh !important;
    height: calc(var(--vh, 1vh) * 100) !important;
  }
}
</style>

<div class="shorts-container">
      <% if @game.current_video %>
        <div class="shorts-player">
          <!-- Vidéo -->
          <div class="shorts-video">
            <iframe 
              src="https://www.youtube.com/embed/<%= @game.current_video.youtube_id %>?autoplay=1&controls=0&modestbranding=1&rel=0&playsinline=1&fs=0&disablekb=1&iv_load_policy=3&cc_load_policy=0&origin=http://localhost:3000&mute=0&loop=1&playlist=<%= @game.current_video.youtube_id %>"
              title="YouTube video player"
              frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              allowfullscreen="false"
              style="width: 100% !important; height: 100% !important; position: absolute !important; top: 0 !important; left: 0 !important; border: none !important; pointer-events: none !important;">
            </iframe>
          </div>

          <!-- Contrôles et informations -->
          <div class="shorts-controls">
            <div class="shorts-info">
              <h2><%= @game.current_video.title %></h2>
              <p><%= @playlist.title %></p>
            </div>
            
            <div class="shorts-actions">
              <%= button_to swipe_playlist_game_path(@playlist, @game, direction: "dislike"), 
                  method: :post, 
                  class: "action-btn dislike" do %>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" class="action-icon">
                  <path d="M18 6L6 18M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              <% end %>
              
              <%= button_to swipe_playlist_game_path(@playlist, @game, direction: "like"), 
                  method: :post, 
                  class: "action-btn like" do %>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="action-icon">
                  <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                </svg>
              <% end %>
            </div>
          </div>
        </div>
      <% else %>
        <div class="shorts-end">
          <div class="end-message">
            <h2>Playlist terminée !</h2>
            <%= link_to "Retour aux playlists", playlists_path, class: "end-button" %>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Lien retour -->
    <div class="text-center mt-6">
      <%= link_to playlists_path, 
          class: "inline-flex items-center text-white/80 hover:text-white transition-colors" do %>
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
        Retour aux playlists
      <% end %>
    </div>

<style>
/* Reset et base */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  background: #000 !important;
  color: white;
  height: 100vh;
  overflow: hidden;
}

/* Container principal */
.shorts-container {
  width: 100vw;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  background: #000;
  position: fixed;
  top: 0;
  left: 0;
  z-index: 9999;
}

/* Player vidéo - Plein écran comme les shorts YouTube */
.shorts-player {
  width: 100vw !important;
  height: 100vh !important;
  position: relative !important;
  overflow: hidden !important;
  background: #000 !important;
  border-radius: 0 !important;
  box-shadow: none !important;
  max-width: none !important;
  max-height: none !important;
}

/* Conteneur vidéo - Forcer plein écran */
.shorts-video {
  width: 100vw !important;
  height: 100vh !important;
  height: 100dvh !important;
  position: absolute !important;
  top: 0 !important;
  left: 0 !important;
  overflow: hidden !important;
  z-index: 1 !important;
}

.shorts-video iframe {
  width: 100% !important;
  height: 100% !important;
  position: absolute !important;
  top: 0 !important;
  left: 0 !important;
  border: none !important;
  pointer-events: none !important;
  z-index: 1 !important;
  object-fit: cover !important;
}

/* Contrôles et overlay */
.shorts-controls {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 20px;
  background: linear-gradient(transparent, rgba(0,0,0,0.8));
  z-index: 10;
}

/* Informations vidéo */
.shorts-info {
  margin-bottom: 20px;
}

.shorts-info h2 {
  font-size: 1.1rem;
  font-weight: 600;
  margin-bottom: 4px;
  color: #fff;
}

.shorts-info p {
  font-size: 0.9rem;
  color: rgba(255,255,255,0.8);
}

/* Boutons d'action */
.shorts-actions {
  display: flex;
  justify-content: center;
  gap: 24px;
  padding: 16px 0;
}

.action-icon {
  width: 32px;
  height: 32px;
  color: white;
}

.action-btn.dislike .action-icon {
  stroke: white;
  stroke-width: 2.5;
}

.action-btn.like .action-icon {
  fill: white;
}

.action-btn {
  width: 64px !important;
  height: 64px !important;
  border-radius: 50% !important;
  border: none !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  cursor: pointer !important;
  transition: all 0.3s ease !important;
  color: white !important;
  border: 2px solid rgba(255,255,255,0.2) !important;
  padding: 0 !important;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2) !important;
}

.action-btn.dislike {
  background: linear-gradient(45deg, #ff4444, #ff0000) !important;
}

.action-btn.like {
  background: linear-gradient(45deg, #2196F3, #4FC3F7) !important;
}

.action-btn:hover {
  transform: scale(1.15);
  box-shadow: 0 6px 16px rgba(0,0,0,0.3);
}

.action-btn:active {
  transform: scale(0.95);
}

/* Message de fin */
.shorts-end {
  width: 360px;
  height: 640px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #111;
  border-radius: 16px;
}

.end-message {
  text-align: center;
  padding: 20px;
}

.end-message h2 {
  margin-bottom: 20px;
  color: white;
}

.end-button {
  display: inline-block;
  padding: 12px 24px;
  background: linear-gradient(45deg, #ff4b8a, #ff6b6b);
  color: white;
  text-decoration: none;
  border-radius: 25px;
  font-weight: 600;
  transition: all 0.3s ease;
}

.end-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(255,75,138,0.3);
}

/* Responsive - Optimisation pour tous les écrans */
@media (max-width: 768px) {
  /* Mobile - Plein écran FORCÉ */
  .shorts-player,
  .shorts-end {
    width: 100vw !important;
    height: 100vh !important;
    border-radius: 0 !important;
    max-width: none !important;
    max-height: none !important;
  }
}
</style>

<script>
// Forcer le plein écran immédiatement
document.addEventListener('DOMContentLoaded', function() {
  // Masquer toutes les barres de navigation
  document.body.style.height = '100vh';
  document.body.style.overflow = 'hidden';
  document.body.style.position = 'fixed';
  document.body.style.top = '0';
  document.body.style.left = '0';
  document.body.style.width = '100vw';
  
  // Masquer les éléments de navigation
  const navElements = document.querySelectorAll('nav, .nav, .main-content, .flash');
  navElements.forEach(el => {
    el.style.display = 'none';
  });
  
  // Forcer le plein écran du player
  const player = document.querySelector('.shorts-player');
  const container = document.querySelector('.shorts-container');
  
  if (player) {
    player.style.width = '100vw';
    player.style.height = '100vh';
    player.style.borderRadius = '0';
    player.style.boxShadow = 'none';
    player.style.position = 'fixed';
    player.style.top = '0';
    player.style.left = '0';
    player.style.zIndex = '99999';
  }
  
  if (container) {
    container.style.width = '100vw';
    container.style.height = '100vh';
    container.style.position = 'fixed';
    container.style.top = '0';
    container.style.left = '0';
    container.style.zIndex = '99999';
  }
  
  // Masquer les barres de navigation du navigateur
  if (window.innerHeight < window.screen.height) {
    document.body.style.height = window.screen.height + 'px';
  }
  
  // Calculer la hauteur réelle de l'écran sur mobile
  function setVH() {
    const vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', vh + 'px');
  }
  
  setVH();
  window.addEventListener('resize', setVH);
  window.addEventListener('orientationchange', setVH);
});

// Masquer les barres de navigation sur mobile après un délai
setTimeout(function() {
  if ('scrollBehavior' in document.documentElement.style) {
    window.scrollTo(0, 1);
  }
  
  // Forcer le plein écran
  const player = document.querySelector('.shorts-player');
  if (player) {
    player.style.width = '100vw';
    player.style.height = '100vh';
    player.style.borderRadius = '0';
    player.style.boxShadow = 'none';
  }
}, 1000);

// Forcer le plein écran en continu pour maintenir l'affichage
setInterval(function() {
  // Empêcher YouTube de sortir du plein écran
  const iframe = document.querySelector('iframe');
  if (iframe) {
    iframe.style.width = '100% !important';
    iframe.style.height = '100% !important';
    iframe.style.position = 'absolute !important';
    iframe.style.top = '0 !important';
    iframe.style.left = '0 !important';
    iframe.style.border = 'none !important';
    iframe.style.pointerEvents = 'none !important';
  }
  
  // Maintenir le plein écran du conteneur
  const container = document.querySelector('.shorts-container');
  const player = document.querySelector('.shorts-player');
  
  if (container) {
    container.style.cssText = 'width: 100vw !important; height: 100vh !important; height: 100dvh !important; position: fixed !important; top: 0 !important; left: 0 !important; z-index: 99999 !important; margin: 0 !important; padding: 0 !important; border-radius: 0 !important; box-shadow: none !important; max-width: none !important; max-height: none !important; background: #000 !important; display: flex !important; justify-content: center !important; align-items: center !important; transform: translateZ(0) !important; will-change: transform !important;';
  }
  
  if (player) {
    player.style.cssText = 'width: 100vw !important; height: 100vh !important; height: 100dvh !important; position: fixed !important; top: 0 !important; left: 0 !important; z-index: 99999 !important; overflow: hidden !important; background: #000 !important; border-radius: 0 !important; box-shadow: none !important; max-width: none !important; max-height: none !important; margin: 0 !important; padding: 0 !important; transform: translateZ(0) !important; will-change: transform !important;';
  }
}, 100);

// Empêcher la mise en pause et forcer la lecture continue
document.addEventListener('DOMContentLoaded', function() {
  // Empêcher les clics sur l'iframe qui pourraient mettre en pause
  const iframe = document.querySelector('iframe');
  if (iframe) {
    // Masquer complètement l'iframe pour empêcher l'interaction
    iframe.style.pointerEvents = 'none';
    iframe.style.userSelect = 'none';
    iframe.style.webkitUserSelect = 'none';
    iframe.style.mozUserSelect = 'none';
    iframe.style.msUserSelect = 'none';
  }
  
  // Empêcher les touches d'espace et autres qui pourraient mettre en pause
  document.addEventListener('keydown', function(e) {
    // Empêcher la barre d'espace (pause/play)
    if (e.code === 'Space' || e.key === ' ') {
      e.preventDefault();
      e.stopPropagation();
      return false;
    }
    
    // Empêcher les touches de média
    if (e.code === 'MediaPlayPause' || e.code === 'MediaStop') {
      e.preventDefault();
      e.stopPropagation();
      return false;
    }
  }, true);
  
  // Empêcher les clics sur la vidéo
  document.addEventListener('click', function(e) {
    if (e.target.tagName === 'IFRAME' || e.target.closest('iframe')) {
      e.preventDefault();
      e.stopPropagation();
      return false;
    }
  }, true);
  
  // Empêcher le menu contextuel
  document.addEventListener('contextmenu', function(e) {
    e.preventDefault();
    return false;
  });
  
  // Empêcher le glisser-déposer
  document.addEventListener('dragstart', function(e) {
    e.preventDefault();
    return false;
  });
});
</script> 